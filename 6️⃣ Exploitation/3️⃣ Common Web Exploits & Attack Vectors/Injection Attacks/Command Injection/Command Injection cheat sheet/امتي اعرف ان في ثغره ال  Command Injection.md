لمعرفة إذا كان هناك ثغرة **Command Injection** في تطبيق أو نظام، لازم تبحث عن علامات وتختبر بشكل منهجي. إليك أهم الطرق والعلامات اللي تساعدك تكتشف الثغرة دي:

### **1. علامات وجود ثغرة Command Injection**
- **مدخلات المستخدم تُمرر مباشرة للنظام**:
  - لو التطبيق بيستخدم مدخلات المستخدم (مثل حقول إدخال، URLs، أو نماذج) لتنفيذ أوامر نظام (زي `ping`, `ls`, `cat`)، احتمال كبير يكون فيه ثغرة.
  - مثال: موقع بياخد عنوان IP من المستخدم وينفذ أمر `ping` بدون فحص.
- **عدم وجود تحقق أو تنظيف للمدخلات**:
  - لو التطبيق مش بيحدد نوع المدخلات (مثل قبول أرقام فقط لـ IP) أو مش بيمنع أحرف زي `;`, `&`, `|`, فده مؤشر خطر.
- **سلوك غير متوقع**:
  - لو لاحظت إن التطبيق بيستجيب بطريقة غريبة (مثل إظهار ملفات النظام أو أخطاء غير متوقعة) لما تدخل أحرف معينة، ممكن تكون الثغرة موجودة.
- **كود مصدري ضعيف**:
  - لو بتراجع الكود (مثل PHP, Python, أو Node.js) وشفت دوال زي `system()`, `exec()`, `shell_exec()` بتستخدم مدخلات المستخدم بدون تنظيف، فده دليل على ثغرة محتملة.

### **2. ازاي تختبر وجود الثغرة؟**
لازم تختبر التطبيق يدويًا أو بأدوات أتوماتيكية. إليك الخطوات:

#### **أ. اختبار يدوي**
1. **إدخال أحرف خاصة**:
   - جرب تدخل أحرف تستخدم لفصل الأوامر زي:
     - `;` (فاصل أوامر في Linux)
     - `&&` (تنفيذ الأمر التالي إذا نجح الأول)
     - `||` (تنفيذ الأمر التالي إذا فشل الأول)
     - `|` (إرسال ناتج الأمر الأول للثاني)
   - مثال: لو الموقع بياخد IP، جرب تدخل: `127.0.0.1; whoami` أو `127.0.0.1 && whoami`.
2. **اختبار أوامر بسيطة**:
   - جرب أوامر نظام بسيطة وشوف لو الناتج بيظهر:
     - Linux: `127.0.0.1; ls` (لإظهار الملفات) أو `127.0.0.1; cat /etc/passwd`.
     - Windows: `127.0.0.1 & dir` أو `127.0.0.1 & whoami`.
3. **اختبار تأخير (Time-based)**:
   - لو الأوامر مش بترجع ناتج واضح، جرب أمر يسبب تأخير زي `127.0.0.1; sleep 10` (في Linux) أو `127.0.0.1 & ping -n 10 127.0.0.1` (في Windows). لو الاستجابة اتأخرت، يبقى الأمر اتعمل.
4. **اختبار الأخطاء**:
   - ادخل أوامر غلط زي `127.0.0.1; nonexistent_command` وشوف لو التطبيق بيرجع رسالة خطأ من النظام (زي "command not found").

#### **ب. استخدام أدوات أتوماتيكية**
- **Burp Suite**:
  - استخدم ميزة "Intruder" لإدخال مجموعة من الأوامر الخبيثة (payloads) في حقول الإدخال.
  - راقب استجابات الخادم لأي تغييرات أو أخطاء.
- **OWASP ZAP**:
  - أداة مفتوحة المصدر بتساعدك تكتشف الثغرات زي Command Injection باختبار المدخلات.
- **Commix**:
  - أداة متخصصة لاختبار Command Injection، بتحقن أوامر مختلفة وتحلل الاستجابات.

### **3. إزاي تتأكد إن في ثغرة؟**
- **تأكيد التنفيذ**:
  - لو دخلت أمر زي `127.0.0.1; whoami` وشفت اسم المستخدم بتاع الخادم في الرد، ده تأكيد واضح.
- **ناتج غير متوقع**:
  - لو ظهرت ملفات النظام (زي `/etc/passwd`) أو معلومات حساسة، يبقى الثغرة موجودة.
- **تأخير واضح**:
  - لو أمر زي `sleep 10` تسبب في تأخير مطابق (10 ثواني)، ده دليل قوي.
- **أخطاء النظام**:
  - لو شفت رسائل خطأ من النظام (مثل "sh: ls: command not found")، ده يعني إن الأوامر بتتنفذ فعلاً.

### **4. نصايح إضافية**
- **اختبار بحذر**:
  - لو بتختبر موقع أو تطبيق، لازم يكون عندك إذن (مثل برامج Bug Bounty أو بيئة اختبار). الاختبار بدون إذن ممكن يكون غير قانوني.
- **اختبار في بيئات مختلفة**:
  - الثغرة ممكن تظهر في Linux بس مش في Windows أو العكس، فجرب أوامر مناسبة للنظام.
- **راجع الكود**:
  - لو عندك وصول للكود المصدري، ابحث عن دوال خطرة زي `system()`, `exec()`، وتأكد إذا كانت بتستخدم مدخلات المستخدم بدون فحص.

### **مثال سريع**
افترض موقع بياخد إدخال زي `http://example.com/ping?ip=127.0.0.1`:
- جرب: `http://example.com/ping?ip=127.0.0.1; ls`.
- لو الرد بيحتوي على قايمة ملفات زي `index.html config.php`， يبقى في ثغرة.

لو عايز خطوات عملية أكتر أو أداة معينة أشرحها، قولي!