للبحث عن ثغرة **Command Injection**، لازم تركز على النقاط اللي ممكن تكون فيها مدخلات المستخدم بتتفاعل مع أوامر النظام. إليك الأماكن والمكونات اللي لازم تفتش فيها، سواء كنت بتختبر تطبيق ويب، خادم، أو حتى كود مصدري:

### **1. أماكن البحث في التطبيقات**
بتبحث في أي جزء من التطبيق بياخد مدخلات من المستخدم وبيمررها للنظام. الأماكن دي تشمل:

- **حقول إدخال النماذج (Form Inputs)**:
  - أي نموذج بيطلب من المستخدم إدخال بيانات (زي عنوان IP، اسم ملف، أو أمر معين).
  - مثال: نموذج لاختبار ping أو أداة لعرض ملفات.
- **معاملات URL (Query Parameters)**:
  - الروابط اللي فيها متغيرات (مثل `http://example.com/tool?input=data`).
  - جرب تحقن أوامر في الـ `data`، زي `data=127.0.0.1; ls`.
- **الرؤوس (HTTP Headers)**:
  - بعض التطبيقات بتستخدم بيانات من رؤوس HTTP (زي `User-Agent` أو `Referer`) في أوامر النظام.
- **ملفات الإدخال أو التحميل**:
  - لو التطبيق بيسمح برفع ملفات (مثل CSV أو نصوص) وبيعالجها بأوامر نظام، ممكن تكون عرضة للثغرة.
- **واجهات الأوامر (Command-line Interfaces)**:
  - لو التطبيق بيوفر واجهة لكتابة أوامر (مثل أدوات إدارة الشبكة)، فحصها بعناية.
- **API Endpoints**:
  - واجهات برمجة التطبيقات (APIs) اللي بتستقبل مدخلات (مثل JSON أو XML) وبتنفذ أوامر بناءً عليها.

### **2. أماكن البحث في الكود المصدري**
لو عندك وصول للكود (مثل أثناء مراجعة أمنية)، ابحث في الأماكن دي:

- **الدوال الخطرة**:
  - دوال تنفيذ الأوامر زي:
    - **PHP**: `system()`, `exec()`, `shell_exec()`, `passthru()`, `popen()`.
    - **Python**: `os.system()`, `subprocess.run()`, `os.popen()`.
    - **Node.js**: `child_process.exec()`, `child_process.spawn()`.
    - **Java**: `Runtime.getRuntime().exec()`.
  - لو الدوال دي بتستخدم مدخلات المستخدم مباشرة (مثل `system("ping " + user_input)`)، فده مؤشر قوي لثغرة.
- **معالجة المدخلات**:
  - شوف إذا كان في تحقق (validation) أو تنظيف (sanitization) للمدخلات قبل تمريرها للنظام.
  - لو الكود بيسمح بأحرف زي `;`, `&`, `|` بدون تصفية، فالثغرة محتملة.
- **التعامل مع الملفات أو الشبكة**:
  - الكود اللي بيعالج أسماء ملفات أو عناوين IP بناءً على إدخال المستخدم.
  - مثال: كود بيشغل أمر `cat` لعرض ملف بناءً على اسم الملف المدخل.

### **3. أماكن البحث في البنية التحتية**
- **خوادم الويب**:
  - إعدادات الخادم (مثل Apache أو Nginx) إذا كانت بتستخدم نصوص (scripts) أو أوامر بناءً على مدخلات.
  - مثال: CGI scripts اللي بتتعامل مع مدخلات المستخدم.
- **تطبيقات الطرف الثالث**:
  - مكتبات أو أدوات خارجية مدمجة في التطبيق (مثل أدوات تحليل الشبكة) ممكن تكون عرضة للثغرة.
- **واجهات إدارة النظام**:
  - لو النظام بيوفر واجهة إدارة (مثل لوحة تحكم) بتسمح بتشغيل أوامر، فحصها بعناية.

### **4. سيناريوهات شائعة للثغرة**
ابحث في التطبيقات أو الخدمات اللي بتعتمد على أوامر النظام، زي:
- **أدوات الشبكة**:
  - أدوات زي ping، traceroute، أو nslookup اللي بتستخدم إدخال المستخدم.
- **معالجة الملفات**:
  - تطبيقات بتعرض أو تعدل ملفات بناءً على إدخال (مثل أوامر `cat`, `rm`, `mv`).
- **إدارة النظام**:
  - أدوات إدارة الخادم اللي بتسمح بتشغيل أوامر (مثل إعادة تشغيل خدمات).
- **إرسال بريد إلكتروني**:
  - تطبيقات بتستخدم أوامر زي `sendmail` مع إدخال المستخدم.

### **5. طرق البحث العملية**
- **اختبار يدوي**:
  - جرب تحقن أوامر بسيطة في كل حقل إدخال أو معامل URL، زي:
    - `; ls` أو `&& whoami` (لـ Linux).
    - `& dir` أو `& whoami` (لـ Windows).
  - راقب الردود: لو ظهر ناتج زي قايمة ملفات أو اسم مستخدم، يبقى في ثغرة.
- **اختبار تأخير**:
  - استخدم أوامر زي `; sleep 10` أو `& ping -n 10 127.0.0.1` وشوف لو الاستجابة بتتأخر.
- **تحليل الأخطاء**:
  - لو التطبيق بيرجع رسائل خطأ من النظام (زي "command not found")، ده دليل إن الأوامر بتتنفذ.
- **أدوات أتوماتيكية**:
  - **Commix**: أداة مخصصة لاختبار Command Injection.
  - **Burp Suite**: استخدم Intruder لتجربة مجموعة payloads.
  - **OWASP ZAP**: لفحص الثغرات تلقائيًا.

### **6. نصايح للبحث**
- **ركز على المدخلات غير المفحوصة**:
  - أي مكان بياخد إدخال وما بيحددش نوعه (مثل نصوص بدل أرقام فقط).
- **جرب أنظمة مختلفة**:
  - الأوامر بتختلف بين Linux وWindows، فجرب payloads مناسبة.
  - Linux: `; ls`, `; cat /etc/passwd`.
  - Windows: `& dir`, `& type C:\Windows\System32\drivers\etc\hosts`.
- **اختبر بحذر**:
  - لو بتختبر موقع حي، لازم يكون عندك إذن قانوني (مثل برامج Bug Bounty).
- **راجع استجابات الخادم**:
  - شوف لو في ناتج غير متوقع، زي ملفات نظام أو تأخير.

### **مثال عملي**
لو عندك موقع بياخد إدخال زي: `http://example.com/ping?ip=127.0.0.1`:
- جرب: `http://example.com/ping?ip=127.0.0.1; ls`.
- لو الرد بيحتوي على ملفات زي `index.php config.json`， يبقى الثغرة موجودة.
- جرب تأخير: `http://example.com/ping?ip=127.0.0.1; sleep 10`، ولو الرد اتأخر 10 ثواني، ده تأكيد.

لو عايز تركز على جزء معين (زي أداة معينة أو نوع تطبيق)، قولي وأشرحلك بالتفصيل!