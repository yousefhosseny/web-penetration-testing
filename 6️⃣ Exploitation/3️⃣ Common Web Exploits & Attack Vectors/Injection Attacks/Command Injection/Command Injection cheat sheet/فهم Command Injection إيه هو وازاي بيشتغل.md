**Command Injection** هو نوع من الهجمات السيبرانية يتم فيها استغلال ثغرة أمنية في تطبيق أو نظام يسمح للمهاجم بإدخال أوامر خبيثة (commands) يتم تنفيذها مباشرة على النظام الأساسي (مثل خادم الويب أو نظام التشغيل). الهدف هو التحكم في النظام أو سرقة بيانات أو إلحاق الضرر.

### **إيه هو Command Injection؟**
- يحدث عندما يقوم التطبيق بتمرير مدخلات المستخدم (مثل حقول النماذج أو الروابط) إلى واجهة الأوامر (command line) دون التحقق منها أو تنظيفها (sanitization).
- المهاجم يحقن أوامر ضارة داخل المدخلات بحيث يتم تنفيذها كجزء من الأمر الأصلي.
- مثال: لو التطبيق ينفذ أمر مثل `ping` بناءً على إدخال المستخدم، المهاجم ممكن يضيف أوامر إضافية لتنفيذ شيء آخر.

### **ازاي بيشتغل؟**
1. **وجود ثغرة**: التطبيق يأخذ مدخلات المستخدم (مثل عنوان IP في أداة ping) ويمررها مباشرة إلى النظام دون فحص.
   - مثال: أمر في التطبيق: `system("ping " + user_input)`.
2. **حقن الأمر الخبيث**: المهاجم يدخل شيء زي `127.0.0.1; rm -rf /*`، حيث:
   - `127.0.0.1` هو المدخل المتوقع.
   - `;` يفصل بين الأوامر.
   - `rm -rf /*` أمر خبيث يحذف ملفات النظام.
3. **التنفيذ**: النظام ينفذ الأمر الكلي (`ping 127.0.0.1; rm -rf /*`)، فيتم تنفيذ الأمر الخبيث مع الأمر الأصلي.
4. **النتيجة**: المهاجم يمكن أن:
   - يشغل برمجيات خبيثة.
   - يسرق بيانات (مثل كلمات السر).
   - يعدل أو يحذف ملفات.
   - يفتح منافذ (ports) للوصول عن بُعد.

### **مثال عملي**
افترض موقع ويب عنده أداة ping، والكود الداخلي هو:
```php
$ip = $_GET['ip'];
system("ping -c 4 " . $ip);
```
- المستخدم الطبيعي يدخل: `192.168.1.1`.
- المهاجم يدخل: `192.168.1.1; whoami`.
- النظام ينفذ: `ping -c 4 192.168.1.1; whoami`، ويظهر اسم المستخدم الذي يعمل به الخادم.

### **ازاي نحمي منه؟**
1. **التحقق من المدخلات (Input Validation)**: تأكد إن المدخلات تطابق النمط المتوقع (مثل أرقام IP فقط).
2. **تنظيف المدخلات (Sanitization)**: إزالة أو تعطيل الأحرف الخطرة مثل `;`, `&`, `|`.
3. **استخدام APIs آمنة**: بدل تنفيذ الأوامر مباشرة، استخدم مكتبات تحد من التفاعل مع النظام.
4. **تقليل الصلاحيات**: شغل التطبيق بحساب مستخدم بصلاحيات محدودة.
5. **استخدام Allowlist**: اسمح فقط بالقيم المعتمدة مسبقًا.

لو عايز تفاصيل أكتر أو أمثلة كود، قولي!