### متى تعرف أن هناك احتمال لوجود ثغرة LDAP؟
ثغرة LDAP Injection تحدث عندما يستخدم التطبيق مدخلات المستخدم (مثل اسم المستخدم أو كلمة المرور) لبناء استعلامات LDAP دون تعقيم مناسب. هناك علامات تشير إلى أن التطبيق قد يكون يستخدم LDAP وبالتالي قد يكون عرضة للثغرة. ابحث عن العلامات التالية:

1. **وجود نموذج تسجيل دخول أو بحث في الدليل**:
   - إذا كان الموقع يحتوي على نموذج تسجيل دخول (حقول مثل اسم المستخدم وكلمة المرور) أو نموذج بحث (مثل البحث عن موظفين أو مستخدمين في دليل)، فقد يتفاعل مع LDAP.
   - التطبيقات التي تدير بيانات المستخدمين (مثل تطبيقات الموارد البشرية، الشبكات الداخلية، أو أنظمة إدارة الهوية) غالبًا تستخدم LDAP.

2. **رسائل خطأ تشير إلى LDAP**:
   - عند إدخال بيانات غير صحيحة (مثل اسم مستخدم أو كلمة مرور عشوائية)، تحقق من رسائل الخطأ. إذا ظهرت كلمات مثل "LDAP"، "directory"، "uid"، "cn"، "sn"، أو "userPassword"، فهذا مؤشر قوي على استخدام LDAP.
   - مثال: رسالة خطأ مثل "Invalid LDAP credentials" أو "No such object in directory" تشير إلى LDAP.

3. **استجابات تحتوي على مصطلحات LDAP**:
   - عند فحص استجابات HTTP (باستخدام أداة وكيل مثل Burp Suite)، ابحث عن معايير أو استجابات تحتوي على مصطلحات LDAP مثل `uid`، `cn`، `sn`، `objectClass`، أو `userPassword`.
   - إذا كانت الاستجابة تحتوي على تنسيق مشابه لاستعلامات LDAP (مثل `(&(uid=*)(userPassword=*))`)، فهذا دليل على استخدام LDAP.

4. **سلوك التطبيق مع مدخلات غير متوقعة**:
   - أدخل أحرفًا خاصة مثل `*` أو `)` أو `&` في حقل اسم المستخدم أو كلمة المرور. إذا تغيرت استجابة الموقع بشكل غير متوقع (مثل ظهور خطأ مختلف أو استجابة غريبة)، فقد يكون هناك تفاعل مع LDAP.
   - مثال: إدخال `admin*` كاسم مستخدم قد يُظهر نتائج غير متوقعة إذا كان التطبيق يمرر المدخلات مباشرة إلى استعلام LDAP.

5. **نوع التطبيق أو البيئة**:
   - التطبيقات المستخدمة في الشركات (مثل أنظمة إدارة الموظفين أو الشبكات الداخلية) غالبًا تستخدم LDAP لإدارة الهوية.
   - إذا كنت تعلم أن الموقع يعتمد على تقنيات مثل Active Directory (في بيئات Windows) أو OpenLDAP، فهذا يزيد احتمال استخدام LDAP.

---

### كيفية التحقق عمليًا (تفاصيل الخطوة الأولى)
لتحديد ما إذا كان الموقع يستخدم LDAP ويحتوي على ثغرة محتملة، اتبع هذه الخطوات العملية:

1. **تكوين أداة وكيل**:
   - قم بإعداد متصفحك لتوجيه حركة المرور عبر أداة وكيل مثل **Burp Suite** أو **OWASP ZAP**.
   - هذا يتيح لك مراقبة الطلبات (Requests) والاستجابات (Responses) بين المتصفح والموقع.

2. **اختبار نموذج تسجيل الدخول**:
   - افتح نموذج تسجيل الدخول على الموقع.
   - أدخل بيانات اختبار بسيطة:
     - اسم المستخدم: `test`
     - كلمة المرور: `test`
   - أرسل النموذج وتحقق من استجابة الموقع (رسالة الخطأ أو النجاح).
   - راقب طلب HTTP في Burp Suite. ابحث عن:
     - معايير مثل `uid`، `userPassword`، أو `cn` في الطلب.
     - رسائل خطأ في الاستجابة تشير إلى LDAP.

3. **اختبار أحرف خاصة**:
   - أدخل قيمًا تحتوي على أحرف خاصة في حقل اسم المستخدم أو كلمة المرور:
     - مثال: `admin*`، `*`، `*)(uid=*)`، أو `admin)(cn=*`
   - إذا تغيرت الاستجابة (مثل ظهور خطأ جديد أو نتائج غير متوقعة)، فقد يكون هناك تفاعل مع LDAP.
   - مثال: إذا أدخلت `*` في حقل البحث وأعاد الموقع قائمة بجميع المستخدمين، فقد يكون الاستعلام غير مؤمن.

4. **تحليل استجابات الخطأ**:
   - أدخل قيمًا غير صالحة أو طويلة جدًا (مثل `admin' OR '1'='1`) وتحقق من رسائل الخطأ.
   - إذا ظهرت كلمات مثل "LDAP filter error" أو "directory service error"، فهذا مؤشر قوي على LDAP.

5. **اختبار نموذج البحث (إن وجد)**:
   - إذا كان الموقع يحتوي على خاصية بحث (مثل البحث عن موظفين)، أدخل قيمًا مثل `*` أو `admin*`.
   - تحقق إذا أعاد الموقع نتائج غير متوقعة (مثل جميع السجلات) أو أخطاء تشير إلى LDAP.

---

### ملخص: متى وأين تبحث عن ثغرة LDAP؟
- **متى تعرف أن هناك ثغرة محتملة؟**
  - وجود نماذج تسجيل دخول أو بحث.
  - رسائل خطأ تحتوي على مصطلحات LDAP (مثل "LDAP"، "uid"، "directory").
  - استجابات تحتوي على معايير LDAP أو تنسيقات استعلامات.
  - تغيرات في الاستجابة عند إدخال أحرف خاصة مثل `*` أو `)`.
  - التطبيق يُستخدم في بيئة مؤسسية أو يعتمد على Active Directory/OpenLDAP.

- **أين تبحث؟**
  - **نماذج تسجيل الدخول**: حقول اسم المستخدم وكلمة المرور.
  - **نماذج البحث**: حقول البحث عن مستخدمين أو موظفين.
  - **معايير URL**: معايير مثل `?search=admin`.
  - **حقول إدخال أخرى**: حقول التسجيل أو تحديث الملف الشخصي.
  - **واجهات API**: نقاط نهاية تتعامل مع بيانات المستخدم.

---
