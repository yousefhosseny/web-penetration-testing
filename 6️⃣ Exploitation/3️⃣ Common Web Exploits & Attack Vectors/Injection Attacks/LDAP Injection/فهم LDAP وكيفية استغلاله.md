تمام، هنشرح **فهم LDAP وكيفية استغلاله** بعمق عملي مع أكواد وتفاصيل، وهنركز على الجوانب اللي تهمك كـ pentester. هقسم الموضوع لأجزاء عن فهم LDAP وتقنيات الاستغلال، وبعد كل جزء هحط خلاصة طريفة بالعامية المصرية، وفي الآخر هقدم خطوات عملية للاستغلال. يلا نبدأ!

---
### **1. فهم LDAP: إيه هو وازاي بيشتغل؟**
#### **إيه هو؟**
LDAP (Lightweight Directory Access Protocol) هو بروتوكول بيستخدم للوصول لقواعد بيانات هرمية (Directories) زي Active Directory. بيخزن بيانات زي أسماء المستخدمين، الباسووردات، والإيميلات، وكتير من التطبيقات بتستخدمه للمصادقة أو البحث.

#### **ازاي بيشتغل؟**
LDAP بيستخدم استعلامات (Filters) شبه شجرة، مكتوبة بصيغة زي:
```
(uid=admin)(userPassword=123)
```
- `uid`: اسم المستخدم.
- `userPassword`: الباسوورد.
لو التطبيق بياخد مدخلات منك (زي يوزر نيم) ويحطها في الاستعلام من غير فلترة، تقدر تحقن أوامر تغير منطق الاستعلام.

#### **مثال عملي:**
- استعلام عادي:
  ```
  (&(uid=admin)(userPassword=123))
  ```
  معناه: "جيب اليوزر admin لو الباسوورد 123".
- لو حطيت في اليوزر نيم:
  ```
  admin)(&
  ```
  الاستعلام هيبقى:
  ```
  (&(uid=admin)(&)(userPassword=whatever))
  ```
  الـ `)(&` بيخليه True دايماً، فتدخل من غير باسوورد.

#### **خلاصة طريفة:**
تخيل إن LDAP زي دفتر تليفونات كبير، لو قلت للموظف "اديني رقم أحمد، وكمان أي حاجة تانية"، لو جابلك كل الأرقام يبقى هو اللي سابك تاخد كل حاجة!

---

### **2. استغلال LDAP: تجاوز المصادقة**
#### **إيه هو؟**
LDAP Injection بيسمحلك تتخطى اللوجين لو التطبيق بيثق في المدخلات بتاعتك من غير ما ينظفها.

#### **ازاي بيشتغل؟**
بتستخدم أحرف خاصة زي `*` (Wildcard) أو `)` (إغلاق قوس) عشان تعطل شرط الباسوورد.

#### **مثال عملي:**
- الاستعلام الأصلي:
  ```
  (&(uid=admin)(userPassword=123))
  ```
- في حقل اليوزر نيم:
  ```
  admin)(&|(!(uid=*))
  ```
  الاستعلام هيبقى:
  ```
  (&(uid=admin)(&|(!(uid=*)))(userPassword=whatever))
  ```
  الـ `|(!(uid=*))` بيخليه دايماً True، فتدخل.

- **اختبار يدوي:**
  ```
  username: admin)(&
  password: test
  ```

#### **خلاصة طريفة:**
تخيل إنك بتقول للبواب "أنا أحمد وكفاية كده"، لو فتحلك الباب من غير ما يسأل عن كلمة السر، يبقى هو اللي نايم في النوبة!

---

### **3.  Valid LDAP Attributes
#### **إيه هو؟**
تقدر تستخدم LDAP Injection عشان تسحب بيانات زي أسماء المستخدمين أو الإيميلات لو التطبيق بيرجع نتايج من الديركتوري.

#### **ازاي بيشتغل؟**
بتحقن Wildcard `*` أو تعبيرات تجيب كل البيانات بدل حاجة محددة.

#### **مثال عملي:**
- الاستعلام الأصلي:
  ```
  (uid=admin)
  ```
- في حقل البحث:
  ```
  *)(uid=*
  ```
  الاستعلام هيبقى:
  ```
  (uid=*)(uid=*)
  ```
  معناه: "جيب كل المستخدمين"، وكده هيطلعلك كل الـ uid.

- **اختبار يدوي:**
  ```
  search: *)(uid=*
  ```
  لو رجع قايمة مستخدمين، يبقى نجح.

#### **خلاصة طريفة:**
تخيل إنك بتقول للموظف "اديني بيانات أحمد، أو أي حد موجود"، لو جابلك الدفتر كله يبقى هو اللي فتحلك الخزنة!

---

### **4. استغلال LDAP: Blind Injection**
#### **إيه هو؟**
لو التطبيق مش بيرجع نتايج مباشرة، تقدر تستخدم تقنيات Blind عشان تتأكد من الثغرة وتستخرج بيانات بالتدريج.

#### **ازاي بيشتغل؟**
بتحقن شروط True/False أو تتأخر الاستجابة لو الشرط صح.

#### **مثال عملي:**
- **Boolean-Based:**
  ```
  admin)(uid=admin
  ```
  لو دخلت (True)، جرب:
  ```
  admin)(uid=wrong
  ```
  لو رفض (False)، يبقى شغال.

- **Time-Based:**
  لو مدموج مع داتابيز تانية:
  ```
  admin)(sleep=5
  ```
  لو الصفحة تأخرت 5 ثواني، يبقى في ثغرة.

#### **خلاصة طريفة:**
تخيل إنك بتسأل البواب "لو أنا أحمد افتح، لو مش أحمد استنى شوية"، لو استنى يبقى كده فتحتلك الباب بالذكاء!

---

### **خطوات عملية للاستغلال كـ Pentester**
1. **فهم الهدف:**
   - شوف لو التطبيق بيستخدم LDAP (زي رسالة خطأ تقول "LDAP Error" أو Active Directory).
   - جرب أي حقل إدخال (لوجين، بحث).

2. **تجاوز المصادقة:**
   - في اليوزر نيم:
     ```
     admin)(&
     ```
     أو:
     ```
     admin)(&|(!(uid=*))
     ```
     وأي باسوورد.

3. **استخراج البيانات:**
   - في حقل بحث:
     ```
     *)(uid=*
     ```
     لو رجع بيانات، دوّنها.

4. **اختبار Blind:**
   - Boolean:
     ```
     admin)(uid=admin
     ```
     ثم:
     ```
     admin)(uid=wrong
     ```
   - Time-Based:
     ```
     admin)(sleep=5
     ```

5. **استخدام أدوات:**
   - Burp Suite: اعترض الطلب وحط:
     ```
     username=admin)(&
     ```
   - sqlmap (لو مدموج):
     ```
     sqlmap -u "http://example.com/login.php" --data="username=admin&password=test" --ldap
     ```

#### **نصيحة:**
- لو في فلتر، جرب تشفير زي `%29%26` (يعني `)(&`).
- دوّن كل ردود السيرفر عشان تفهم النظام.

---

ها، عايز أشرح حاجة زيادة زي استخراج بيانات أكتر أو أعمق في أدوات؟