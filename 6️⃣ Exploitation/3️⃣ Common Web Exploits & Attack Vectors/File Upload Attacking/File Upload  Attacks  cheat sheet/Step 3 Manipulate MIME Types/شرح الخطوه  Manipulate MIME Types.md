بناءً على طلبك لإعادة شرح خطوة **Manipulate MIME Types** في اختبار هجمات تحميل الملفات (File Upload Attacks) باستخدام نفس طريقة الشرح السابقة (مع أقسام مثل "ما المقصود؟"، "لماذا يعمل؟"، "كيف يتم الاستغلال؟"، والخطوات العملية) باللغة العربية، مع تجنب استخدام تنسيق ```http خارج علامة ```، سأقدم شرحًا مفصلاً ومنظمًا. سأغطي جميع المحاولات الممكنة لتجاوز قيود التحقق من نوع MIME في تحميل الملفات، مع تقديم الأوامر والأمثلة لكل تقنية. سيتم تضمين المحتوى ذي الصلة في علامة ``` بمعرف جديد، مع الحفاظ على التنسيق المطلوب وتجنب استخدام Markdown خارج العلامة.

---

## فهم الخطوة: التلاعب بنوع MIME (Manipulate MIME Types)

### ما المقصود؟
التلاعب بنوع MIME (Multipurpose Internet Mail Extensions) هو تقنية تُستخدم لخداع الخادم لقبول ملف خبيث (مثل ويب شيل PHP) عن طريق تعديل رأس Content-Type في طلب تحميل الملف ليظهر كملف مسموح به (مثل image/jpeg). الهدف هو تجاوز قيود التحقق من نوع الملف التي يفرضها الخادم، مما يسمح بتحميل ملفات قابلة للتنفيذ (مثل .php أو .asp) تحت ستار أنواع ملفات غير ضارة (مثل الصور أو المستندات).

### لماذا يعمل؟
- **التحقق السطحي من نوع MIME**: العديد من الخوادم تعتمد على رأس Content-Type في طلب HTTP لتحديد نوع الملف دون فحص محتوى الملف الفعلي.
- **عدم التحقق من المحتوى**: بعض التطبيقات لا تفحص بايتات الملف (مثل البايتات السحرية) وتعتمد فقط على رأس Content-Type المُرسل من العميل.
- **مرونة معالجة الملفات**: الخوادم قد تقبل أنواع MIME غير دقيقة (مثل application/octet-stream) أو تسمح بأنواع متعددة دون فلترة صارمة.
- **إمكانية التلاعب في الطلبات**: أدوات مثل Burp Suite تتيح تعديل رأس Content-Type في طلبات POST، مما يسمح بإرسال نوع مزيف.
- **إعدادات خاطئة**: بعض الخوادم تُنفذ الملفات بناءً على امتدادها أو إعداداتها، بغض النظر عن نوع MIME المُعلن.

### كيف يتم الاستغلال؟
- يتم إنشاء ملف خبيث (مثل ويب شيل PHP) يحتوي على شيفرة قابلة للتنفيذ.
- يتم تعديل طلب التحميل باستخدام أداة وكيل (مثل Burp Suite) لتغيير رأس Content-Type إلى نوع مسموح (مثل image/jpeg أو image/png).
- يتم تحميل الملف عبر واجهة تحميل الموقع، ويتم اختبار ما إذا كان الملف يُنفذ عند الوصول إليه (مثل http://<target>/Uploads/shell.php?cmd=whoami).
- إذا نجحت التقنية، يمكن تنفيذ أوامر خبيثة على الخادم، مما قد يؤدي إلى اختراق النظام.

### السناريو
لنفترض أنك تختبر موقعًا إلكترونيًا يسمح بتحميل الصور فقط (مثل .jpg، .png، .gif) ويتحقق من نوع MIME في طلب التحميل. تحاول تحميل ملف shell.php (ويب شيل) ولكن الخادم يرفضه لأن Content-Type هو application/x-php أو لأن الامتداد غير مسموح. باستخدام Burp Suite، تعترض طلب التحميل وتغير Content-Type إلى image/jpeg، مع الاحتفاظ بمحتوى الملف كـ PHP. إذا قبل الخادم الملف وتم تنفيذه، تكون قد أكدت وجود ثغرة تحميل ملفات.

---

## الخطوات العملية للتلاعب بنوع MIME

1. **إعداد البيئة**:
   - استخدم أداة وكيل مثل Burp Suite أو OWASP ZAP لاعتراض وتعديل طلبات تحميل الملفات.
   - قم بإنشاء ملف ويب شيل بسيط (مثل PHP) لاختبار التنفيذ:
     ```php
     <?php system($_GET['cmd']); ?>
     ```
     احفظه باسم shell.php.
   - افتح أدوات المطورين في المتصفح (F12) لمراقبة استجابات الخادم.
   - حدد نقطة تحميل الملفات في الموقع (مثل نموذج تحميل صور).

2. **اختبار التحميل المباشر**:
   - حاول تحميل shell.php مباشرة عبر واجهة الموقع.
   - استخدم Burp Suite لاعتراض طلب POST وفحص رأس Content-Type (مثل application/x-php).
   - راقب استجابة الخادم (مثل "نوع الملف غير مسموح" أو رمز حالة HTTP 403).
   - إذا فشل التحميل، انتقل إلى التلاعب بنوع MIME.

3. **تعديل رأس Content-Type**:
   - استخدم Burp Suite لاعتراض طلب POST عند تحميل shell.php.
   - غيّر رأس Content-Type إلى نوع مسموح (مثل image/jpeg، image/png، image/gif).
   - أرسل الطلب وحاول تحميل الملف.
   - مثال طلب POST معدل داخل Burp Suite:
     ```http
     POST /upload HTTP/1.1
     Host: <target>
     Content-Type: image/jpeg
     Content-Length: <length>

     <?php system($_GET['cmd']); ?>
     ```

4. **مراقبة الاستجابات**:
   - تحقق مما إذا تم تحميل الملف بنجاح (مثل رسالة "تم التحميل" أو ظهور اسم الملف).
   - حاول الوصول إلى الملف عبر المتصفح أو curl:
     ```bash
     curl 'http://<target>/Uploads/shell.php?cmd=whoami'
     ```
   - نجاح (True): إذا تم تنفيذ الأمر (مثل إرجاع مخرجات whoami)، فهذا يؤكد وجود ثغرة.
   - فشل (False): إذا رفض الخادم الملف أو لم يتم تنفيذه، جرب نوع MIME آخر.

5. **تجربة تقنيات إضافية**:
   - إذا فشل نوع MIME واحد، جرب أنواعًا أخرى مسموحة (مثل image/gif، application/pdf).
   - جرب إضافة رؤوس Content-Type متعددة (مثل نوع غير مسموح متبوعًا بنوع مسموح).
   - ادمج التلاعب بنوع MIME مع تقنيات أخرى (مثل الامتدادات المزدوجة أو البايتات السحرية).
   - استخدم أدوات أتمتة مثل Fuxploider لاختبار أنواع MIME متعددة:
     ```bash
     python3 fuxploider.py --url http://<target>/upload --extensions php --content-type image/jpeg
     ```

6. **تأكيد التنفيذ**:
   - تحقق من تنفيذ الملف عبر إرسال أوامر بسيطة (مثل whoami أو ls).
   - إذا نجحت، سجل نوع MIME الناجح والامتداد المستخدم للتوثيق.
   - انتقل إلى اختبار هجمات أخرى (مثل استغلال البايتات السحرية أو ملفات الإعدادات).

---
