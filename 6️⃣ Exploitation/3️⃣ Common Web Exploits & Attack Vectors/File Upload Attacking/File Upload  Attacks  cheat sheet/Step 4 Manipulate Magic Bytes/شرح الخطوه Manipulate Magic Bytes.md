بناءً على طلبك لشرح خطوة **Manipulate Magic Bytes** (تغيير السيجنتشر للملف) في اختبار هجمات تحميل الملفات (File Upload Attacks) باستخدام نفس طريقة الشرح السابقة (مع أقسام مثل "ما المقصود؟"، "لماذا يعمل؟"، "كيف يتم الاستغلال؟"، والخطوات العملية) باللغة العربية، سأقدم شرحًا مفصلاً ومنظمًا. سأغطي جميع المحاولات الممكنة لتغيير البايتات السحرية (Magic Bytes) لتجاوز قيود التحقق من نوع الملف، مع تقديم الأوامر والأمثلة لكل تقنية. سيتم تضمين المحتوى ذي الصلة في علامة `<xaiArtifact>` بمعرف جديد، مع الحفاظ على التنسيق المطلوب وتجنب استخدام Markdown خارج العلامة.

---

## فهم الخطوة: تغيير السيجنتشر للملف (Manipulate Magic Bytes)

### ما المقصود؟
تغيير السيجنتشر للملف (Manipulate Magic Bytes) هو تقنية تُستخدم لتجاوز قيود تحميل الملفات عن طريق إضافة أو تعديل البايتات السحرية (Magic Bytes) في بداية ملف خبيث (مثل ويب شيل PHP) ليبدو كملف مسموح به (مثل صورة JPG أو PNG). البايتات السحرية هي تسلسلات بايت محددة في بداية الملف تُستخدم لتحديد نوعه (مثل `\x89PNG` لملفات PNG). الهدف هو خداع الخادم لقبول ملف قابل للتنفيذ (مثل .php) على أنه ملف غير ضار (مثل .jpg) بناءً على البايتات السحرية.

### لماذا يعمل؟
- **التحقق من البايتات السحرية**: العديد من الخوادم تستخدم أدوات مثل `libmagic` أو `file` لفحص البايتات السحرية لتحديد نوع الملف، بدلاً من الاعتماد فقط على الامتداد أو رأس Content-Type.
- **التحقق السطحي**: بعض الخوادم تفحص فقط البايتات الأولى من الملف وتتجاهل بقية المحتوى، مما يسمح بإضافة شيفرة خبيثة بعد البايتات السحرية.
- **إعدادات الخادم الخاطئة**: خوادم مثل Apache قد تُنفذ الملف بناءً على الامتداد (مثل .php)، حتى لو بدأ الملف ببايتات سحرية لصورة.
- **إمكانية التلاعب بالمحتوى**: يمكن إنشاء ملف يبدأ ببايتات سحرية لصورة (مثل `\x89PNG`) ويحتوي على شيفرة PHP قابلة للتنفيذ، مما يخدع فحص المحتوى.
- **مرونة أنواع الملفات**: بعض أنواع الملفات (مثل PNG أو GIF) تتجاهل البيانات بعد البايتات السحرية، مما يسمح بإخفاء شيفرة خبيثة.

### كيف يتم الاستغلال؟
- يتم إنشاء ملف خبيث (مثل ويب شيل PHP) يحتوي على شيفرة قابلة للتنفيذ.
- تُضاف البايتات السحرية لنوع ملف مسموح (مثل `\x89PNG` لـ PNG أو `\xff\xd8\xff` لـ JPG) في بداية الملف.
- يتم تحميل الملف عبر واجهة تحميل الموقع، غالبًا مع تعديل رأس Content-Type (مثل image/jpeg) باستخدام أداة وكيل مثل Burp Suite.
- يتم اختبار ما إذا كان الملف يُنفذ عند الوصول إليه (مثل http://<target>/Uploads/shell.php?cmd=whoami).
- إذا نجحت التقنية، يمكن تنفيذ أوامر خبيثة على الخادم، مما قد يؤدي إلى اختراق النظام.

### السناريو
لنفترض أنك تختبر موقعًا إلكترونيًا يسمح بتحميل الصور فقط (مثل .jpg، .png، .gif) ويتحقق من البايتات السحرية للتأكد من أن الملف صورة حقيقية. تحاول تحميل ملف shell.php (ويب شيل) ولكن الخادم يرفضه لأن البايتات السحرية لا تتطابق مع صورة. تقوم بإنشاء ملف جديد يبدأ ببايتات سحرية لـ PNG (مثل `\x89PNG`) متبوعًا بشيفرة PHP، وتحمله باستخدام امتداد .png ورأس Content-Type: image/png. إذا قبل الخادم الملف وتم تنفيذه كـ PHP (بسبب امتداد .php أو إعدادات الخادم)، تكون قد أكدت وجود ثغرة تحميل ملفات.

---
