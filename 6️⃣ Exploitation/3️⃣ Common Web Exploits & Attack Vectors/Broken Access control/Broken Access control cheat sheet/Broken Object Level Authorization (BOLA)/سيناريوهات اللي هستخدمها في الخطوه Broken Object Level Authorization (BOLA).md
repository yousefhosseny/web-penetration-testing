**Broken Object Level Authorization (BOLA)** هو ثغرة أمنية تحدث عندما يتمكن المستخدم من الوصول إلى بيانات أو موارد لا يُفترض أن يكون لديه صلاحية الوصول إليها، بسبب فشل التطبيق في التحقق من صلاحيات المستخدم بشكل صحيح عند التعامل مع كائنات (Objects) معينة. هذه الثغرة شائعة في تطبيقات الـ API، حيث يمكن للمهاجم التلاعب بمعرفات الكائنات (Object IDs) للوصول إلى بيانات مستخدمين آخرين أو موارد غير مصرح له بها.

### شرح الثغرة ببساطة:
- تخيل أن لديك تطبيق يسمح للمستخدم برؤية بياناته الشخصية عبر طلب API مثل:
  ```
  GET /api/users/123
  ```
  حيث "123" هو معرف المستخدم (User ID). إذا لم يتحقق التطبيق من أن المستخدم الحالي هو صاحب المعرف 123، يمكن لأي مستخدم تغيير المعرف إلى 124 أو أي رقم آخر للوصول إلى بيانات مستخدم آخر.
- هذا يحدث لأن التطبيق يعتمد فقط على المعرف المُرسل في الطلب دون التحقق من صلاحيات المستخدم.

---

## محاولات استغلال ثغرة BOLA:
لاختبار أو استغلال هذه الثغرة، يمكن للمهاجم استخدام الطرق التالية (مع ملاحظة أن هذا الشرح لأغراض تعليمية فقط ويجب استخدامه بشكل أخلاقي في اختبارات الأمان المصرح بها):

#### 1. **تغيير معرف الكائن (Object ID Manipulation):**
   - حاول تغيير قيمة المعرف في طلبات الـ API. على سبيل المثال:
     - إذا كان الطلب الأصلي: `GET /api/users/123`
     - جرب: `GET /api/users/124` أو `GET /api/users/1000`
   - إذا نجح الطلب وعرض بيانات مستخدم آخر، فهذه ثغرة BOLA.

#### 2. **تجربة معرفات متسلسلة (Sequential IDs):**
   - إذا كانت المعرفات متسلسلة (مثل 1، 2، 3، ...)، حاول إرسال طلبات لمعرفات مختلفة بشكل متتالي باستخدام أدوات مثل Burp Suite أو سكربتات أتمتة.
   - مثال: استخدم سكربت Python مع مكتبة `requests` لإرسال طلبات متكررة:
     ```python
     import requests
     for i in range(1, 1000):
         response = requests.get(f"https://example.com/api/users/{i}")
         print(f"ID {i}: {response.text}")
     ```

#### 3. **استخدام معرفات غير متوقعة (Non-Sequential IDs):**
   - إذا كانت المعرفات غير متسلسلة (مثل UUIDs)، حاول جمع معرفات صالحة من خلال:
     - استجابات API أخرى قد تحتوي على معرفات مستخدمين آخرين.
     - مراقبة حركة الشبكة في التطبيق لاستخراج معرفات.
     - محاولة تخمين UUIDs أو معرفات أخرى إذا كانت قابلة للتخمين.

#### 4. **التلاعب بمعاملات الطلب (Parameters):**
   - جرب تغيير المعرفات في معاملات الـ URL، الـ Body، أو حتى الرؤوس (Headers).
   - مثال:
     - طلب أصلي: `POST /api/documents/123/view`
     - جرب: `POST /api/documents/456/view`
   - تحقق مما إذا كان بإمكانك الوصول إلى مستندات أو موارد تخص مستخدمين آخرين.

#### 5. **اختبار الصلاحيات عبر أدوار مختلفة (Role-Based Testing):**
   - إذا كان لديك حسابات متعددة بأدوار مختلفة (مثل مستخدم عادي ومدير)، حاول الوصول إلى موارد مخصصة لأدوار أعلى باستخدام حساب بصلاحيات أقل.
   - مثال: إذا كان لديك حساب مستخدم عادي، حاول الوصول إلى واجهة إدارية عبر تغيير المعرفات.

#### 6. **التلاعب بطلبات CRUD (Create, Read, Update, Delete):**
   - جرب جميع العمليات على الكائنات:
     - **Read**: الوصول إلى بيانات غير مصرح بها.
     - **Update**: تعديل بيانات تخص مستخدم آخر (مثل تغيير البريد الإلكتروني).
     - **Delete**: حذف موارد تخص مستخدم آخر.
     - **Create**: إنشاء موارد بمعرفات قد تؤثر على مستخدمين آخرين.
   - مثال: إذا كان الطلب `PUT /api/users/123/profile` يسمح بتعديل الملف الشخصي، جرب تغيير 123 إلى معرف مستخدم آخر.

#### 7. **استخدام أدوات أتمتة:**
   - استخدم أدوات مثل Burp Suite أو OWASP ZAP لاعتراض الطلبات وتعديل المعرفات تلقائيًا.
   - يمكن استخدام Burp Intruder لإرسال طلبات متعددة بمعرفات مختلفة لاختبار استجابة النظام.

#### 8. **اختبار الـ API Endpoints غير الموثقة:**
   - تحقق مما إذا كان هناك نقاط نهاية (Endpoints) لا تتطلب مصادقة أو تحقق من الصلاحيات بشكل صحيح.
   - مثال: قد تكون بعض الـ APIs عامة (Public) ولكنها تكشف بيانات حساسة إذا تم تمرير معرف معين.

#### 9. **التلاعب بالـ JSON Payload:**
   - إذا كان الطلب يستخدم JSON، حاول تغيير قيم الحقول المتعلقة بالمعرفات.
   - مثال:
     ```json
     {
       "user_id": 123,
       "action": "view"
     }
     ```
     جرب تغيير `user_id` إلى قيمة أخرى.

##### الشرح العملي :
![Video/Broken access/2025-06-30 03-10-35.mkv](attachments/Video/Broken access/2025-06-30 03-10-35.mkv)




10. **اختبار استجابات الخطأ:**
    - إذا أرجعت نقطة النهاية رسالة خطأ (مثل "Access Denied") لبعض المعرفات ولكن ليس لأخرى، فقد تكون هناك ثغرة BOLA.
    - راقب استجابات الخادم (مثل رموز الحالة HTTP أو رسائل الخطأ) لمعرفة ما إذا كانت تكشف عن وجود كائنات.

---

### أمثلة عملية لاستغلال BOLA:
- **سيناريو 1: تطبيق بنكي**
  - طلب: `GET /api/accounts/1234/balance`
  - التجربة: تغيير 1234 إلى 1235.
  - النتيجة: إذا تم عرض رصيد حساب مستخدم آخر، فهذه ثغرة BOLA.

- **سيناريو 2: تطبيق تواصل اجتماعي**
  - طلب: `GET /api/messages/789`
  - التجربة: تغيير 789 إلى معرف رسالة أخرى.
  - النتيجة: إذا تم عرض رسائل مستخدم آخر، فهذه ثغرة.

- **سيناريو 3: تعديل بيانات**
  - طلب: `PUT /api/users/456/profile`
  - التجربة: إرسال بيانات جديدة لمعرف 456.
  - النتيجة: إذا تم تعديل ملف مستخدم آخر، فهذه ثغرة.

---
